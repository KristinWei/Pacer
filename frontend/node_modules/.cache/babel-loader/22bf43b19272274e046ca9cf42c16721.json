{"ast":null,"code":"import _toConsumableArray from \"/Users/kw/Desktop/cscc09/project-pacer/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"/Users/kw/Desktop/cscc09/project-pacer/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/kw/Desktop/cscc09/project-pacer/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/kw/Desktop/cscc09/project-pacer/frontend/src/TeacherPage.jsx\";\n\nfunction _regeneratorRuntime() { \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, $Symbol = \"function\" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || \"@@iterator\", asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\", toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, \"\"); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return generator._invoke = function (innerFn, self, context) { var state = \"suspendedStart\"; return function (method, arg) { if (\"executing\" === state) throw new Error(\"Generator is already running\"); if (\"completed\" === state) { if (\"throw\" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if (\"next\" === context.method) context.sent = context._sent = context.arg;else if (\"throw\" === context.method) { if (\"suspendedStart\" === state) throw state = \"completed\", context.arg; context.dispatchException(context.arg); } else \"return\" === context.method && context.abrupt(\"return\", context.arg); state = \"executing\"; var record = tryCatch(innerFn, self, context); if (\"normal\" === record.type) { if (state = context.done ? \"completed\" : \"suspendedYield\", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } \"throw\" === record.type && (state = \"completed\", context.method = \"throw\", context.arg = record.arg); } }; }(innerFn, self, context), generator; } function tryCatch(fn, obj, arg) { try { return { type: \"normal\", arg: fn.call(obj, arg) }; } catch (err) { return { type: \"throw\", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { [\"next\", \"throw\", \"return\"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if (\"throw\" !== record.type) { var result = record.arg, value = result.value; return value && \"object\" == typeof value && hasOwn.call(value, \"__await\") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke(\"next\", value, resolve, reject); }, function (err) { invoke(\"throw\", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke(\"throw\", error, resolve, reject); }); } reject(record.arg); } var previousPromise; this._invoke = function (method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); }; } function maybeInvokeDelegate(delegate, context) { var method = delegate.iterator[context.method]; if (undefined === method) { if (context.delegate = null, \"throw\" === context.method) { if (delegate.iterator.return && (context.method = \"return\", context.arg = undefined, maybeInvokeDelegate(delegate, context), \"throw\" === context.method)) return ContinueSentinel; context.method = \"throw\", context.arg = new TypeError(\"The iterator does not provide a 'throw' method\"); } return ContinueSentinel; } var record = tryCatch(method, delegate.iterator, context.arg); if (\"throw\" === record.type) return context.method = \"throw\", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, \"return\" !== context.method && (context.method = \"next\", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = \"throw\", context.arg = new TypeError(\"iterator result is not an object\"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = \"normal\", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: \"root\" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if (\"function\" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) { if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; } return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, define(Gp, \"constructor\", GeneratorFunctionPrototype), define(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, \"GeneratorFunction\"), exports.isGeneratorFunction = function (genFun) { var ctor = \"function\" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || \"GeneratorFunction\" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, \"GeneratorFunction\")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, \"Generator\"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, \"toString\", function () { return \"[object Generator]\"; }), exports.keys = function (object) { var keys = []; for (var key in object) { keys.push(key); } return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) { \"t\" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); } }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if (\"throw\" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = \"throw\", record.arg = exception, context.next = loc, caught && (context.method = \"next\", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if (\"root\" === entry.tryLoc) return handle(\"end\"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, \"catchLoc\"), hasFinally = hasOwn.call(entry, \"finallyLoc\"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error(\"try statement without catch or finally\"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, \"finallyLoc\") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && (\"break\" === type || \"continue\" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = \"next\", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if (\"throw\" === record.type) throw record.arg; return \"break\" === record.type || \"continue\" === record.type ? this.next = record.arg : \"return\" === record.type ? (this.rval = this.arg = record.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, catch: function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if (\"throw\" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error(\"illegal catch attempt\"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, \"next\" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }\n\nimport { useCallback, useState, useEffect, cloneElement, useRef } from \"react\";\nimport Peer from \"simple-peer\";\nimport CodeMirror from \"@uiw/react-codemirror\";\nimport InputLabel from \"@mui/material/InputLabel\";\nimport MenuItem from \"@mui/material/MenuItem\";\nimport FormControl from \"@mui/material/FormControl\";\nimport Select, { SelectChangeEvent } from \"@mui/material/Select\";\nimport Box from \"@mui/material/Box\";\nimport Button from \"@mui/material/Button\";\nimport Grid from \"@mui/material/Grid\";\nimport EditorOptionsBar from \"./components/EditorOptions\";\nimport Toolbar from \"@mui/material/Toolbar\";\nimport Stack from \"@mui/material/Stack\";\nimport Storage from \"./components/Storage\";\nimport { upperPythonKeys, lowerPythonKeys, javaKeys } from \"./_helpers\";\nimport { EditorState, Compartment } from \"@codemirror/state\";\nimport { python, pythonLanguage } from \"@codemirror/lang-python\";\nimport { CompletionContext } from \"@codemirror/autocomplete\";\nimport { javascript, javascriptLanguage } from \"@codemirror/lang-javascript\";\nimport { java, javaLanguage } from \"@codemirror/lang-java\";\nimport { authenticationService, getAllRooms } from \"./_services\";\nimport TeacherRightMenu from \"./components/TeacherRightMenu\";\nimport runCode from \"./_helpers/codeRunner\"; // [kw]\n\nimport React from \"react\"; // import { socket } from \"./_services\";\n\nimport CodeExecutionResWidgit from \"./components/CodeExecutionResWidgit\";\nimport \"./CodePage.css\"; // for file up/downloading (via fb):\n\nimport { storage } from \"./_components/FireBase\";\nimport { ref, uploadBytesResumable, getDownloadURL } from \"@firebase/storage\";\nimport { display } from \"@mui/system\";\nvar drawerWidth = 200; // for cloud sync (via fb) [experimental - TODO]:\n\nvar t = 0; //ns\n\nfunction TeacherPage(_ref) {\n  var _this = this;\n\n  var socket = _ref.socket,\n      curUser = _ref.curUser,\n      userRoom = _ref.userRoom,\n      roomId = _ref.roomId;\n\n  // code mirror config\n  var _useState = useState(function () {\n    return \"javascript\";\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      language = _useState2[0],\n      setLanguage = _useState2[1];\n\n  var _useState3 = useState(function () {\n    return false;\n  }),\n      _useState4 = _slicedToArray(_useState3, 2),\n      displayStudent = _useState4[0],\n      setDisplayStudent = _useState4[1]; // code display and transmission\n\n\n  var _useState5 = useState(function () {\n    return \"\";\n  }),\n      _useState6 = _slicedToArray(_useState5, 2),\n      sid = _useState6[0],\n      setSid = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      _useState8 = _slicedToArray(_useState7, 2),\n      code = _useState8[0],\n      setCode = _useState8[1];\n\n  var _useState9 = useState(function () {\n    return \"no student here\";\n  }),\n      _useState10 = _slicedToArray(_useState9, 2),\n      stuCode = _useState10[0],\n      setStuCode = _useState10[1]; // execution\n\n\n  var _useState11 = useState(function () {\n    return null;\n  }),\n      _useState12 = _slicedToArray(_useState11, 2),\n      out = _useState12[0],\n      setOut = _useState12[1];\n\n  var _useState13 = useState(function () {\n    return null;\n  }),\n      _useState14 = _slicedToArray(_useState13, 2),\n      err = _useState14[0],\n      setErr = _useState14[1];\n\n  var _useState15 = useState(function () {\n    return null;\n  }),\n      _useState16 = _slicedToArray(_useState15, 2),\n      stuOut = _useState16[0],\n      setStuOut = _useState16[1];\n\n  var _useState17 = useState(function () {\n    return null;\n  }),\n      _useState18 = _slicedToArray(_useState17, 2),\n      stuErr = _useState18[0],\n      setStuErr = _useState18[1]; // save and load\n\n\n  var _useState19 = useState(\"\"),\n      _useState20 = _slicedToArray(_useState19, 2),\n      codePath = _useState20[0],\n      setCodePath = _useState20[1];\n\n  var _useState21 = useState(\"\"),\n      _useState22 = _slicedToArray(_useState21, 2),\n      codeFilename = _useState22[0],\n      setCodeFilename = _useState22[1]; // audio call\n  // const [stuJoin, setStuJoin] = useState(() => {});\n\n\n  var _useState23 = useState(function () {\n    return \"\";\n  }),\n      _useState24 = _slicedToArray(_useState23, 2),\n      studentName = _useState24[0],\n      setStudentName = _useState24[1];\n\n  var _useState25 = useState([]),\n      _useState26 = _slicedToArray(_useState25, 2),\n      connectedUsers = _useState26[0],\n      setConnectedUsers = _useState26[1];\n\n  var _useState27 = useState(function () {\n    return null;\n  }),\n      _useState28 = _slicedToArray(_useState27, 2),\n      callStream = _useState28[0],\n      setCallStream = _useState28[1];\n\n  var _useState29 = useState(function () {\n    return false;\n  }),\n      _useState30 = _slicedToArray(_useState29, 2),\n      callSystemInited = _useState30[0],\n      setCallSystemInited = _useState30[1];\n\n  var _useState31 = useState(function () {\n    return false;\n  }),\n      _useState32 = _slicedToArray(_useState31, 2),\n      callInprogress = _useState32[0],\n      setCallInprogress = _useState32[1];\n\n  var _useState33 = useState(function () {\n    return [];\n  }),\n      _useState34 = _slicedToArray(_useState33, 2),\n      peers = _useState34[0],\n      setPeers = _useState34[1];\n\n  var localAudio = useRef();\n  var peersRef = useRef([]);\n  var extensions = [javascript({\n    jsx: true\n  })];\n\n  if (language === \"javascript\") {\n    extensions[0] = javascript({\n      jsx: true\n    });\n  } else if (language === \"python\") {\n    extensions[0] = python();\n    extensions[1] = globalPythonCompletions;\n  } else {\n    extensions[0] = java();\n    extensions[1] = globalJavaScriptCompletions;\n  }\n\n  var Audio = function Audio(_ref2) {\n    var peer = _ref2.peer;\n    var ref = useRef();\n    useEffect(function () {\n      peer.on(\"stream\", function (stream) {\n        console.log(\"this is streaming\");\n        console.log(\"stream is \".concat(stream));\n        ref.current.srcObject = stream;\n      });\n    }, []);\n    return /*#__PURE__*/React.createElement(\"audio\", {\n      playsInline: true,\n      autoPlay: true,\n      ref: ref,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }\n    });\n  }; // for cloud sync (via fb) [experimental - TODO]:\n  // todo-kw: uncomment this\n  // useEffect(() => {\n  //   setTimeout(() => {\n  //     if (t == 1) {\n  //       t = 0;\n  //       const f = new File([code], codeFilename);\n  //       uploadFile(f);\n  //     } else {\n  //       t++;\n  //     }\n  //   }, 1000);\n  // });\n  // for file uploading (via fb):\n\n\n  var uploadFileFormHandler = function uploadFileFormHandler(event) {\n    event.preventDefault();\n    uploadFile(event.target[0].files[0]).then(function (res) {\n      res.file.text().then(function (code) {\n        setCode(code);\n        setCodePath(res.codePath);\n        setCodeFilename(res.file.name);\n      });\n    });\n  }; // for file uploading (via fb):\n\n\n  var uploadFile = function uploadFile(f) {\n    return new Promise(function (res, rej) {\n      if (!f) {\n        console.log(\"Upload failed. Try a different file.\");\n        rej();\n      }\n\n      var cp = \"/files/users/\".concat(authenticationService.currentUser.source._value.username, \"/\").concat(f.name);\n      var fileStorageRef = ref(storage, cp);\n      var uploadFileTaskStatus = uploadBytesResumable(fileStorageRef, f);\n      uploadFileTaskStatus.on(\"state_changed\", function (u) {\n        var p = 100;\n\n        if (u.totalBytes > 0) {\n          p = Math.round(u.bytesTransferred / u.totalBytes * 100);\n        }\n      }, function (err) {\n        console.log(err);\n        rej();\n      }, function () {\n        // when the file is uploaded successfully:\n        //getDownloadURL(uploadFileTaskStatus.snapshot.ref).then((url) => console.log(url));\n        res({\n          file: f,\n          codePath: cp\n        });\n      });\n    });\n  }; // for file downloading (via fb):\n\n\n  var makeDownloadFileRequest = function makeDownloadFileRequest(url) {\n    return new Promise(function (res, rej) {\n      var xhr = new XMLHttpRequest(); // handle xhr response:\n\n      xhr.responseType = \"text\";\n\n      xhr.onload = function (event) {\n        if (xhr.status == 200) {\n          res({\n            code: xhr.response\n          });\n        } else {\n          console.log(xhr.status);\n          rej();\n        }\n      };\n\n      xhr.onerror = function () {\n        console.log(xhr.status);\n        rej();\n      };\n\n      xhr.open(\"GET\", url);\n      xhr.send(); // is xhr onload async\n    });\n  }; // for file downloading (via fb):\n\n\n  var downloadFile = function downloadFile(fileLocation) {\n    var fileStorageRef = ref(storage, fileLocation);\n    return getDownloadURL(fileStorageRef).then(function (url) {\n      return makeDownloadFileRequest(url);\n    });\n  };\n\n  useEffect( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n    var cp;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            console.log(\"from teacherPage: roomId \".concat(roomId)); //\n\n            socket.emit(\"set attributes\", \"teacher\", curUser, roomId);\n            socket.roomId = roomId; // socket.emit(\"onLecChange\", code);\n            //new\n\n            socket.emit(\"teacher join\", roomId);\n            socket.on(\"connection broadcast\", function (SktId, role, curUser) {\n              // add newly connected student\n              if (connectedUsers.includes({\n                curUser: curUser,\n                SktId: SktId\n              })) {\n                console.log(\"[join broadcast]: user: \".concat(curUser, \" already joined (socket id: \").concat(SktId, \")\")); // } else if( role === 'student') { // new\n              } else {\n                // new\n                setConnectedUsers(function (eixstingUsers) {\n                  return [].concat(_toConsumableArray(eixstingUsers), [{\n                    curUser: curUser,\n                    SktId: SktId\n                  }]);\n                });\n                console.log(\"[join broadcast]: new user: \".concat(curUser, \" (socket id: \").concat(SktId, \") joined as \").concat(role));\n              } // init remote window on student's end\n\n\n              setDisplayStudent(function (display) {\n                // emit teacher's code if not on review mode\n                if (!display) {\n                  setCode(function (currentCode) {\n                    socket.emit(\"onLecChange\", currentCode, roomId);\n                    return currentCode;\n                  });\n                } else {\n                  // emit student's code if on review mode\n                  setStuCode(function (curStuCode) {\n                    socket.emit(\"onLecChange\", curStuCode, roomId);\n                    return curStuCode;\n                  });\n                }\n\n                return display;\n              });\n            });\n            socket.on(\"disconnection broadcast\", function (SktId, role, curUser) {\n              setConnectedUsers(function (eixstingUsers) {\n                var userCopy = _toConsumableArray(eixstingUsers);\n\n                var idx = userCopy.findIndex(function (user) {\n                  return user.SktId === SktId;\n                });\n\n                if (idx >= 0) {\n                  console.log(\"clearing\");\n                  userCopy.splice(idx, 1);\n                }\n\n                return userCopy;\n              });\n              setSid(function (init) {\n                if (SktId === init) {\n                  setDisplayStudent(false);\n                  socket.sid = \"\";\n                  return \"\";\n                }\n\n                return init;\n              }); // if(SktId === curSid) {\n              //   setDisplayStudent(false);\n              //   socket.sid = \"\";\n              // }\n\n              console.log(\"[disconnection broadcast]: \".concat(role, \" - \").concat(curUser, \" (socket id: \").concat(SktId, \")\"));\n            });\n            socket.on(\"student join\", function (sSktId, username) {\n              console.log(\"[TeacherPage - student join] joining student socket id: \", sSktId, \" and student name: \", username); // add connected student\n\n              if (!connectedUsers.includes({\n                curUser: username,\n                sSktId: sSktId\n              })) setConnectedUsers(function (eixstingUsers) {\n                return [].concat(_toConsumableArray(eixstingUsers), [{\n                  curUser: username,\n                  SktId: sSktId\n                }]);\n              }); // init teacher code on student's window\n\n              socket.emit(\"onLecChange\", code, roomId);\n            });\n            socket.on(\"fetch init\", function (code, sid) {\n              // revisit\n              setSid(sid);\n              socket.sid = sid;\n              socket.on = true;\n              setStuCode(function () {\n                socket.emit(\"onLecChange\", code, roomId);\n                return code;\n              });\n            });\n            socket.on(\"onChange\", function (value, id) {\n              setStuCode(function () {\n                socket.emit(\"onLecChange\", value, roomId);\n                return value;\n              });\n            }); // todo-kw: revisit this function - may be useless given current logic\n\n            socket.on(\"no student\", function (msg) {\n              socket.sid = \"\";\n              setSid(\"\");\n              socket.on = true;\n              setStuCode(msg);\n            }); // for file downloading (via fb):\n\n            if (code === \"\" && codePath === \"\" && codeFilename === \"\") {\n              cp = \"/files/defaults/yteacher.txt\";\n              downloadFile(cp).then(function (res) {\n                var f = new File([res.code], \"whateveryouwant.txt\");\n                return uploadFile(f);\n              }).then(function (res) {\n                res.file.text().then(function (code) {\n                  setCode(code);\n                  setCodePath(res.codePath);\n                  setCodeFilename(res.file.name);\n                });\n              });\n            } // for when code + codePath correspond to session, so an uploaded file can take over code slide\n\n\n            console.log(\"load teacher page complete\");\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  })), []);\n  useEffect(function () {\n    if (callSystemInited) {\n      console.log(\"initing call system\");\n      socket.on(\"all users\", function (users) {\n        console.log(users);\n        var peers = [];\n        users.forEach(function (userId) {\n          console.log(\"stream is \".concat(callStream));\n          var peer = createPeer(userId, socket.id, callStream);\n          peersRef.current.push({\n            peerID: userId,\n            peer: peer\n          });\n          peers.push(peer);\n        });\n        console.log(\"peers are \".concat(peers));\n        setPeers(peers);\n      });\n      socket.on(\"user joined\", function (payload) {\n        console.log(\"user joined\");\n        console.log(\"stream is \".concat(callStream));\n        var peer = addPeer(payload.signal, payload.callerID, callStream);\n        peersRef.current.push({\n          peerID: payload.callerID,\n          peer: peer\n        });\n        setPeers(function (users) {\n          return [].concat(_toConsumableArray(users), [peer]);\n        });\n      });\n      socket.on(\"receiving returned signal\", function (payload) {\n        console.log(\"receiving returned signal\");\n        console.log(peersRef.current);\n        console.log(payload.id);\n        var item = peersRef.current.find(function (p) {\n          return p.peerID === payload.id;\n        });\n        console.log(item);\n        item.peer.signal(payload.signal);\n      });\n    }\n  }, [callSystemInited]); // new\n\n  useEffect(function () {\n    if (!displayStudent) socket.emit(\"onLecChange\", code, roomId);\n    if (displayStudent) socket.emit(\"onLecChange\", stuCode, roomId);\n  }, [displayStudent]);\n\n  var onChange = function onChange(value, viewUpdate) {\n    if (!displayStudent) socket.emit(\"onLecChange\", value, roomId);\n    setCode(value);\n  };\n\n  var onStuChange = function onStuChange(value, viewUpdate) {\n    var editor = viewUpdate.state.values[0].prevUserEvent;\n\n    if (editor) {\n      socket.emit(\"onChange\", value, socket.sid, roomId);\n      socket.emit(\"onLecChange\", value, roomId);\n    }\n\n    setStuCode(value);\n  };\n\n  var run = function run() {\n    console.log(code);\n\n    var _runCode = runCode(code, language),\n        out = _runCode.out,\n        err = _runCode.err;\n\n    setOut(out);\n    setErr(err);\n  };\n\n  var clearExecutionRes = function clearExecutionRes() {\n    setOut(null);\n    setErr(null);\n  };\n\n  var runStuCode = function runStuCode() {\n    console.log(stuCode);\n\n    var _runCode2 = runCode(stuCode, language),\n        out = _runCode2.out,\n        err = _runCode2.err;\n\n    setStuOut(out);\n    setStuErr(err);\n  };\n\n  var setupCall = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n      var localStream;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (callInprogress) {\n                _context2.next = 13;\n                break;\n              }\n\n              console.log(\"seting up call\");\n              _context2.next = 4;\n              return navigator.mediaDevices.getUserMedia({\n                video: false,\n                audio: true\n              });\n\n            case 4:\n              localStream = _context2.sent;\n              console.log(\"hardware setup complete\");\n              setCallStream(localStream);\n              setCallSystemInited(true);\n\n              if (localAudio.current) {\n                localAudio.current.srcObject = localStream;\n                console.log(\"done setting local stream\");\n              } // todo: you many wanna change this \n\n\n              socket.emit(\"joined chat\", userRoom); // socket.emit(\"joined chat\", roomId);\n\n              setCallInprogress(true);\n              _context2.next = 15;\n              break;\n\n            case 13:\n              console.log(\"closing call\");\n              setCallInprogress(false);\n\n            case 15:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function setupCall() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  function createPeer(userTarget, callerID, stream) {\n    console.log(\"stream is \".concat(stream));\n    var peer = new Peer({\n      initiator: true,\n      trickle: false,\n      stream: stream\n    });\n    peer.on(\"signal\", function (signal) {\n      console.log(\"student call initiated. Calling from \".concat(socket.id, \" to \").concat(userTarget));\n      socket.emit(\"sending signal\", {\n        userTarget: userTarget,\n        callerID: callerID,\n        signal: signal\n      });\n    });\n    return peer;\n  }\n\n  function addPeer(incomingSignal, callerID, stream) {\n    console.log(\"stream is \".concat(stream));\n    var peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream: stream\n    });\n    peer.on(\"signal\", function (signal) {\n      socket.emit(\"returning signal\", {\n        signal: signal,\n        callerID: callerID\n      });\n    });\n    peer.signal(incomingSignal);\n    return peer;\n  }\n\n  var clearStuExecutionRes = function clearStuExecutionRes() {\n    setStuOut(null);\n    setStuErr(null);\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Box, {\n    sx: {\n      flexGrow: 1,\n      p: 3,\n      width: {\n        sm: \"calc(100% - \".concat(drawerWidth, \"px)\")\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 478,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Toolbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 485,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 2,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 486,\n      columnNumber: 9\n    }\n  }, displayStudent ? /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 488,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    direction: \"column\",\n    alignItems: \"stretch\",\n    rowSpacing: 1,\n    columnSpacing: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 489,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 496,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 497,\n      columnNumber: 19\n    }\n  }, \"Code session for student \", studentName, \":\")), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 500,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(CodeMirror, {\n    value: stuCode,\n    height: \"600px\",\n    theme: \"dark\",\n    extensions: extensions,\n    onChange: onStuChange,\n    hint: \"true\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 501,\n      columnNumber: 19\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 510,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Stack, {\n    spacing: 2,\n    direction: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 511,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: runStuCode,\n    variant: \"contained\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 512,\n      columnNumber: 21\n    }\n  }, \"Run\"))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 517,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(CodeExecutionResWidgit, {\n    out: stuOut,\n    err: stuErr,\n    clear: clearStuExecutionRes,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 518,\n      columnNumber: 19\n    }\n  })))) : null, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: displayStudent ? 6 : 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 528,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    direction: \"column\",\n    alignItems: \"stretch\",\n    rowSpacing: 4,\n    columnSpacing: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 529,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 536,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(EditorOptionsBar, {\n    language: language,\n    onLanguageChange: function onLanguageChange(e) {\n      return setLanguage(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 537,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 542,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 543,\n      columnNumber: 17\n    }\n  }, \"Client Screen (local):\")), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 545,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(CodeMirror, {\n    value: code,\n    height: \"600px\",\n    theme: \"dark\",\n    extensions: extensions,\n    onChange: onChange,\n    hint: \"true\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 547,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 556,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Stack, {\n    spacing: 3,\n    direction: \"row\",\n    justifyContent: \"center\",\n    alignItems: \"space-evenly\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 557,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: run,\n    variant: \"contained\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 563,\n      columnNumber: 19\n    }\n  }, \"Run\"), /*#__PURE__*/React.createElement(Storage, {\n    value: code,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 566,\n      columnNumber: 19\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 569,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: uploadFileFormHandler,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 570,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"file\",\n    className: \"input\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 571,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 572,\n      columnNumber: 19\n    }\n  }, \"Upload\"))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 575,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(CodeExecutionResWidgit, {\n    out: out,\n    err: err,\n    clear: clearExecutionRes,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 576,\n      columnNumber: 17\n    }\n  })))))), /*#__PURE__*/React.createElement(TeacherRightMenu, {\n    drawerWidth: drawerWidth,\n    setDisplayStudent: setDisplayStudent,\n    setStudentName: setStudentName,\n    connectedUsers: connectedUsers.filter(function (user) {\n      return user.curUser !== curUser;\n    }),\n    setConnectedUsers: setConnectedUsers,\n    socket: socket,\n    roomId: roomId,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 586,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Stack, {\n    direction: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 595,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"audio\", {\n    playsInline: true,\n    muted: true,\n    ref: localAudio,\n    autoPlay: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 596,\n      columnNumber: 7\n    }\n  }), peers.map(function (peer, index) {\n    return /*#__PURE__*/React.createElement(Audio, {\n      key: index,\n      peer: peer,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 598,\n        columnNumber: 18\n      }\n    });\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"call-button\",\n    onClick: function onClick() {\n      return setupCall();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 601,\n      columnNumber: 7\n    }\n  }, callInprogress ? \"Disconnect\" : \"Call\"));\n}\n\nfunction myPythonCompletions(context) {\n  var word = context.matchBefore(/\\w*/);\n  if (word.from == word.to && !context.explicit) return null;\n\n  if (word.text[0] === word.text[0].toUpperCase() && /^[a-zA-Z]+$/.test(word.text[0])) {\n    return {\n      from: word.from,\n      options: upperPythonKeys\n    };\n  }\n\n  return {\n    from: word.from,\n    options: lowerPythonKeys\n  };\n}\n\nfunction myJavaCompletions(context) {\n  var word = context.matchBefore(/\\w*/);\n  if (word.from == word.to && !context.explicit) return null;\n  return {\n    from: word.from,\n    options: javaKeys\n  };\n}\n\nvar globalPythonCompletions = pythonLanguage.data.of({\n  autocomplete: myPythonCompletions\n});\nvar globalJavaScriptCompletions = javaLanguage.data.of({\n  autocomplete: myJavaCompletions\n});\nexport default TeacherPage;","map":{"version":3,"names":["useCallback","useState","useEffect","cloneElement","useRef","Peer","CodeMirror","InputLabel","MenuItem","FormControl","Select","SelectChangeEvent","Box","Button","Grid","EditorOptionsBar","Toolbar","Stack","Storage","upperPythonKeys","lowerPythonKeys","javaKeys","EditorState","Compartment","python","pythonLanguage","CompletionContext","javascript","javascriptLanguage","java","javaLanguage","authenticationService","getAllRooms","TeacherRightMenu","runCode","React","CodeExecutionResWidgit","storage","ref","uploadBytesResumable","getDownloadURL","display","drawerWidth","t","TeacherPage","socket","curUser","userRoom","roomId","language","setLanguage","displayStudent","setDisplayStudent","sid","setSid","code","setCode","stuCode","setStuCode","out","setOut","err","setErr","stuOut","setStuOut","stuErr","setStuErr","codePath","setCodePath","codeFilename","setCodeFilename","studentName","setStudentName","connectedUsers","setConnectedUsers","callStream","setCallStream","callSystemInited","setCallSystemInited","callInprogress","setCallInprogress","peers","setPeers","localAudio","peersRef","extensions","jsx","globalPythonCompletions","globalJavaScriptCompletions","Audio","peer","on","stream","console","log","current","srcObject","uploadFileFormHandler","event","preventDefault","uploadFile","target","files","then","res","file","text","name","f","Promise","rej","cp","currentUser","source","_value","username","fileStorageRef","uploadFileTaskStatus","u","p","totalBytes","Math","round","bytesTransferred","makeDownloadFileRequest","url","xhr","XMLHttpRequest","responseType","onload","status","response","onerror","open","send","downloadFile","fileLocation","emit","SktId","role","includes","eixstingUsers","currentCode","curStuCode","userCopy","idx","findIndex","user","splice","init","sSktId","value","id","msg","File","users","forEach","userId","createPeer","push","peerID","payload","addPeer","signal","callerID","item","find","onChange","viewUpdate","onStuChange","editor","state","values","prevUserEvent","run","clearExecutionRes","runStuCode","setupCall","navigator","mediaDevices","getUserMedia","video","audio","localStream","userTarget","initiator","trickle","incomingSignal","clearStuExecutionRes","flexGrow","width","sm","e","filter","map","index","myPythonCompletions","context","word","matchBefore","from","to","explicit","toUpperCase","test","options","myJavaCompletions","data","of","autocomplete"],"sources":["/Users/kw/Desktop/cscc09/project-pacer/frontend/src/TeacherPage.jsx"],"sourcesContent":["import { useCallback, useState, useEffect, cloneElement, useRef } from \"react\";\nimport Peer from \"simple-peer\";\nimport CodeMirror from \"@uiw/react-codemirror\";\nimport InputLabel from \"@mui/material/InputLabel\";\nimport MenuItem from \"@mui/material/MenuItem\";\nimport FormControl from \"@mui/material/FormControl\";\nimport Select, { SelectChangeEvent } from \"@mui/material/Select\";\nimport Box from \"@mui/material/Box\";\nimport Button from \"@mui/material/Button\";\nimport Grid from \"@mui/material/Grid\";\nimport EditorOptionsBar from \"./components/EditorOptions\";\nimport Toolbar from \"@mui/material/Toolbar\";\nimport Stack from \"@mui/material/Stack\";\nimport Storage from \"./components/Storage\";\n\nimport { upperPythonKeys, lowerPythonKeys, javaKeys } from \"./_helpers\";\n\nimport { EditorState, Compartment } from \"@codemirror/state\";\nimport { python, pythonLanguage } from \"@codemirror/lang-python\";\nimport { CompletionContext } from \"@codemirror/autocomplete\";\nimport { javascript, javascriptLanguage } from \"@codemirror/lang-javascript\";\nimport { java, javaLanguage } from \"@codemirror/lang-java\";\nimport { authenticationService, getAllRooms } from \"./_services\";\nimport TeacherRightMenu from \"./components/TeacherRightMenu\";\nimport runCode from \"./_helpers/codeRunner\";\n// [kw]\nimport React from \"react\";\n// import { socket } from \"./_services\";\nimport CodeExecutionResWidgit from \"./components/CodeExecutionResWidgit\";\nimport \"./CodePage.css\";\n\n\n// for file up/downloading (via fb):\nimport { storage } from \"./_components/FireBase\";\nimport { ref, uploadBytesResumable, getDownloadURL } from \"@firebase/storage\";\nimport { display } from \"@mui/system\";\n\nconst drawerWidth = 200;\n// for cloud sync (via fb) [experimental - TODO]:\nlet t = 0; //ns\n\n\nfunction TeacherPage({ socket, curUser, userRoom, roomId}) {\n  // code mirror config\n  const [language, setLanguage] = useState(() => \"javascript\");\n  const [displayStudent, setDisplayStudent] = useState(() => false);\n  // code display and transmission\n  const [sid, setSid] = useState(() => \"\");\n  const [code, setCode] = useState(\"\");\n  const [stuCode, setStuCode] = useState(() => \"no student here\");\n  // execution\n  const [out, setOut] = useState(() => null);\n  const [err, setErr] = useState(() => null);\n  const [stuOut, setStuOut] = useState(() => null);\n  const [stuErr, setStuErr] = useState(() => null);\n  // save and load\n  const [codePath, setCodePath] = useState(\"\");\n  const [codeFilename, setCodeFilename] = useState(\"\");\n  // audio call\n  // const [stuJoin, setStuJoin] = useState(() => {});\n  const [studentName, setStudentName] = useState(() => \"\");\n  const [connectedUsers, setConnectedUsers] = useState([]);\n  const [callStream, setCallStream] = useState(() => null);\n  const [callSystemInited, setCallSystemInited] = useState(() => false);\n  const [callInprogress, setCallInprogress] = useState(() => false);\n  const [peers, setPeers] = useState(() => []);\n\n  const localAudio = useRef();\n  const peersRef = useRef([]);\n\n\n  let extensions = [javascript({ jsx: true })];\n  if (language === \"javascript\") {\n    extensions[0] = javascript({ jsx: true });\n  } else if (language === \"python\") {\n    extensions[0] = python();\n    extensions[1] = globalPythonCompletions;\n  } else {\n    extensions[0] = java();\n    extensions[1] = globalJavaScriptCompletions;\n  }\n\n  const Audio = ({peer}) => {\n    const ref = useRef();\n\n    useEffect(() => {\n        peer.on(\"stream\", stream => {\n            console.log(\"this is streaming\")\n            console.log(`stream is ${stream}`)\n            ref.current.srcObject = stream;\n        })\n    }, []);\n\n    return (\n        <audio playsInline autoPlay ref={ref} />\n      );\n  }\n  // for cloud sync (via fb) [experimental - TODO]:\n  // todo-kw: uncomment this\n  // useEffect(() => {\n  //   setTimeout(() => {\n  //     if (t == 1) {\n  //       t = 0;\n  //       const f = new File([code], codeFilename);\n  //       uploadFile(f);\n  //     } else {\n  //       t++;\n  //     }\n  //   }, 1000);\n  // });\n\n\n  // for file uploading (via fb):\n  const uploadFileFormHandler = (event) => {\n    event.preventDefault();\n    uploadFile(event.target[0].files[0]).then((res) => {\n      res.file.text().then((code) => {\n        setCode(code);\n        setCodePath(res.codePath);\n        setCodeFilename(res.file.name);\n      });\n    });\n  };\n\n\n  // for file uploading (via fb):\n  const uploadFile = (f) => {\n    return new Promise(function (res, rej) {\n      if (!f) {\n        console.log(\"Upload failed. Try a different file.\");\n        rej();\n      }\n      const cp = `/files/users/${authenticationService.currentUser.source._value.username}/${f.name}`;\n      const fileStorageRef = ref(storage, cp);\n      const uploadFileTaskStatus = uploadBytesResumable(fileStorageRef, f);\n      uploadFileTaskStatus.on(\n        \"state_changed\",\n        (u) => {\n          let p = 100;\n          if (u.totalBytes > 0) {\n            p = Math.round((u.bytesTransferred / u.totalBytes) * 100);\n          }\n        },\n        (err) => {\n          console.log(err);\n          rej();\n        },\n        () => {\n          // when the file is uploaded successfully:\n          //getDownloadURL(uploadFileTaskStatus.snapshot.ref).then((url) => console.log(url));\n          res({ file: f, codePath: cp });\n        }\n      );\n    });\n  };\n\n\n  // for file downloading (via fb):\n  const makeDownloadFileRequest = (url) => {\n    return new Promise(function (res, rej) {\n      let xhr = new XMLHttpRequest();\n      // handle xhr response:\n      xhr.responseType = \"text\";\n      xhr.onload = (event) => {\n        if (xhr.status == 200) {\n          res({ code: xhr.response });\n        } else {\n          console.log(xhr.status);\n          rej();\n        }\n      };\n      xhr.onerror = () => {\n        console.log(xhr.status);\n        rej();\n      };\n      xhr.open(\"GET\", url);\n      xhr.send(); // is xhr onload async\n    });\n  };\n\n\n  // for file downloading (via fb):\n  const downloadFile = (fileLocation) => {\n    const fileStorageRef = ref(storage, fileLocation);\n    return getDownloadURL(fileStorageRef).then((url) =>\n      makeDownloadFileRequest(url)\n    );\n  };\n  \n\n  useEffect(async () => {\n    \n    console.log(`from teacherPage: roomId ${roomId}`);\n    \n    //\n    socket.emit(\"set attributes\", \"teacher\", curUser, roomId);\n    socket.roomId = roomId;\n\n    // socket.emit(\"onLecChange\", code);\n\n    //new\n    socket.emit(\"teacher join\", roomId);\n\n    socket.on(\"connection broadcast\", (SktId, role, curUser) => {\n      // add newly connected student\n      if (connectedUsers.includes({ curUser, SktId })) {\n        console.log(\n          `[join broadcast]: user: ${curUser} already joined (socket id: ${SktId})`\n        );\n      // } else if( role === 'student') { // new\n      } else { // new\n        setConnectedUsers(eixstingUsers => [...eixstingUsers, { curUser, SktId }]);\n        console.log(\n          `[join broadcast]: new user: ${curUser} (socket id: ${SktId}) joined as ${role}`\n        );\n      }\n      // init remote window on student's end\n      setDisplayStudent(display => {\n        // emit teacher's code if not on review mode\n        if (!display){\n          setCode(currentCode => {\n            socket.emit(\"onLecChange\", currentCode, roomId);\n            return currentCode;\n          });\n        } else { // emit student's code if on review mode\n          setStuCode(curStuCode => {\n            socket.emit(\"onLecChange\", curStuCode, roomId);\n            return curStuCode;\n          })\n        }\n        return display;\n      });\n\n    });\n\n    socket.on(\"disconnection broadcast\", (SktId, role, curUser) => {\n      setConnectedUsers(eixstingUsers => {\n        const userCopy = [...eixstingUsers];\n        const idx = userCopy.findIndex((user) => user.SktId === SktId);\n        if (idx >= 0) {\n          console.log(\"clearing\");\n          userCopy.splice(idx, 1);\n        }\n        return userCopy\n      });\n\n      setSid(init => {\n        if(SktId === init) {\n          setDisplayStudent(false);\n          socket.sid = \"\";\n          return \"\";\n        }\n        return init;\n      });\n    \n      // if(SktId === curSid) {\n      //   setDisplayStudent(false);\n      //   socket.sid = \"\";\n      // }\n\n      console.log(`[disconnection broadcast]: ${role} - ${curUser} (socket id: ${SktId})`);\n    });\n\n    socket.on(\"student join\", (sSktId, username) => {\n      console.log(\n        \"[TeacherPage - student join] joining student socket id: \", sSktId,\n        \" and student name: \", username\n      );\n      // add connected student\n      if (!connectedUsers.includes({ curUser: username, sSktId }))\n        setConnectedUsers(eixstingUsers => [...eixstingUsers, { curUser: username, SktId: sSktId }]);\n      // init teacher code on student's window\n      socket.emit(\"onLecChange\", code, roomId)\n    });\n\n    socket.on(\"fetch init\", (code, sid) => {\n      // revisit\n      setSid(sid);\n      socket.sid = sid;\n      socket.on = true;\n\n      setStuCode(() => {\n        socket.emit(\"onLecChange\", code, roomId);\n        return code;\n      });\n    });\n\n    socket.on(\"onChange\", (value, id) => {\n      setStuCode(() => {\n        socket.emit(\"onLecChange\", value, roomId);\n        return value;\n      });\n    });\n\n    // todo-kw: revisit this function - may be useless given current logic\n    socket.on(\"no student\", (msg) => {\n      socket.sid = \"\";\n      setSid(\"\");\n      socket.on = true;\n      setStuCode(msg);\n    });\n\n    // for file downloading (via fb):\n    if (code === \"\" && codePath === \"\" && codeFilename === \"\") {\n      let cp = \"/files/defaults/yteacher.txt\";\n      downloadFile(cp)\n        .then((res) => {\n          const f = new File([res.code], \"whateveryouwant.txt\");\n          return uploadFile(f);\n        })\n        .then((res) => {\n          res.file.text().then((code) => {\n            setCode(code);\n            setCodePath(res.codePath);\n            setCodeFilename(res.file.name);\n          });\n        });\n    } // for when code + codePath correspond to session, so an uploaded file can take over code slide\n\n    console.log(\"load teacher page complete\");\n  }, []);\n\n  useEffect(() => {\n    if (callSystemInited) {\n      console.log(\"initing call system\")\n      socket.on(\"all users\", (users) => {\n        console.log(users)\n        const peers = [];\n        users.forEach((userId) => {\n          console.log(`stream is ${callStream}`)\n          const peer = createPeer(userId, socket.id, callStream);\n          peersRef.current.push({\n            peerID: userId,\n            peer,\n          });\n          peers.push(peer);\n        });\n        console.log(`peers are ${peers}`)\n        setPeers(peers);\n      });\n\n      socket.on(\"user joined\", (payload) => {\n        console.log(\"user joined\")\n        console.log(`stream is ${callStream}`)\n        const peer = addPeer(payload.signal, payload.callerID, callStream);\n        peersRef.current.push({\n          peerID: payload.callerID,\n          peer,\n        });\n\n        setPeers((users) => [...users, peer]);\n      });\n\n      socket.on(\"receiving returned signal\", (payload) => {\n        console.log(\"receiving returned signal\")\n        console.log(peersRef.current)\n        console.log(payload.id)\n        const item = peersRef.current.find((p) => p.peerID === payload.id);\n        console.log(item)\n        item.peer.signal(payload.signal);\n      });\n    }\n  }, [callSystemInited])\n\n\n  // new\n  useEffect(() => {\n    if(!displayStudent) socket.emit(\"onLecChange\", code, roomId);\n    \n    if(displayStudent) socket.emit(\"onLecChange\", stuCode, roomId);\n    \n  },[displayStudent]);\n\n\n  const onChange = (value, viewUpdate) => {\n    if (!displayStudent) socket.emit(\"onLecChange\", value, roomId);\n    setCode(value);\n  };\n\n\n  const onStuChange = (value, viewUpdate) => {\n    const editor = viewUpdate.state.values[0].prevUserEvent;\n    if (editor) {\n      socket.emit(\"onChange\", value, socket.sid, roomId);\n      socket.emit(\"onLecChange\", value, roomId);\n    }\n    setStuCode(value);\n  };\n\n\n  const run = () => {\n    console.log(code);\n    const { out, err } = runCode(code, language);\n    setOut(out);\n    setErr(err);\n  };\n\n\n  const clearExecutionRes = () => {\n    setOut(null);\n    setErr(null);\n  };\n\n\n  const runStuCode = () => {\n    console.log(stuCode);\n    const { out, err } = runCode(stuCode, language);\n    setStuOut(out);\n    setStuErr(err);\n  };\n\n  const setupCall = async () => {\n    if (!callInprogress) {\n      console.log(\"seting up call\");\n      const localStream = await navigator.mediaDevices.getUserMedia({\n        video: false,\n        audio: true,\n      });\n      console.log(\"hardware setup complete\");\n      setCallStream(localStream);\n      setCallSystemInited(true);\n      if (localAudio.current) {\n        localAudio.current.srcObject = localStream;\n        console.log(\"done setting local stream\");\n      }\n      // todo: you many wanna change this \n      socket.emit(\"joined chat\", userRoom);\n      // socket.emit(\"joined chat\", roomId);\n      setCallInprogress(true);\n    } else {\n      console.log(\"closing call\");\n      \n      setCallInprogress(false);\n    }\n  };\n\n  function createPeer(userTarget, callerID, stream) {\n    console.log(`stream is ${stream}`)\n    const peer = new Peer({\n      initiator: true,\n      trickle: false,\n      stream,\n    });\n\n    peer.on(\"signal\", (signal) => {\n      console.log(\n        `student call initiated. Calling from ${socket.id} to ${userTarget}`\n      );\n      socket.emit(\"sending signal\", { userTarget, callerID, signal });\n    });\n    return peer;\n  }\n\n  function addPeer(incomingSignal, callerID, stream) {\n    console.log(`stream is ${stream}`)\n    const peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream,\n    });\n    peer.on(\"signal\", (signal) => {\n      socket.emit(\"returning signal\", { signal, callerID });\n    });\n    peer.signal(incomingSignal);\n\n    return peer;\n  }\n\n\n  const clearStuExecutionRes = () => {\n    setStuOut(null);\n    setStuErr(null);\n  };\n\n\n  return (\n    <>\n      <Box\n        sx={{\n          flexGrow: 1,\n          p: 3,\n          width: { sm: `calc(100% - ${drawerWidth}px)` },\n        }}\n      >\n        <Toolbar />\n        <Grid container spacing={2}>\n          {displayStudent ? (\n            <Grid item xs={6}>\n              <Grid\n                container\n                direction=\"column\"\n                alignItems=\"stretch\"\n                rowSpacing={1}\n                columnSpacing={3}\n              >\n                <Grid item xs={12}>\n                  <p>Code session for student {studentName}:</p>\n                </Grid>\n                {/* server display */}\n                <Grid item xs={12}>\n                  <CodeMirror\n                    value={stuCode}\n                    height=\"600px\"\n                    theme=\"dark\"\n                    extensions={extensions}\n                    onChange={onStuChange}\n                    hint=\"true\"\n                  />\n                </Grid>\n                <Grid item xs={12}>\n                  <Stack spacing={2} direction=\"row\">\n                    <Button onClick={runStuCode} variant=\"contained\">\n                      Run\n                    </Button>\n                  </Stack>\n                </Grid>\n                <Grid item xs={12}>\n                  <CodeExecutionResWidgit\n                    out={stuOut}\n                    err={stuErr}\n                    clear={clearStuExecutionRes}\n                  />\n                </Grid>\n              </Grid>\n            </Grid>\n          ) : null}\n\n          <Grid item xs={displayStudent ? 6 : 12}>\n            <Grid\n              container\n              direction=\"column\"\n              alignItems=\"stretch\"\n              rowSpacing={4}\n              columnSpacing={3}\n            >\n              <Grid item xs={12}>\n                <EditorOptionsBar\n                  language={language}\n                  onLanguageChange={(e) => setLanguage(e.target.value)}\n                />\n              </Grid>\n              <Grid item xs={12}>\n                <p>Client Screen (local):</p>\n              </Grid>\n              <Grid item xs={12}>\n                {/* client display */}\n                <CodeMirror\n                  value={code}\n                  height=\"600px\"\n                  theme=\"dark\"\n                  extensions={extensions}\n                  onChange={onChange}\n                  hint=\"true\"\n                />\n              </Grid>\n              <Grid item xs={12}>\n                <Stack\n                  spacing={3}\n                  direction=\"row\"\n                  justifyContent=\"center\"\n                  alignItems=\"space-evenly\"\n                >\n                  <Button onClick={run} variant=\"contained\">\n                    Run\n                  </Button>\n                  <Storage value={code}></Storage>\n                </Stack>\n              </Grid>\n              <Grid item xs={12}>\n                <form onSubmit={uploadFileFormHandler}>\n                  <input type=\"file\" className=\"input\" />\n                  <button type=\"submit\">Upload</button>\n                </form>\n              </Grid>\n              <Grid item xs={12}>\n                <CodeExecutionResWidgit\n                  out={out}\n                  err={err}\n                  clear={clearExecutionRes}\n                />\n              </Grid>\n            </Grid>\n          </Grid>\n        </Grid>\n      </Box>\n      <TeacherRightMenu\n        drawerWidth={drawerWidth}\n        setDisplayStudent={setDisplayStudent}\n        setStudentName={setStudentName}\n        connectedUsers={connectedUsers.filter((user) => user.curUser !== curUser)}\n        setConnectedUsers={setConnectedUsers}\n        socket={socket}\n        roomId={roomId}\n      />\n      <Stack direction=\"row\">\n      <audio playsInline muted ref={localAudio} autoPlay />\n        {peers.map((peer, index) => {\n          return <Audio key={index} peer={peer} />;\n        })}\n      </Stack>\n      <button className=\"call-button\" onClick={() => setupCall()}>\n        {callInprogress ? \"Disconnect\" : \"Call\"}\n      </button>\n    </>\n  );\n}\n\nfunction myPythonCompletions(context: CompletionContext) {\n  let word = context.matchBefore(/\\w*/);\n  if (word.from == word.to && !context.explicit) return null;\n  if (\n    word.text[0] === word.text[0].toUpperCase() &&\n    /^[a-zA-Z]+$/.test(word.text[0])\n  ) {\n    return {\n      from: word.from,\n      options: upperPythonKeys,\n    };\n  }\n  return {\n    from: word.from,\n    options: lowerPythonKeys,\n  };\n}\n\nfunction myJavaCompletions(context: CompletionContext) {\n  let word = context.matchBefore(/\\w*/);\n  if (word.from == word.to && !context.explicit) return null;\n  return {\n    from: word.from,\n    options: javaKeys,\n  };\n}\n\nconst globalPythonCompletions = pythonLanguage.data.of({\n  autocomplete: myPythonCompletions,\n});\n\nconst globalJavaScriptCompletions = javaLanguage.data.of({\n  autocomplete: myJavaCompletions,\n});\n\nexport default TeacherPage;\n"],"mappings":";;;;;+CACA,oJ;;AADA,SAASA,WAAT,EAAsBC,QAAtB,EAAgCC,SAAhC,EAA2CC,YAA3C,EAAyDC,MAAzD,QAAuE,OAAvE;AACA,OAAOC,IAAP,MAAiB,aAAjB;AACA,OAAOC,UAAP,MAAuB,uBAAvB;AACA,OAAOC,UAAP,MAAuB,0BAAvB;AACA,OAAOC,QAAP,MAAqB,wBAArB;AACA,OAAOC,WAAP,MAAwB,2BAAxB;AACA,OAAOC,MAAP,IAAiBC,iBAAjB,QAA0C,sBAA1C;AACA,OAAOC,GAAP,MAAgB,mBAAhB;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,IAAP,MAAiB,oBAAjB;AACA,OAAOC,gBAAP,MAA6B,4BAA7B;AACA,OAAOC,OAAP,MAAoB,uBAApB;AACA,OAAOC,KAAP,MAAkB,qBAAlB;AACA,OAAOC,OAAP,MAAoB,sBAApB;AAEA,SAASC,eAAT,EAA0BC,eAA1B,EAA2CC,QAA3C,QAA2D,YAA3D;AAEA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,mBAAzC;AACA,SAASC,MAAT,EAAiBC,cAAjB,QAAuC,yBAAvC;AACA,SAASC,iBAAT,QAAkC,0BAAlC;AACA,SAASC,UAAT,EAAqBC,kBAArB,QAA+C,6BAA/C;AACA,SAASC,IAAT,EAAeC,YAAf,QAAmC,uBAAnC;AACA,SAASC,qBAAT,EAAgCC,WAAhC,QAAmD,aAAnD;AACA,OAAOC,gBAAP,MAA6B,+BAA7B;AACA,OAAOC,OAAP,MAAoB,uBAApB,C,CACA;;AACA,OAAOC,KAAP,MAAkB,OAAlB,C,CACA;;AACA,OAAOC,sBAAP,MAAmC,qCAAnC;AACA,OAAO,gBAAP,C,CAGA;;AACA,SAASC,OAAT,QAAwB,wBAAxB;AACA,SAASC,GAAT,EAAcC,oBAAd,EAAoCC,cAApC,QAA0D,mBAA1D;AACA,SAASC,OAAT,QAAwB,aAAxB;AAEA,IAAMC,WAAW,GAAG,GAApB,C,CACA;;AACA,IAAIC,CAAC,GAAG,CAAR,C,CAAW;;AAGX,SAASC,WAAT,OAA2D;EAAA;;EAAA,IAApCC,MAAoC,QAApCA,MAAoC;EAAA,IAA5BC,OAA4B,QAA5BA,OAA4B;EAAA,IAAnBC,QAAmB,QAAnBA,QAAmB;EAAA,IAATC,MAAS,QAATA,MAAS;;EACzD;EADyD,gBAEzB/C,QAAQ,CAAC;IAAA,OAAM,YAAN;EAAA,CAAD,CAFiB;EAAA;EAAA,IAElDgD,QAFkD;EAAA,IAExCC,WAFwC;;EAAA,iBAGbjD,QAAQ,CAAC;IAAA,OAAM,KAAN;EAAA,CAAD,CAHK;EAAA;EAAA,IAGlDkD,cAHkD;EAAA,IAGlCC,iBAHkC,kBAIzD;;;EAJyD,iBAKnCnD,QAAQ,CAAC;IAAA,OAAM,EAAN;EAAA,CAAD,CAL2B;EAAA;EAAA,IAKlDoD,GALkD;EAAA,IAK7CC,MAL6C;;EAAA,iBAMjCrD,QAAQ,CAAC,EAAD,CANyB;EAAA;EAAA,IAMlDsD,IANkD;EAAA,IAM5CC,OAN4C;;EAAA,iBAO3BvD,QAAQ,CAAC;IAAA,OAAM,iBAAN;EAAA,CAAD,CAPmB;EAAA;EAAA,IAOlDwD,OAPkD;EAAA,IAOzCC,UAPyC,mBAQzD;;;EARyD,kBASnCzD,QAAQ,CAAC;IAAA,OAAM,IAAN;EAAA,CAAD,CAT2B;EAAA;EAAA,IASlD0D,GATkD;EAAA,IAS7CC,MAT6C;;EAAA,kBAUnC3D,QAAQ,CAAC;IAAA,OAAM,IAAN;EAAA,CAAD,CAV2B;EAAA;EAAA,IAUlD4D,GAVkD;EAAA,IAU7CC,MAV6C;;EAAA,kBAW7B7D,QAAQ,CAAC;IAAA,OAAM,IAAN;EAAA,CAAD,CAXqB;EAAA;EAAA,IAWlD8D,MAXkD;EAAA,IAW1CC,SAX0C;;EAAA,kBAY7B/D,QAAQ,CAAC;IAAA,OAAM,IAAN;EAAA,CAAD,CAZqB;EAAA;EAAA,IAYlDgE,MAZkD;EAAA,IAY1CC,SAZ0C,mBAazD;;;EAbyD,kBAczBjE,QAAQ,CAAC,EAAD,CAdiB;EAAA;EAAA,IAclDkE,QAdkD;EAAA,IAcxCC,WAdwC;;EAAA,kBAejBnE,QAAQ,CAAC,EAAD,CAfS;EAAA;EAAA,IAelDoE,YAfkD;EAAA,IAepCC,eAfoC,mBAgBzD;EACA;;;EAjByD,kBAkBnBrE,QAAQ,CAAC;IAAA,OAAM,EAAN;EAAA,CAAD,CAlBW;EAAA;EAAA,IAkBlDsE,WAlBkD;EAAA,IAkBrCC,cAlBqC;;EAAA,kBAmBbvE,QAAQ,CAAC,EAAD,CAnBK;EAAA;EAAA,IAmBlDwE,cAnBkD;EAAA,IAmBlCC,iBAnBkC;;EAAA,kBAoBrBzE,QAAQ,CAAC;IAAA,OAAM,IAAN;EAAA,CAAD,CApBa;EAAA;EAAA,IAoBlD0E,UApBkD;EAAA,IAoBtCC,aApBsC;;EAAA,kBAqBT3E,QAAQ,CAAC;IAAA,OAAM,KAAN;EAAA,CAAD,CArBC;EAAA;EAAA,IAqBlD4E,gBArBkD;EAAA,IAqBhCC,mBArBgC;;EAAA,kBAsBb7E,QAAQ,CAAC;IAAA,OAAM,KAAN;EAAA,CAAD,CAtBK;EAAA;EAAA,IAsBlD8E,cAtBkD;EAAA,IAsBlCC,iBAtBkC;;EAAA,kBAuB/B/E,QAAQ,CAAC;IAAA,OAAM,EAAN;EAAA,CAAD,CAvBuB;EAAA;EAAA,IAuBlDgF,KAvBkD;EAAA,IAuB3CC,QAvB2C;;EAyBzD,IAAMC,UAAU,GAAG/E,MAAM,EAAzB;EACA,IAAMgF,QAAQ,GAAGhF,MAAM,CAAC,EAAD,CAAvB;EAGA,IAAIiF,UAAU,GAAG,CAAC1D,UAAU,CAAC;IAAE2D,GAAG,EAAE;EAAP,CAAD,CAAX,CAAjB;;EACA,IAAIrC,QAAQ,KAAK,YAAjB,EAA+B;IAC7BoC,UAAU,CAAC,CAAD,CAAV,GAAgB1D,UAAU,CAAC;MAAE2D,GAAG,EAAE;IAAP,CAAD,CAA1B;EACD,CAFD,MAEO,IAAIrC,QAAQ,KAAK,QAAjB,EAA2B;IAChCoC,UAAU,CAAC,CAAD,CAAV,GAAgB7D,MAAM,EAAtB;IACA6D,UAAU,CAAC,CAAD,CAAV,GAAgBE,uBAAhB;EACD,CAHM,MAGA;IACLF,UAAU,CAAC,CAAD,CAAV,GAAgBxD,IAAI,EAApB;IACAwD,UAAU,CAAC,CAAD,CAAV,GAAgBG,2BAAhB;EACD;;EAED,IAAMC,KAAK,GAAG,SAARA,KAAQ,QAAY;IAAA,IAAVC,IAAU,SAAVA,IAAU;IACxB,IAAMpD,GAAG,GAAGlC,MAAM,EAAlB;IAEAF,SAAS,CAAC,YAAM;MACZwF,IAAI,CAACC,EAAL,CAAQ,QAAR,EAAkB,UAAAC,MAAM,EAAI;QACxBC,OAAO,CAACC,GAAR,CAAY,mBAAZ;QACAD,OAAO,CAACC,GAAR,qBAAyBF,MAAzB;QACAtD,GAAG,CAACyD,OAAJ,CAAYC,SAAZ,GAAwBJ,MAAxB;MACH,CAJD;IAKH,CANQ,EAMN,EANM,CAAT;IAQA,oBACI;MAAO,WAAW,MAAlB;MAAmB,QAAQ,MAA3B;MAA4B,GAAG,EAAEtD,GAAjC;MAAA;MAAA;QAAA;QAAA;QAAA;MAAA;IAAA,EADJ;EAGD,CAdD,CAxCyD,CAuDzD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAGA;;;EACA,IAAM2D,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACC,KAAD,EAAW;IACvCA,KAAK,CAACC,cAAN;IACAC,UAAU,CAACF,KAAK,CAACG,MAAN,CAAa,CAAb,EAAgBC,KAAhB,CAAsB,CAAtB,CAAD,CAAV,CAAqCC,IAArC,CAA0C,UAACC,GAAD,EAAS;MACjDA,GAAG,CAACC,IAAJ,CAASC,IAAT,GAAgBH,IAAhB,CAAqB,UAAChD,IAAD,EAAU;QAC7BC,OAAO,CAACD,IAAD,CAAP;QACAa,WAAW,CAACoC,GAAG,CAACrC,QAAL,CAAX;QACAG,eAAe,CAACkC,GAAG,CAACC,IAAJ,CAASE,IAAV,CAAf;MACD,CAJD;IAKD,CAND;EAOD,CATD,CAvEyD,CAmFzD;;;EACA,IAAMP,UAAU,GAAG,SAAbA,UAAa,CAACQ,CAAD,EAAO;IACxB,OAAO,IAAIC,OAAJ,CAAY,UAAUL,GAAV,EAAeM,GAAf,EAAoB;MACrC,IAAI,CAACF,CAAL,EAAQ;QACNf,OAAO,CAACC,GAAR,CAAY,sCAAZ;QACAgB,GAAG;MACJ;;MACD,IAAMC,EAAE,0BAAmBhF,qBAAqB,CAACiF,WAAtB,CAAkCC,MAAlC,CAAyCC,MAAzC,CAAgDC,QAAnE,cAA+EP,CAAC,CAACD,IAAjF,CAAR;MACA,IAAMS,cAAc,GAAG9E,GAAG,CAACD,OAAD,EAAU0E,EAAV,CAA1B;MACA,IAAMM,oBAAoB,GAAG9E,oBAAoB,CAAC6E,cAAD,EAAiBR,CAAjB,CAAjD;MACAS,oBAAoB,CAAC1B,EAArB,CACE,eADF,EAEE,UAAC2B,CAAD,EAAO;QACL,IAAIC,CAAC,GAAG,GAAR;;QACA,IAAID,CAAC,CAACE,UAAF,GAAe,CAAnB,EAAsB;UACpBD,CAAC,GAAGE,IAAI,CAACC,KAAL,CAAYJ,CAAC,CAACK,gBAAF,GAAqBL,CAAC,CAACE,UAAxB,GAAsC,GAAjD,CAAJ;QACD;MACF,CAPH,EAQE,UAAC3D,GAAD,EAAS;QACPgC,OAAO,CAACC,GAAR,CAAYjC,GAAZ;QACAiD,GAAG;MACJ,CAXH,EAYE,YAAM;QACJ;QACA;QACAN,GAAG,CAAC;UAAEC,IAAI,EAAEG,CAAR;UAAWzC,QAAQ,EAAE4C;QAArB,CAAD,CAAH;MACD,CAhBH;IAkBD,CA1BM,CAAP;EA2BD,CA5BD,CApFyD,CAmHzD;;;EACA,IAAMa,uBAAuB,GAAG,SAA1BA,uBAA0B,CAACC,GAAD,EAAS;IACvC,OAAO,IAAIhB,OAAJ,CAAY,UAAUL,GAAV,EAAeM,GAAf,EAAoB;MACrC,IAAIgB,GAAG,GAAG,IAAIC,cAAJ,EAAV,CADqC,CAErC;;MACAD,GAAG,CAACE,YAAJ,GAAmB,MAAnB;;MACAF,GAAG,CAACG,MAAJ,GAAa,UAAC/B,KAAD,EAAW;QACtB,IAAI4B,GAAG,CAACI,MAAJ,IAAc,GAAlB,EAAuB;UACrB1B,GAAG,CAAC;YAAEjD,IAAI,EAAEuE,GAAG,CAACK;UAAZ,CAAD,CAAH;QACD,CAFD,MAEO;UACLtC,OAAO,CAACC,GAAR,CAAYgC,GAAG,CAACI,MAAhB;UACApB,GAAG;QACJ;MACF,CAPD;;MAQAgB,GAAG,CAACM,OAAJ,GAAc,YAAM;QAClBvC,OAAO,CAACC,GAAR,CAAYgC,GAAG,CAACI,MAAhB;QACApB,GAAG;MACJ,CAHD;;MAIAgB,GAAG,CAACO,IAAJ,CAAS,KAAT,EAAgBR,GAAhB;MACAC,GAAG,CAACQ,IAAJ,GAjBqC,CAiBzB;IACb,CAlBM,CAAP;EAmBD,CApBD,CApHyD,CA2IzD;;;EACA,IAAMC,YAAY,GAAG,SAAfA,YAAe,CAACC,YAAD,EAAkB;IACrC,IAAMpB,cAAc,GAAG9E,GAAG,CAACD,OAAD,EAAUmG,YAAV,CAA1B;IACA,OAAOhG,cAAc,CAAC4E,cAAD,CAAd,CAA+Bb,IAA/B,CAAoC,UAACsB,GAAD;MAAA,OACzCD,uBAAuB,CAACC,GAAD,CADkB;IAAA,CAApC,CAAP;EAGD,CALD;;EAQA3H,SAAS,0EAAC;IAAA;IAAA;MAAA;QAAA;UAAA;YAER2F,OAAO,CAACC,GAAR,oCAAwC9C,MAAxC,GAFQ,CAIR;;YACAH,MAAM,CAAC4F,IAAP,CAAY,gBAAZ,EAA8B,SAA9B,EAAyC3F,OAAzC,EAAkDE,MAAlD;YACAH,MAAM,CAACG,MAAP,GAAgBA,MAAhB,CANQ,CAQR;YAEA;;YACAH,MAAM,CAAC4F,IAAP,CAAY,cAAZ,EAA4BzF,MAA5B;YAEAH,MAAM,CAAC8C,EAAP,CAAU,sBAAV,EAAkC,UAAC+C,KAAD,EAAQC,IAAR,EAAc7F,OAAd,EAA0B;cAC1D;cACA,IAAI2B,cAAc,CAACmE,QAAf,CAAwB;gBAAE9F,OAAO,EAAPA,OAAF;gBAAW4F,KAAK,EAALA;cAAX,CAAxB,CAAJ,EAAiD;gBAC/C7C,OAAO,CAACC,GAAR,mCAC6BhD,OAD7B,yCACmE4F,KADnE,QAD+C,CAIjD;cACC,CALD,MAKO;gBAAE;gBACPhE,iBAAiB,CAAC,UAAAmE,aAAa;kBAAA,oCAAQA,aAAR,IAAuB;oBAAE/F,OAAO,EAAPA,OAAF;oBAAW4F,KAAK,EAALA;kBAAX,CAAvB;gBAAA,CAAd,CAAjB;gBACA7C,OAAO,CAACC,GAAR,uCACiChD,OADjC,0BACwD4F,KADxD,yBAC4EC,IAD5E;cAGD,CAZyD,CAa1D;;;cACAvF,iBAAiB,CAAC,UAAAX,OAAO,EAAI;gBAC3B;gBACA,IAAI,CAACA,OAAL,EAAa;kBACXe,OAAO,CAAC,UAAAsF,WAAW,EAAI;oBACrBjG,MAAM,CAAC4F,IAAP,CAAY,aAAZ,EAA2BK,WAA3B,EAAwC9F,MAAxC;oBACA,OAAO8F,WAAP;kBACD,CAHM,CAAP;gBAID,CALD,MAKO;kBAAE;kBACPpF,UAAU,CAAC,UAAAqF,UAAU,EAAI;oBACvBlG,MAAM,CAAC4F,IAAP,CAAY,aAAZ,EAA2BM,UAA3B,EAAuC/F,MAAvC;oBACA,OAAO+F,UAAP;kBACD,CAHS,CAAV;gBAID;;gBACD,OAAOtG,OAAP;cACD,CAdgB,CAAjB;YAgBD,CA9BD;YAgCAI,MAAM,CAAC8C,EAAP,CAAU,yBAAV,EAAqC,UAAC+C,KAAD,EAAQC,IAAR,EAAc7F,OAAd,EAA0B;cAC7D4B,iBAAiB,CAAC,UAAAmE,aAAa,EAAI;gBACjC,IAAMG,QAAQ,sBAAOH,aAAP,CAAd;;gBACA,IAAMI,GAAG,GAAGD,QAAQ,CAACE,SAAT,CAAmB,UAACC,IAAD;kBAAA,OAAUA,IAAI,CAACT,KAAL,KAAeA,KAAzB;gBAAA,CAAnB,CAAZ;;gBACA,IAAIO,GAAG,IAAI,CAAX,EAAc;kBACZpD,OAAO,CAACC,GAAR,CAAY,UAAZ;kBACAkD,QAAQ,CAACI,MAAT,CAAgBH,GAAhB,EAAqB,CAArB;gBACD;;gBACD,OAAOD,QAAP;cACD,CARgB,CAAjB;cAUA1F,MAAM,CAAC,UAAA+F,IAAI,EAAI;gBACb,IAAGX,KAAK,KAAKW,IAAb,EAAmB;kBACjBjG,iBAAiB,CAAC,KAAD,CAAjB;kBACAP,MAAM,CAACQ,GAAP,GAAa,EAAb;kBACA,OAAO,EAAP;gBACD;;gBACD,OAAOgG,IAAP;cACD,CAPK,CAAN,CAX6D,CAoB7D;cACA;cACA;cACA;;cAEAxD,OAAO,CAACC,GAAR,sCAA0C6C,IAA1C,gBAAoD7F,OAApD,0BAA2E4F,KAA3E;YACD,CA1BD;YA4BA7F,MAAM,CAAC8C,EAAP,CAAU,cAAV,EAA0B,UAAC2D,MAAD,EAASnC,QAAT,EAAsB;cAC9CtB,OAAO,CAACC,GAAR,CACE,0DADF,EAC8DwD,MAD9D,EAEE,qBAFF,EAEyBnC,QAFzB,EAD8C,CAK9C;;cACA,IAAI,CAAC1C,cAAc,CAACmE,QAAf,CAAwB;gBAAE9F,OAAO,EAAEqE,QAAX;gBAAqBmC,MAAM,EAANA;cAArB,CAAxB,CAAL,EACE5E,iBAAiB,CAAC,UAAAmE,aAAa;gBAAA,oCAAQA,aAAR,IAAuB;kBAAE/F,OAAO,EAAEqE,QAAX;kBAAqBuB,KAAK,EAAEY;gBAA5B,CAAvB;cAAA,CAAd,CAAjB,CAP4C,CAQ9C;;cACAzG,MAAM,CAAC4F,IAAP,CAAY,aAAZ,EAA2BlF,IAA3B,EAAiCP,MAAjC;YACD,CAVD;YAYAH,MAAM,CAAC8C,EAAP,CAAU,YAAV,EAAwB,UAACpC,IAAD,EAAOF,GAAP,EAAe;cACrC;cACAC,MAAM,CAACD,GAAD,CAAN;cACAR,MAAM,CAACQ,GAAP,GAAaA,GAAb;cACAR,MAAM,CAAC8C,EAAP,GAAY,IAAZ;cAEAjC,UAAU,CAAC,YAAM;gBACfb,MAAM,CAAC4F,IAAP,CAAY,aAAZ,EAA2BlF,IAA3B,EAAiCP,MAAjC;gBACA,OAAOO,IAAP;cACD,CAHS,CAAV;YAID,CAVD;YAYAV,MAAM,CAAC8C,EAAP,CAAU,UAAV,EAAsB,UAAC4D,KAAD,EAAQC,EAAR,EAAe;cACnC9F,UAAU,CAAC,YAAM;gBACfb,MAAM,CAAC4F,IAAP,CAAY,aAAZ,EAA2Bc,KAA3B,EAAkCvG,MAAlC;gBACA,OAAOuG,KAAP;cACD,CAHS,CAAV;YAID,CALD,EAjGQ,CAwGR;;YACA1G,MAAM,CAAC8C,EAAP,CAAU,YAAV,EAAwB,UAAC8D,GAAD,EAAS;cAC/B5G,MAAM,CAACQ,GAAP,GAAa,EAAb;cACAC,MAAM,CAAC,EAAD,CAAN;cACAT,MAAM,CAAC8C,EAAP,GAAY,IAAZ;cACAjC,UAAU,CAAC+F,GAAD,CAAV;YACD,CALD,EAzGQ,CAgHR;;YACA,IAAIlG,IAAI,KAAK,EAAT,IAAeY,QAAQ,KAAK,EAA5B,IAAkCE,YAAY,KAAK,EAAvD,EAA2D;cACrD0C,EADqD,GAChD,8BADgD;cAEzDwB,YAAY,CAACxB,EAAD,CAAZ,CACGR,IADH,CACQ,UAACC,GAAD,EAAS;gBACb,IAAMI,CAAC,GAAG,IAAI8C,IAAJ,CAAS,CAAClD,GAAG,CAACjD,IAAL,CAAT,EAAqB,qBAArB,CAAV;gBACA,OAAO6C,UAAU,CAACQ,CAAD,CAAjB;cACD,CAJH,EAKGL,IALH,CAKQ,UAACC,GAAD,EAAS;gBACbA,GAAG,CAACC,IAAJ,CAASC,IAAT,GAAgBH,IAAhB,CAAqB,UAAChD,IAAD,EAAU;kBAC7BC,OAAO,CAACD,IAAD,CAAP;kBACAa,WAAW,CAACoC,GAAG,CAACrC,QAAL,CAAX;kBACAG,eAAe,CAACkC,GAAG,CAACC,IAAJ,CAASE,IAAV,CAAf;gBACD,CAJD;cAKD,CAXH;YAYD,CA/HO,CA+HN;;;YAEFd,OAAO,CAACC,GAAR,CAAY,4BAAZ;;UAjIQ;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAAD,IAkIN,EAlIM,CAAT;EAoIA5F,SAAS,CAAC,YAAM;IACd,IAAI2E,gBAAJ,EAAsB;MACpBgB,OAAO,CAACC,GAAR,CAAY,qBAAZ;MACAjD,MAAM,CAAC8C,EAAP,CAAU,WAAV,EAAuB,UAACgE,KAAD,EAAW;QAChC9D,OAAO,CAACC,GAAR,CAAY6D,KAAZ;QACA,IAAM1E,KAAK,GAAG,EAAd;QACA0E,KAAK,CAACC,OAAN,CAAc,UAACC,MAAD,EAAY;UACxBhE,OAAO,CAACC,GAAR,qBAAyBnB,UAAzB;UACA,IAAMe,IAAI,GAAGoE,UAAU,CAACD,MAAD,EAAShH,MAAM,CAAC2G,EAAhB,EAAoB7E,UAApB,CAAvB;UACAS,QAAQ,CAACW,OAAT,CAAiBgE,IAAjB,CAAsB;YACpBC,MAAM,EAAEH,MADY;YAEpBnE,IAAI,EAAJA;UAFoB,CAAtB;UAIAT,KAAK,CAAC8E,IAAN,CAAWrE,IAAX;QACD,CARD;QASAG,OAAO,CAACC,GAAR,qBAAyBb,KAAzB;QACAC,QAAQ,CAACD,KAAD,CAAR;MACD,CAdD;MAgBApC,MAAM,CAAC8C,EAAP,CAAU,aAAV,EAAyB,UAACsE,OAAD,EAAa;QACpCpE,OAAO,CAACC,GAAR,CAAY,aAAZ;QACAD,OAAO,CAACC,GAAR,qBAAyBnB,UAAzB;QACA,IAAMe,IAAI,GAAGwE,OAAO,CAACD,OAAO,CAACE,MAAT,EAAiBF,OAAO,CAACG,QAAzB,EAAmCzF,UAAnC,CAApB;QACAS,QAAQ,CAACW,OAAT,CAAiBgE,IAAjB,CAAsB;UACpBC,MAAM,EAAEC,OAAO,CAACG,QADI;UAEpB1E,IAAI,EAAJA;QAFoB,CAAtB;QAKAR,QAAQ,CAAC,UAACyE,KAAD;UAAA,oCAAeA,KAAf,IAAsBjE,IAAtB;QAAA,CAAD,CAAR;MACD,CAVD;MAYA7C,MAAM,CAAC8C,EAAP,CAAU,2BAAV,EAAuC,UAACsE,OAAD,EAAa;QAClDpE,OAAO,CAACC,GAAR,CAAY,2BAAZ;QACAD,OAAO,CAACC,GAAR,CAAYV,QAAQ,CAACW,OAArB;QACAF,OAAO,CAACC,GAAR,CAAYmE,OAAO,CAACT,EAApB;QACA,IAAMa,IAAI,GAAGjF,QAAQ,CAACW,OAAT,CAAiBuE,IAAjB,CAAsB,UAAC/C,CAAD;UAAA,OAAOA,CAAC,CAACyC,MAAF,KAAaC,OAAO,CAACT,EAA5B;QAAA,CAAtB,CAAb;QACA3D,OAAO,CAACC,GAAR,CAAYuE,IAAZ;QACAA,IAAI,CAAC3E,IAAL,CAAUyE,MAAV,CAAiBF,OAAO,CAACE,MAAzB;MACD,CAPD;IAQD;EACF,CAxCQ,EAwCN,CAACtF,gBAAD,CAxCM,CAAT,CAxRyD,CAmUzD;;EACA3E,SAAS,CAAC,YAAM;IACd,IAAG,CAACiD,cAAJ,EAAoBN,MAAM,CAAC4F,IAAP,CAAY,aAAZ,EAA2BlF,IAA3B,EAAiCP,MAAjC;IAEpB,IAAGG,cAAH,EAAmBN,MAAM,CAAC4F,IAAP,CAAY,aAAZ,EAA2BhF,OAA3B,EAAoCT,MAApC;EAEpB,CALQ,EAKP,CAACG,cAAD,CALO,CAAT;;EAQA,IAAMoH,QAAQ,GAAG,SAAXA,QAAW,CAAChB,KAAD,EAAQiB,UAAR,EAAuB;IACtC,IAAI,CAACrH,cAAL,EAAqBN,MAAM,CAAC4F,IAAP,CAAY,aAAZ,EAA2Bc,KAA3B,EAAkCvG,MAAlC;IACrBQ,OAAO,CAAC+F,KAAD,CAAP;EACD,CAHD;;EAMA,IAAMkB,WAAW,GAAG,SAAdA,WAAc,CAAClB,KAAD,EAAQiB,UAAR,EAAuB;IACzC,IAAME,MAAM,GAAGF,UAAU,CAACG,KAAX,CAAiBC,MAAjB,CAAwB,CAAxB,EAA2BC,aAA1C;;IACA,IAAIH,MAAJ,EAAY;MACV7H,MAAM,CAAC4F,IAAP,CAAY,UAAZ,EAAwBc,KAAxB,EAA+B1G,MAAM,CAACQ,GAAtC,EAA2CL,MAA3C;MACAH,MAAM,CAAC4F,IAAP,CAAY,aAAZ,EAA2Bc,KAA3B,EAAkCvG,MAAlC;IACD;;IACDU,UAAU,CAAC6F,KAAD,CAAV;EACD,CAPD;;EAUA,IAAMuB,GAAG,GAAG,SAANA,GAAM,GAAM;IAChBjF,OAAO,CAACC,GAAR,CAAYvC,IAAZ;;IADgB,eAEKrB,OAAO,CAACqB,IAAD,EAAON,QAAP,CAFZ;IAAA,IAERU,GAFQ,YAERA,GAFQ;IAAA,IAEHE,GAFG,YAEHA,GAFG;;IAGhBD,MAAM,CAACD,GAAD,CAAN;IACAG,MAAM,CAACD,GAAD,CAAN;EACD,CALD;;EAQA,IAAMkH,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;IAC9BnH,MAAM,CAAC,IAAD,CAAN;IACAE,MAAM,CAAC,IAAD,CAAN;EACD,CAHD;;EAMA,IAAMkH,UAAU,GAAG,SAAbA,UAAa,GAAM;IACvBnF,OAAO,CAACC,GAAR,CAAYrC,OAAZ;;IADuB,gBAEFvB,OAAO,CAACuB,OAAD,EAAUR,QAAV,CAFL;IAAA,IAEfU,GAFe,aAEfA,GAFe;IAAA,IAEVE,GAFU,aAEVA,GAFU;;IAGvBG,SAAS,CAACL,GAAD,CAAT;IACAO,SAAS,CAACL,GAAD,CAAT;EACD,CALD;;EAOA,IAAMoH,SAAS;IAAA,uEAAG;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA,IACXlG,cADW;gBAAA;gBAAA;cAAA;;cAEdc,OAAO,CAACC,GAAR,CAAY,gBAAZ;cAFc;cAAA,OAGYoF,SAAS,CAACC,YAAV,CAAuBC,YAAvB,CAAoC;gBAC5DC,KAAK,EAAE,KADqD;gBAE5DC,KAAK,EAAE;cAFqD,CAApC,CAHZ;;YAAA;cAGRC,WAHQ;cAOd1F,OAAO,CAACC,GAAR,CAAY,yBAAZ;cACAlB,aAAa,CAAC2G,WAAD,CAAb;cACAzG,mBAAmB,CAAC,IAAD,CAAnB;;cACA,IAAIK,UAAU,CAACY,OAAf,EAAwB;gBACtBZ,UAAU,CAACY,OAAX,CAAmBC,SAAnB,GAA+BuF,WAA/B;gBACA1F,OAAO,CAACC,GAAR,CAAY,2BAAZ;cACD,CAba,CAcd;;;cACAjD,MAAM,CAAC4F,IAAP,CAAY,aAAZ,EAA2B1F,QAA3B,EAfc,CAgBd;;cACAiC,iBAAiB,CAAC,IAAD,CAAjB;cAjBc;cAAA;;YAAA;cAmBda,OAAO,CAACC,GAAR,CAAY,cAAZ;cAEAd,iBAAiB,CAAC,KAAD,CAAjB;;YArBc;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAAH;;IAAA,gBAATiG,SAAS;MAAA;IAAA;EAAA,GAAf;;EAyBA,SAASnB,UAAT,CAAoB0B,UAApB,EAAgCpB,QAAhC,EAA0CxE,MAA1C,EAAkD;IAChDC,OAAO,CAACC,GAAR,qBAAyBF,MAAzB;IACA,IAAMF,IAAI,GAAG,IAAIrF,IAAJ,CAAS;MACpBoL,SAAS,EAAE,IADS;MAEpBC,OAAO,EAAE,KAFW;MAGpB9F,MAAM,EAANA;IAHoB,CAAT,CAAb;IAMAF,IAAI,CAACC,EAAL,CAAQ,QAAR,EAAkB,UAACwE,MAAD,EAAY;MAC5BtE,OAAO,CAACC,GAAR,gDAC0CjD,MAAM,CAAC2G,EADjD,iBAC0DgC,UAD1D;MAGA3I,MAAM,CAAC4F,IAAP,CAAY,gBAAZ,EAA8B;QAAE+C,UAAU,EAAVA,UAAF;QAAcpB,QAAQ,EAARA,QAAd;QAAwBD,MAAM,EAANA;MAAxB,CAA9B;IACD,CALD;IAMA,OAAOzE,IAAP;EACD;;EAED,SAASwE,OAAT,CAAiByB,cAAjB,EAAiCvB,QAAjC,EAA2CxE,MAA3C,EAAmD;IACjDC,OAAO,CAACC,GAAR,qBAAyBF,MAAzB;IACA,IAAMF,IAAI,GAAG,IAAIrF,IAAJ,CAAS;MACpBoL,SAAS,EAAE,KADS;MAEpBC,OAAO,EAAE,KAFW;MAGpB9F,MAAM,EAANA;IAHoB,CAAT,CAAb;IAKAF,IAAI,CAACC,EAAL,CAAQ,QAAR,EAAkB,UAACwE,MAAD,EAAY;MAC5BtH,MAAM,CAAC4F,IAAP,CAAY,kBAAZ,EAAgC;QAAE0B,MAAM,EAANA,MAAF;QAAUC,QAAQ,EAARA;MAAV,CAAhC;IACD,CAFD;IAGA1E,IAAI,CAACyE,MAAL,CAAYwB,cAAZ;IAEA,OAAOjG,IAAP;EACD;;EAGD,IAAMkG,oBAAoB,GAAG,SAAvBA,oBAAuB,GAAM;IACjC5H,SAAS,CAAC,IAAD,CAAT;IACAE,SAAS,CAAC,IAAD,CAAT;EACD,CAHD;;EAMA,oBACE,uDACE,oBAAC,GAAD;IACE,EAAE,EAAE;MACF2H,QAAQ,EAAE,CADR;MAEFtE,CAAC,EAAE,CAFD;MAGFuE,KAAK,EAAE;QAAEC,EAAE,wBAAiBrJ,WAAjB;MAAJ;IAHL,CADN;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBAOE,oBAAC,OAAD;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EAPF,eAQE,oBAAC,IAAD;IAAM,SAAS,MAAf;IAAgB,OAAO,EAAE,CAAzB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GACGS,cAAc,gBACb,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,CAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,IAAD;IACE,SAAS,MADX;IAEE,SAAS,EAAC,QAFZ;IAGE,UAAU,EAAC,SAHb;IAIE,UAAU,EAAE,CAJd;IAKE,aAAa,EAAE,CALjB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBAOE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gCAA6BoB,WAA7B,MADF,CAPF,eAWE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,UAAD;IACE,KAAK,EAAEd,OADT;IAEE,MAAM,EAAC,OAFT;IAGE,KAAK,EAAC,MAHR;IAIE,UAAU,EAAE4B,UAJd;IAKE,QAAQ,EAAEoF,WALZ;IAME,IAAI,EAAC,MANP;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EADF,CAXF,eAqBE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,KAAD;IAAO,OAAO,EAAE,CAAhB;IAAmB,SAAS,EAAC,KAA7B;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,MAAD;IAAQ,OAAO,EAAEO,UAAjB;IAA6B,OAAO,EAAC,WAArC;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,SADF,CADF,CArBF,eA4BE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,sBAAD;IACE,GAAG,EAAEjH,MADP;IAEE,GAAG,EAAEE,MAFP;IAGE,KAAK,EAAE2H,oBAHT;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EADF,CA5BF,CADF,CADa,GAuCX,IAxCN,eA0CE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAEzI,cAAc,GAAG,CAAH,GAAO,EAApC;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,IAAD;IACE,SAAS,MADX;IAEE,SAAS,EAAC,QAFZ;IAGE,UAAU,EAAC,SAHb;IAIE,UAAU,EAAE,CAJd;IAKE,aAAa,EAAE,CALjB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBAOE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,gBAAD;IACE,QAAQ,EAAEF,QADZ;IAEE,gBAAgB,EAAE,0BAAC+I,CAAD;MAAA,OAAO9I,WAAW,CAAC8I,CAAC,CAAC3F,MAAF,CAASkD,KAAV,CAAlB;IAAA,CAFpB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EADF,CAPF,eAaE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,4BADF,CAbF,eAgBE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBAEE,oBAAC,UAAD;IACE,KAAK,EAAEhG,IADT;IAEE,MAAM,EAAC,OAFT;IAGE,KAAK,EAAC,MAHR;IAIE,UAAU,EAAE8B,UAJd;IAKE,QAAQ,EAAEkF,QALZ;IAME,IAAI,EAAC,MANP;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EAFF,CAhBF,eA2BE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,KAAD;IACE,OAAO,EAAE,CADX;IAEE,SAAS,EAAC,KAFZ;IAGE,cAAc,EAAC,QAHjB;IAIE,UAAU,EAAC,cAJb;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBAME,oBAAC,MAAD;IAAQ,OAAO,EAAEO,GAAjB;IAAsB,OAAO,EAAC,WAA9B;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,SANF,eASE,oBAAC,OAAD;IAAS,KAAK,EAAEvH,IAAhB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EATF,CADF,CA3BF,eAwCE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE;IAAM,QAAQ,EAAE0C,qBAAhB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE;IAAO,IAAI,EAAC,MAAZ;IAAmB,SAAS,EAAC,OAA7B;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EADF,eAEE;IAAQ,IAAI,EAAC,QAAb;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,YAFF,CADF,CAxCF,eA8CE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,sBAAD;IACE,GAAG,EAAEtC,GADP;IAEE,GAAG,EAAEE,GAFP;IAGE,KAAK,EAAEkH,iBAHT;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EADF,CA9CF,CADF,CA1CF,CARF,CADF,eA6GE,oBAAC,gBAAD;IACE,WAAW,EAAErI,WADf;IAEE,iBAAiB,EAAEU,iBAFrB;IAGE,cAAc,EAAEoB,cAHlB;IAIE,cAAc,EAAEC,cAAc,CAACwH,MAAf,CAAsB,UAAC9C,IAAD;MAAA,OAAUA,IAAI,CAACrG,OAAL,KAAiBA,OAA3B;IAAA,CAAtB,CAJlB;IAKE,iBAAiB,EAAE4B,iBALrB;IAME,MAAM,EAAE7B,MANV;IAOE,MAAM,EAAEG,MAPV;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EA7GF,eAsHE,oBAAC,KAAD;IAAO,SAAS,EAAC,KAAjB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACA;IAAO,WAAW,MAAlB;IAAmB,KAAK,MAAxB;IAAyB,GAAG,EAAEmC,UAA9B;IAA0C,QAAQ,MAAlD;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EADA,EAEGF,KAAK,CAACiH,GAAN,CAAU,UAACxG,IAAD,EAAOyG,KAAP,EAAiB;IAC1B,oBAAO,oBAAC,KAAD;MAAO,GAAG,EAAEA,KAAZ;MAAmB,IAAI,EAAEzG,IAAzB;MAAA;MAAA;QAAA;QAAA;QAAA;MAAA;IAAA,EAAP;EACD,CAFA,CAFH,CAtHF,eA4HE;IAAQ,SAAS,EAAC,aAAlB;IAAgC,OAAO,EAAE;MAAA,OAAMuF,SAAS,EAAf;IAAA,CAAzC;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GACGlG,cAAc,GAAG,YAAH,GAAkB,MADnC,CA5HF,CADF;AAkID;;AAED,SAASqH,mBAAT,CAA6BC,OAA7B,EAAyD;EACvD,IAAIC,IAAI,GAAGD,OAAO,CAACE,WAAR,CAAoB,KAApB,CAAX;EACA,IAAID,IAAI,CAACE,IAAL,IAAaF,IAAI,CAACG,EAAlB,IAAwB,CAACJ,OAAO,CAACK,QAArC,EAA+C,OAAO,IAAP;;EAC/C,IACEJ,IAAI,CAAC5F,IAAL,CAAU,CAAV,MAAiB4F,IAAI,CAAC5F,IAAL,CAAU,CAAV,EAAaiG,WAAb,EAAjB,IACA,cAAcC,IAAd,CAAmBN,IAAI,CAAC5F,IAAL,CAAU,CAAV,CAAnB,CAFF,EAGE;IACA,OAAO;MACL8F,IAAI,EAAEF,IAAI,CAACE,IADN;MAELK,OAAO,EAAE1L;IAFJ,CAAP;EAID;;EACD,OAAO;IACLqL,IAAI,EAAEF,IAAI,CAACE,IADN;IAELK,OAAO,EAAEzL;EAFJ,CAAP;AAID;;AAED,SAAS0L,iBAAT,CAA2BT,OAA3B,EAAuD;EACrD,IAAIC,IAAI,GAAGD,OAAO,CAACE,WAAR,CAAoB,KAApB,CAAX;EACA,IAAID,IAAI,CAACE,IAAL,IAAaF,IAAI,CAACG,EAAlB,IAAwB,CAACJ,OAAO,CAACK,QAArC,EAA+C,OAAO,IAAP;EAC/C,OAAO;IACLF,IAAI,EAAEF,IAAI,CAACE,IADN;IAELK,OAAO,EAAExL;EAFJ,CAAP;AAID;;AAED,IAAMkE,uBAAuB,GAAG9D,cAAc,CAACsL,IAAf,CAAoBC,EAApB,CAAuB;EACrDC,YAAY,EAAEb;AADuC,CAAvB,CAAhC;AAIA,IAAM5G,2BAA2B,GAAG1D,YAAY,CAACiL,IAAb,CAAkBC,EAAlB,CAAqB;EACvDC,YAAY,EAAEH;AADyC,CAArB,CAApC;AAIA,eAAelK,WAAf"},"metadata":{},"sourceType":"module"}
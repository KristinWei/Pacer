{"ast":null,"code":"import _asyncToGenerator from \"/Users/kw/Desktop/cscc09/project-pacer/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"/Users/kw/Desktop/cscc09/project-pacer/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/Users/kw/Desktop/cscc09/project-pacer/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/kw/Desktop/cscc09/project-pacer/frontend/src/TeacherPage.jsx\";\n\nfunction _regeneratorRuntime() { \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return exports; }; var exports = {}, Op = Object.prototype, hasOwn = Op.hasOwnProperty, $Symbol = \"function\" == typeof Symbol ? Symbol : {}, iteratorSymbol = $Symbol.iterator || \"@@iterator\", asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\", toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\"; function define(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: !0, configurable: !0, writable: !0 }), obj[key]; } try { define({}, \"\"); } catch (err) { define = function define(obj, key, value) { return obj[key] = value; }; } function wrap(innerFn, outerFn, self, tryLocsList) { var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator, generator = Object.create(protoGenerator.prototype), context = new Context(tryLocsList || []); return generator._invoke = function (innerFn, self, context) { var state = \"suspendedStart\"; return function (method, arg) { if (\"executing\" === state) throw new Error(\"Generator is already running\"); if (\"completed\" === state) { if (\"throw\" === method) throw arg; return doneResult(); } for (context.method = method, context.arg = arg;;) { var delegate = context.delegate; if (delegate) { var delegateResult = maybeInvokeDelegate(delegate, context); if (delegateResult) { if (delegateResult === ContinueSentinel) continue; return delegateResult; } } if (\"next\" === context.method) context.sent = context._sent = context.arg;else if (\"throw\" === context.method) { if (\"suspendedStart\" === state) throw state = \"completed\", context.arg; context.dispatchException(context.arg); } else \"return\" === context.method && context.abrupt(\"return\", context.arg); state = \"executing\"; var record = tryCatch(innerFn, self, context); if (\"normal\" === record.type) { if (state = context.done ? \"completed\" : \"suspendedYield\", record.arg === ContinueSentinel) continue; return { value: record.arg, done: context.done }; } \"throw\" === record.type && (state = \"completed\", context.method = \"throw\", context.arg = record.arg); } }; }(innerFn, self, context), generator; } function tryCatch(fn, obj, arg) { try { return { type: \"normal\", arg: fn.call(obj, arg) }; } catch (err) { return { type: \"throw\", arg: err }; } } exports.wrap = wrap; var ContinueSentinel = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var IteratorPrototype = {}; define(IteratorPrototype, iteratorSymbol, function () { return this; }); var getProto = Object.getPrototypeOf, NativeIteratorPrototype = getProto && getProto(getProto(values([]))); NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype); var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype); function defineIteratorMethods(prototype) { [\"next\", \"throw\", \"return\"].forEach(function (method) { define(prototype, method, function (arg) { return this._invoke(method, arg); }); }); } function AsyncIterator(generator, PromiseImpl) { function invoke(method, arg, resolve, reject) { var record = tryCatch(generator[method], generator, arg); if (\"throw\" !== record.type) { var result = record.arg, value = result.value; return value && \"object\" == typeof value && hasOwn.call(value, \"__await\") ? PromiseImpl.resolve(value.__await).then(function (value) { invoke(\"next\", value, resolve, reject); }, function (err) { invoke(\"throw\", err, resolve, reject); }) : PromiseImpl.resolve(value).then(function (unwrapped) { result.value = unwrapped, resolve(result); }, function (error) { return invoke(\"throw\", error, resolve, reject); }); } reject(record.arg); } var previousPromise; this._invoke = function (method, arg) { function callInvokeWithMethodAndArg() { return new PromiseImpl(function (resolve, reject) { invoke(method, arg, resolve, reject); }); } return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); }; } function maybeInvokeDelegate(delegate, context) { var method = delegate.iterator[context.method]; if (undefined === method) { if (context.delegate = null, \"throw\" === context.method) { if (delegate.iterator.return && (context.method = \"return\", context.arg = undefined, maybeInvokeDelegate(delegate, context), \"throw\" === context.method)) return ContinueSentinel; context.method = \"throw\", context.arg = new TypeError(\"The iterator does not provide a 'throw' method\"); } return ContinueSentinel; } var record = tryCatch(method, delegate.iterator, context.arg); if (\"throw\" === record.type) return context.method = \"throw\", context.arg = record.arg, context.delegate = null, ContinueSentinel; var info = record.arg; return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, \"return\" !== context.method && (context.method = \"next\", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = \"throw\", context.arg = new TypeError(\"iterator result is not an object\"), context.delegate = null, ContinueSentinel); } function pushTryEntry(locs) { var entry = { tryLoc: locs[0] }; 1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry); } function resetTryEntry(entry) { var record = entry.completion || {}; record.type = \"normal\", delete record.arg, entry.completion = record; } function Context(tryLocsList) { this.tryEntries = [{ tryLoc: \"root\" }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0); } function values(iterable) { if (iterable) { var iteratorMethod = iterable[iteratorSymbol]; if (iteratorMethod) return iteratorMethod.call(iterable); if (\"function\" == typeof iterable.next) return iterable; if (!isNaN(iterable.length)) { var i = -1, next = function next() { for (; ++i < iterable.length;) { if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next; } return next.value = undefined, next.done = !0, next; }; return next.next = next; } } return { next: doneResult }; } function doneResult() { return { value: undefined, done: !0 }; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, define(Gp, \"constructor\", GeneratorFunctionPrototype), define(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, \"GeneratorFunction\"), exports.isGeneratorFunction = function (genFun) { var ctor = \"function\" == typeof genFun && genFun.constructor; return !!ctor && (ctor === GeneratorFunction || \"GeneratorFunction\" === (ctor.displayName || ctor.name)); }, exports.mark = function (genFun) { return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, \"GeneratorFunction\")), genFun.prototype = Object.create(Gp), genFun; }, exports.awrap = function (arg) { return { __await: arg }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () { return this; }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) { void 0 === PromiseImpl && (PromiseImpl = Promise); var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl); return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) { return result.done ? result.value : iter.next(); }); }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, \"Generator\"), define(Gp, iteratorSymbol, function () { return this; }), define(Gp, \"toString\", function () { return \"[object Generator]\"; }), exports.keys = function (object) { var keys = []; for (var key in object) { keys.push(key); } return keys.reverse(), function next() { for (; keys.length;) { var key = keys.pop(); if (key in object) return next.value = key, next.done = !1, next; } return next.done = !0, next; }; }, exports.values = values, Context.prototype = { constructor: Context, reset: function reset(skipTempReset) { if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) { \"t\" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined); } }, stop: function stop() { this.done = !0; var rootRecord = this.tryEntries[0].completion; if (\"throw\" === rootRecord.type) throw rootRecord.arg; return this.rval; }, dispatchException: function dispatchException(exception) { if (this.done) throw exception; var context = this; function handle(loc, caught) { return record.type = \"throw\", record.arg = exception, context.next = loc, caught && (context.method = \"next\", context.arg = undefined), !!caught; } for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i], record = entry.completion; if (\"root\" === entry.tryLoc) return handle(\"end\"); if (entry.tryLoc <= this.prev) { var hasCatch = hasOwn.call(entry, \"catchLoc\"), hasFinally = hasOwn.call(entry, \"finallyLoc\"); if (hasCatch && hasFinally) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } else if (hasCatch) { if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0); } else { if (!hasFinally) throw new Error(\"try statement without catch or finally\"); if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc); } } } }, abrupt: function abrupt(type, arg) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc <= this.prev && hasOwn.call(entry, \"finallyLoc\") && this.prev < entry.finallyLoc) { var finallyEntry = entry; break; } } finallyEntry && (\"break\" === type || \"continue\" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null); var record = finallyEntry ? finallyEntry.completion : {}; return record.type = type, record.arg = arg, finallyEntry ? (this.method = \"next\", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record); }, complete: function complete(record, afterLoc) { if (\"throw\" === record.type) throw record.arg; return \"break\" === record.type || \"continue\" === record.type ? this.next = record.arg : \"return\" === record.type ? (this.rval = this.arg = record.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel; }, finish: function finish(finallyLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel; } }, catch: function _catch(tryLoc) { for (var i = this.tryEntries.length - 1; i >= 0; --i) { var entry = this.tryEntries[i]; if (entry.tryLoc === tryLoc) { var record = entry.completion; if (\"throw\" === record.type) { var thrown = record.arg; resetTryEntry(entry); } return thrown; } } throw new Error(\"illegal catch attempt\"); }, delegateYield: function delegateYield(iterable, resultName, nextLoc) { return this.delegate = { iterator: values(iterable), resultName: resultName, nextLoc: nextLoc }, \"next\" === this.method && (this.arg = undefined), ContinueSentinel; } }, exports; }\n\nimport { useState, useEffect, useRef } from \"react\";\nimport Peer from \"simple-peer\";\nimport CodeMirror from \"@uiw/react-codemirror\";\nimport Box from \"@mui/material/Box\";\nimport Button from \"@mui/material/Button\";\nimport Grid from \"@mui/material/Grid\";\nimport EditorOptionsBar from \"./components/EditorOptions\";\nimport Toolbar from \"@mui/material/Toolbar\";\nimport Stack from \"@mui/material/Stack\";\nimport Storage from \"./components/Storage\";\nimport { upperPythonKeys, lowerPythonKeys, javaKeys } from \"./_helpers\";\nimport { python, pythonLanguage } from \"@codemirror/lang-python\";\nimport { CompletionContext } from \"@codemirror/autocomplete\";\nimport { javascript, javascriptLanguage } from \"@codemirror/lang-javascript\";\nimport { java, javaLanguage } from \"@codemirror/lang-java\";\nimport { authenticationService } from \"./_services\";\nimport TeacherRightMenu from \"./components/TeacherRightMenu\";\nimport runCode from \"./_helpers/codeRunner\";\nimport React from \"react\";\nimport CodeExecutionResWidgit from \"./components/CodeExecutionResWidgit\";\nimport \"./CodePage.css\";\nimport { storage } from \"./_components/FireBase\";\nimport { ref, uploadBytesResumable, getDownloadURL, listAll, deleteObject, getMetadata } from \"@firebase/storage\";\nvar drawerWidth = 160;\nvar t = 0; //ns\n\nvar Audio = function Audio(_ref) {\n  var peer = _ref.peer;\n  var ref = useRef();\n  useEffect(function () {\n    peer.on(\"stream\", function (stream) {\n      ref.current.srcObject = stream;\n    });\n  }, []);\n  return /*#__PURE__*/React.createElement(\"audio\", {\n    playsInline: true,\n    autoPlay: true,\n    ref: ref,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 41,\n      columnNumber: 7\n    }\n  });\n};\n\nfunction TeacherPage(_ref2) {\n  var _this2 = this;\n\n  var socket = _ref2.socket,\n      curUser = _ref2.curUser,\n      roomId = _ref2.roomId,\n      setSocketFlag = _ref2.setSocketFlag;\n\n  // code mirror config\n  var _useState = useState(function () {\n    return \"javascript\";\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      language = _useState2[0],\n      setLanguage = _useState2[1];\n\n  var _useState3 = useState(function () {\n    return false;\n  }),\n      _useState4 = _slicedToArray(_useState3, 2),\n      displayStudent = _useState4[0],\n      setDisplayStudent = _useState4[1]; // code display and transmission\n\n\n  var _useState5 = useState(function () {\n    return \"\";\n  }),\n      _useState6 = _slicedToArray(_useState5, 2),\n      sid = _useState6[0],\n      setSid = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      _useState8 = _slicedToArray(_useState7, 2),\n      code = _useState8[0],\n      setCode = _useState8[1];\n\n  var _useState9 = useState(function () {\n    return \"no student here\";\n  }),\n      _useState10 = _slicedToArray(_useState9, 2),\n      stuCode = _useState10[0],\n      setStuCode = _useState10[1]; // execution\n\n\n  var _useState11 = useState(function () {\n    return null;\n  }),\n      _useState12 = _slicedToArray(_useState11, 2),\n      out = _useState12[0],\n      setOut = _useState12[1];\n\n  var _useState13 = useState(function () {\n    return null;\n  }),\n      _useState14 = _slicedToArray(_useState13, 2),\n      err = _useState14[0],\n      setErr = _useState14[1];\n\n  var _useState15 = useState(function () {\n    return null;\n  }),\n      _useState16 = _slicedToArray(_useState15, 2),\n      stuOut = _useState16[0],\n      setStuOut = _useState16[1];\n\n  var _useState17 = useState(function () {\n    return null;\n  }),\n      _useState18 = _slicedToArray(_useState17, 2),\n      stuErr = _useState18[0],\n      setStuErr = _useState18[1];\n\n  var _useState19 = useState(function () {\n    return false;\n  }),\n      _useState20 = _slicedToArray(_useState19, 2),\n      loadPageComplete = _useState20[0],\n      setLoadPageComplete = _useState20[1]; // save and load\n\n\n  var _useState21 = useState(\"\"),\n      _useState22 = _slicedToArray(_useState21, 2),\n      codePath = _useState22[0],\n      setCodePath = _useState22[1];\n\n  var _useState23 = useState(\"\"),\n      _useState24 = _slicedToArray(_useState23, 2),\n      codeFilename = _useState24[0],\n      setCodeFilename = _useState24[1]; // audio call\n\n\n  var _useState25 = useState(function () {\n    return \"\";\n  }),\n      _useState26 = _slicedToArray(_useState25, 2),\n      studentName = _useState26[0],\n      setStudentName = _useState26[1];\n\n  var _useState27 = useState([]),\n      _useState28 = _slicedToArray(_useState27, 2),\n      connectedUsers = _useState28[0],\n      setConnectedUsers = _useState28[1];\n\n  var _useState29 = useState(function () {\n    return null;\n  }),\n      _useState30 = _slicedToArray(_useState29, 2),\n      callStream = _useState30[0],\n      setCallStream = _useState30[1];\n\n  var _useState31 = useState(function () {\n    return false;\n  }),\n      _useState32 = _slicedToArray(_useState31, 2),\n      callSystemInited = _useState32[0],\n      setCallSystemInited = _useState32[1];\n\n  var _useState33 = useState(function () {\n    return false;\n  }),\n      _useState34 = _slicedToArray(_useState33, 2),\n      callInprogress = _useState34[0],\n      setCallInprogress = _useState34[1];\n\n  var _useState35 = useState(function () {\n    return [];\n  }),\n      _useState36 = _slicedToArray(_useState35, 2),\n      peers = _useState36[0],\n      setPeers = _useState36[1];\n\n  var _useState37 = useState(function () {\n    return false;\n  }),\n      _useState38 = _slicedToArray(_useState37, 2),\n      codeSaved = _useState38[0],\n      setCodeSaved = _useState38[1];\n\n  var localAudio = useRef();\n  var peersRef = useRef([]);\n  var audioTrack = useRef();\n  var extensions = [javascript({\n    jsx: true\n  })];\n\n  if (language === \"javascript\") {\n    extensions[0] = javascript({\n      jsx: true\n    });\n  } else if (language === \"python\") {\n    extensions[0] = python();\n    extensions[1] = globalPythonCompletions;\n  } else {\n    extensions[0] = java();\n    extensions[1] = globalJavaScriptCompletions;\n  } // for cloud sync (via fb) [experimental - TODO]:\n  // todo-kw: uncomment this\n\n\n  useEffect(function () {\n    if (!codeSaved) {\n      var f = new File([code], codeFilename);\n      uploadFile(f);\n      setCodeSaved(true);\n      setTimeout(function () {\n        setCodeSaved(false);\n      }, 2000);\n    }\n  }, [code]); // for file downloading (via fb):\n  // const loadCode = () => {\n  //   downloadFile(codePath).then((res) => {\n  //     setCode(res.code);\n  //   });\n  // }\n  // for file uploading (via fb):\n  // const saveCode = () => {\n  //   const f = new File([code], codeFilename);\n  //   uploadFile(f);\n  // }\n  // for file maintenance (via fb):\n\n  var getOldestOfTwoInUsersFileDir = function getOldestOfTwoInUsersFileDir() {\n    return new Promise(function (res, rej) {\n      var cp = \"/files/users/\".concat(authenticationService.currentUser.source._value.username);\n      var fileStorageRef = ref(storage, cp);\n      listAll(fileStorageRef).then(function (files) {\n        var userFiles = [];\n        files.items.forEach(function (fileRef) {\n          userFiles.push(fileRef);\n        });\n\n        if (userFiles.length == 2) {\n          var cp2 = \"/files/users/\".concat(authenticationService.currentUser.source._value.username, \"/\").concat(userFiles[0].name);\n          var fileStorageRef2 = ref(storage, cp2);\n          getMetadata(fileStorageRef2).then(function (metadata1) {\n            var cp3 = \"/files/users/\".concat(authenticationService.currentUser.source._value.username, \"/\").concat(userFiles[1].name);\n            var fileStorageRef3 = ref(storage, cp3);\n            getMetadata(fileStorageRef3).then(function (metadata2) {\n              var d0 = new Date(metadata1.timeCreated);\n              var d1 = new Date(metadata2.timeCreated);\n\n              if (d0 <= d1) {\n                res({\n                  fileName: userFiles[0].name\n                });\n              } else {\n                res({\n                  fileName: userFiles[1].name\n                });\n              }\n            }).catch(function (err2) {\n              console.log(err2);\n              rej();\n            });\n          }).catch(function (err1) {\n            console.log(err1);\n            rej();\n          });\n        } else {\n          console.log(\"Seek adminastrive assistance.\"); // user has unexpected files in their folder\n\n          rej();\n        }\n      }).catch(function (err) {\n        console.log(err);\n        rej();\n      });\n    });\n  }; // for file maintenance (via fb) (deletes the oldest of the 2 files in a user's dir):\n\n\n  var refreshUsersFileDir = function refreshUsersFileDir() {\n    return new Promise(function (res, rej) {\n      var cp = \"/files/users/\".concat(authenticationService.currentUser.source._value.username);\n      var fileStorageRef = ref(storage, cp);\n      listAll(fileStorageRef).then(function (files) {\n        var userFiles = [];\n        files.items.forEach(function (fileRef) {\n          userFiles.push(fileRef);\n        });\n\n        if (userFiles.length == 2) {\n          getOldestOfTwoInUsersFileDir().then(function (r) {\n            var cp2 = \"/files/users/\".concat(authenticationService.currentUser.source._value.username, \"/\").concat(r.fileName);\n            var fileStorageRef2 = ref(storage, cp2);\n            deleteObject(fileStorageRef2).then(function () {\n              res();\n            }).catch(function (err2) {\n              console.log(err2);\n              rej();\n            });\n          }).catch(function (err1) {\n            console.log(err1);\n            rej();\n          });\n        } else {\n          console.log(\"Seek adminastrive assistance.\"); // user has unexpected files in their folder\n\n          rej();\n        }\n      }).catch(function (err) {\n        console.log(err);\n        rej();\n      });\n    });\n  }; // for file uploading (via fb):\n\n\n  var uploadFileFormHandler = function uploadFileFormHandler(event) {\n    event.preventDefault();\n    uploadFile(event.target.files[0]).then(function (res) {\n      res.file.text().then(function (code) {\n        setCode(code);\n        setCodePath(res.codePath);\n        setCodeFilename(res.file.name);\n        refreshUsersFileDir();\n      });\n    });\n  }; // for file maintenance (via fb):\n\n\n  var getOnlyFilesName = function getOnlyFilesName() {\n    return new Promise(function (res, rej) {\n      var cp = \"/files/users/\".concat(authenticationService.currentUser.source._value.username);\n      var fileStorageRef = ref(storage, cp);\n      listAll(fileStorageRef).then(function (files) {\n        var userFiles = [];\n        files.items.forEach(function (fileRef) {\n          userFiles.push(fileRef);\n        });\n\n        if (userFiles.length == 1) {\n          res({\n            fileName: userFiles[0].name,\n            codePath: userFiles[0]._location.path\n          });\n        } else {\n          console.log(\"Seek adminastrive assistance.\"); // user has unexpected files in their folder\n\n          rej();\n        }\n      }).catch(function (err) {\n        console.log(err);\n        rej();\n      });\n    });\n  }; // for file uploading (via fb):\n\n\n  var uploadFile = function uploadFile(f) {\n    return new Promise(function (res, rej) {\n      if (!f) {\n        console.log(\"Upload failed. Try a different file.\");\n        rej();\n      }\n\n      var cp = \"/files/users/\".concat(authenticationService.currentUser.source._value.username, \"/\").concat(f.name);\n      var fileStorageRef = ref(storage, cp);\n      var uploadFileTaskStatus = uploadBytesResumable(fileStorageRef, f);\n      uploadFileTaskStatus.on(\"state_changed\", function (u) {\n        var p = 100;\n\n        if (u.totalBytes > 0) {\n          p = Math.round(u.bytesTransferred / u.totalBytes * 100);\n        }\n      }, function (err) {\n        console.log(err);\n        rej();\n      }, function () {\n        // when the file is uploaded successfully:\n        //getDownloadURL(uploadFileTaskStatus.snapshot.ref).then((url) => console.log(url));\n        res({\n          file: f,\n          codePath: cp\n        });\n      });\n    });\n  }; // for file downloading (via fb):\n\n\n  var makeDownloadFileRequest = function makeDownloadFileRequest(url) {\n    return new Promise(function (res, rej) {\n      var xhr = new XMLHttpRequest(); // handle xhr response:\n\n      xhr.responseType = \"text\";\n\n      xhr.onload = function (event) {\n        if (xhr.status == 200) {\n          res({\n            code: xhr.response\n          });\n        } else {\n          console.log(xhr.status);\n          rej();\n        }\n      };\n\n      xhr.onerror = function () {\n        console.log(xhr.status);\n        rej();\n      };\n\n      xhr.open(\"GET\", url);\n      xhr.send(); // is xhr onload async\n    });\n  }; // for file downloading (via fb):\n\n\n  var downloadFile = function downloadFile(fileLocation) {\n    var fileStorageRef = ref(storage, fileLocation);\n    return getDownloadURL(fileStorageRef).then(function (url) {\n      return makeDownloadFileRequest(url);\n    });\n  }; // for file maintenance (via fb):\n\n\n  var usersFileDirIsEmpty = function usersFileDirIsEmpty() {\n    return new Promise(function (res, rej) {\n      var cp = \"/files/users/\".concat(authenticationService.currentUser.source._value.username);\n      var fileStorageRef = ref(storage, cp);\n      listAll(fileStorageRef).then(function (files) {\n        var userFiles = [];\n        files.items.forEach(function (fileRef) {\n          userFiles.push(fileRef);\n        });\n\n        if (userFiles.length == 0) {\n          res(true);\n        } else {\n          res(false);\n        }\n      }).catch(function (err) {\n        console.log(err);\n        rej();\n      });\n    });\n  };\n\n  useEffect(function () {\n    // socket.roomId = roomId;\n    socket.emit(\"set attributes\", \"teacher\", curUser, roomId);\n    socket.emit(\"teacher join\", roomId); // socket.on(\"connection broadcast\", (SktId, role, curUser) => {\n    //   // add newly connected student\n    //   if (connectedUsers.includes({ curUser, SktId })) {\n    //     console.log(\n    //       `[join broadcast]: user: ${curUser} already joined (socket id: ${SktId})`\n    //     );\n    //   } else {\n    //     setConnectedUsers(eixstingUsers => [...eixstingUsers, { curUser, SktId }]);\n    //     console.log(\n    //       `[join broadcast]: new user: ${curUser} (socket id: ${SktId}) joined as ${role}`\n    //     );\n    //   }\n    //   // init remote window on student's end\n    //   setDisplayStudent(display => {\n    //     // emit teacher's code if not on review mode\n    //     if (!display){\n    //       setCode(currentCode => {\n    //         socket.emit(\"onLecChange\", currentCode, roomId);\n    //         return currentCode;\n    //       });\n    //     } else { // emit student's code if on review mode\n    //       setStuCode(curStuCode => {\n    //         socket.emit(\"onLecChange\", curStuCode, roomId);\n    //         return curStuCode;\n    //       })\n    //     }\n    //     return display;\n    //   });\n    // });\n\n    socket.on(\"disconnection broadcast\", function (SktId, role, curUser) {\n      // add newly connected student\n      setConnectedUsers(function (eixstingUsers) {\n        var userCopy = _toConsumableArray(eixstingUsers);\n\n        var idx = userCopy.findIndex(function (user) {\n          return user.SktId === SktId;\n        });\n\n        if (idx >= 0) {\n          userCopy.splice(idx, 1);\n        }\n\n        return userCopy;\n      }); // audio\n\n      var itemIdx = peersRef.current.findIndex(function (p) {\n        return p.peerID === SktId;\n      });\n\n      if (itemIdx >= 0) {\n        setPeers(function (users) {\n          var peerIdx = users.findIndex(function (p) {\n            return peersRef.current[itemIdx].peer === p;\n          });\n          users.splice(peerIdx, 1);\n          return users;\n        });\n        peersRef.current[itemIdx].peer.removeAllListeners();\n        peersRef.current[itemIdx].peer.destroy();\n        peersRef.current.splice(itemIdx, 1);\n      } // sid and display window update\n\n\n      setSid(function (init) {\n        if (SktId === init) {\n          setDisplayStudent(false);\n          socket.sid = \"\";\n          return \"\";\n        }\n\n        return init;\n      });\n    });\n    socket.on(\"connection broadcast\", function (SktId, role, curUser) {\n      setConnectedUsers(function (eixstingUsers) {\n        var idx = eixstingUsers.findIndex(function (u) {\n          return u.curUser === curUser;\n        });\n\n        if (idx >= 0) {\n          console.log(\"[join broadcast]: user: \".concat(curUser, \" already joined (socket id: \").concat(SktId, \")\"));\n          return eixstingUsers;\n        } else {\n          console.log(\"[join broadcast]: new user: \".concat(curUser, \" (socket id: \").concat(SktId, \") joined as \").concat(role));\n          return [].concat(_toConsumableArray(eixstingUsers), [{\n            curUser: curUser,\n            SktId: SktId\n          }]);\n        }\n      }); // init remote window on student's end\n\n      setDisplayStudent(function (display) {\n        // emit teacher's code if not on review mode\n        if (!display) {\n          setCode(function (currentCode) {\n            socket.emit(\"onLecChange\", currentCode, roomId);\n            return currentCode;\n          });\n        } else {\n          // emit student's code if on review mode\n          setStuCode(function (curStuCode) {\n            socket.emit(\"onLecChange\", curStuCode, roomId);\n            return curStuCode;\n          });\n        }\n\n        return display;\n      });\n    }); // socket.on(\"student join\", (sSktId, username) => {\n    //   console.log(\n    //     \"[TeacherPage - student join] joining student socket id: \", sSktId,\n    //     \" and student name: \", username\n    //   );\n    //   // add connected student\n    //   if (!connectedUsers.includes({ curUser: username, sSktId }))\n    //     setConnectedUsers(eixstingUsers => [...eixstingUsers, { curUser: username, SktId: sSktId }]);\n    //   // init teacher code on student's window\n    //   socket.emit(\"onLecChange\", code, roomId)\n    // });\n\n    socket.on(\"student join\", function (sSktId, username) {\n      console.log(\"[TeacherPage - student join] joining student socket id: \", sSktId, \" and student name: \", username);\n      setConnectedUsers(function (eixstingUsers) {\n        socket.emit(\"onLecChange\", code, roomId);\n        var idx = eixstingUsers.findIndex(function (u) {\n          return u.curUser === username;\n        });\n        console.log(\"from connection broadcast idx \", idx);\n\n        if (idx < 0) {\n          return [].concat(_toConsumableArray(eixstingUsers), [{\n            curUser: username,\n            SktId: sSktId\n          }]);\n        }\n\n        return eixstingUsers;\n      });\n    });\n    socket.on(\"fetch init\", function (code, sid) {\n      // revisit\n      setSid(sid);\n      socket.sid = sid;\n      socket.on = true; // update student code \n\n      setStuCode(function () {\n        socket.emit(\"onLecChange\", code, roomId);\n        return code;\n      });\n    }); // new\n\n    socket.on(\"onChange\", function (value, id) {\n      setDisplayStudent(function (display) {\n        if (display) {\n          setStuCode(function () {\n            socket.emit(\"onLecChange\", value, roomId);\n            return value;\n          });\n        }\n\n        return display;\n      });\n    }); // todo-kw: revisit this function - may be useless given current logic\n\n    socket.on(\"no student\", function (msg) {\n      socket.sid = \"\";\n      setSid(\"\");\n      socket.on = true;\n      setStuCode(\"\");\n    });\n    console.log(\"initing call system\");\n    console.log(socket.id);\n    socket.on(\"all users\", function (users) {\n      console.log(users);\n      var peers = [];\n      users.forEach(function (userId) {\n        var peer = createPeer(userId, socket.id, audioTrack.current);\n        console.log(peer);\n        peersRef.current.push({\n          peerID: userId,\n          peer: peer\n        });\n        peers.push(peer);\n      });\n      console.log(peersRef.current);\n      console.log(\"peers length is \".concat(peers.length));\n      setPeers(peers);\n    });\n    socket.on(\"user joined\", function (payload) {\n      console.log(\"user joined\");\n      var peer = addPeer(payload.signal, payload.callerID, audioTrack.current);\n      peersRef.current.push({\n        peerID: payload.callerID,\n        peer: peer\n      });\n      setPeers(function (users) {\n        return [].concat(_toConsumableArray(users), [peer]);\n      });\n    });\n    socket.on(\"receiving returned signal\", function (payload) {\n      console.log(\"receiving returned signal\");\n      console.log(peersRef.current);\n      console.log(payload.id);\n      var item = peersRef.current.find(function (p) {\n        return p.peerID === payload.id;\n      });\n      console.log(item);\n      item.peer.signal(payload.signal);\n    });\n    socket.on(\"user disconnected audio\", function (socketId) {\n      console.log(\"user disconnected audio\");\n      console.log(peersRef.current);\n      console.log(socketId);\n      var itemIdx = peersRef.current.findIndex(function (p) {\n        return p.peerID === socketId;\n      });\n\n      if (itemIdx >= 0) {\n        console.log(itemIdx);\n        setPeers(function (users) {\n          var peerIdx = users.findIndex(function (p) {\n            return peersRef.current[itemIdx].peer === p;\n          });\n          console.log(peerIdx);\n          console.log(users);\n          users.splice(peerIdx, 1);\n          return users;\n        });\n        peersRef.current[itemIdx].peer.removeAllListeners();\n        peersRef.current[itemIdx].peer.destroy();\n        peersRef.current.splice(itemIdx, 1);\n      }\n\n      console.log(peersRef.current);\n    }); // for file downloading (via fb):\n\n    if (code === \"\" && codePath === \"\" && codeFilename === \"\") {\n      usersFileDirIsEmpty().then(function (res) {\n        if (res) {\n          var cp = \"/files/defaults/yteacher.txt\";\n          downloadFile(cp).then(function (res) {\n            var f = new File([res.code], \"whateveryouwant.txt\");\n            return uploadFile(f);\n          }).then(function (res) {\n            res.file.text().then(function (code) {\n              setCode(code);\n              setCodePath(res.codePath);\n              setCodeFilename(res.file.name);\n            });\n          });\n        } else {\n          getOnlyFilesName().then(function (res) {\n            downloadFile(res.codePath).then(function (res2) {\n              setCode(res2.code);\n              setCodePath(res.codePath);\n              setCodeFilename(res.fileName);\n            });\n          });\n        }\n      });\n    }\n\n    setLoadPageComplete(function (val) {\n      return true;\n    });\n  }, []);\n  useEffect(function () {\n    if (callSystemInited) {}\n  }, [callSystemInited]);\n  useEffect(function () {\n    if (!displayStudent) socket.emit(\"onLecChange\", code, roomId);\n    if (displayStudent) socket.emit(\"onLecChange\", stuCode, roomId);\n  }, [displayStudent]);\n\n  var onChange = function onChange(value, viewUpdate) {\n    if (!displayStudent) socket.emit(\"onLecChange\", value, roomId);\n    setCode(value);\n  };\n\n  var onStuChange = function onStuChange(value, viewUpdate) {\n    var editor = viewUpdate.state.values[0].prevUserEvent;\n\n    if (editor) {\n      socket.emit(\"onChange\", value, socket.sid, roomId);\n      socket.emit(\"onLecChange\", value, roomId);\n    }\n\n    setStuCode(value);\n  };\n\n  var run = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var _yield$runCode, out, err;\n\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return runCode(code, language);\n\n            case 2:\n              _yield$runCode = _context.sent;\n              out = _yield$runCode.out;\n              err = _yield$runCode.err;\n              setOut(out);\n              setErr(err);\n              socket.emit(\"teacher: execution\", out, err, roomId);\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function run() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var clearExecutionRes = function clearExecutionRes() {\n    setOut(null);\n    setErr(null);\n  };\n\n  var runStuCode = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n      var _yield$runCode2, out, err;\n\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              console.log(stuCode);\n              _context2.next = 3;\n              return runCode(stuCode, language);\n\n            case 3:\n              _yield$runCode2 = _context2.sent;\n              out = _yield$runCode2.out;\n              err = _yield$runCode2.err;\n              setStuOut(out);\n              setStuErr(err);\n\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function runStuCode() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var _setupCall = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n      var localStream;\n      return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              console.log(\"there\");\n\n              if (callInprogress) {\n                _context3.next = 14;\n                break;\n              }\n\n              _context3.next = 4;\n              return navigator.mediaDevices.getUserMedia({\n                video: false,\n                audio: true\n              });\n\n            case 4:\n              localStream = _context3.sent;\n              audioTrack.current = localStream;\n              console.log(\"hardware setup complete\");\n              setCallStream(localStream);\n              setCallSystemInited(true);\n\n              if (localAudio.current) {\n                localAudio.current.srcObject = localStream;\n              }\n\n              socket.emit(\"joined chat\", String(roomId));\n              setCallInprogress(true);\n              _context3.next = 21;\n              break;\n\n            case 14:\n              setCallStream(null);\n              audioTrack.current = null;\n\n              if (localAudio.current) {\n                localAudio.current.srcObject = null;\n              }\n\n              setCallInprogress(false);\n              peersRef.current = [];\n              setPeers([]);\n              socket.emit(\"disconnect audio\", String(roomId));\n\n            case 21:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function setupCall() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  function createPeer(userTarget, callerID, stream) {\n    var peer = new Peer({\n      initiator: true,\n      trickle: false,\n      stream: stream\n    });\n    peer.on(\"signal\", function (signal) {\n      socket.emit(\"sending signal\", {\n        userTarget: userTarget,\n        callerID: callerID,\n        signal: signal\n      });\n    });\n    peer.on('close', function () {\n      console.log(\"initiator closed\");\n    });\n    return peer;\n  }\n\n  function addPeer(incomingSignal, callerID, stream) {\n    var peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream: stream\n    });\n    peer.on(\"signal\", function (signal) {\n      socket.emit(\"returning signal\", {\n        signal: signal,\n        callerID: callerID\n      });\n    });\n    peer.on('close', function () {\n      console.log(\"new peer closed\");\n    });\n    peer.signal(incomingSignal);\n    return peer;\n  }\n\n  var LocalAudio;\n\n  if (callStream) {\n    LocalAudio = /*#__PURE__*/React.createElement(\"audio\", {\n      playsInline: true,\n      muted: true,\n      ref: localAudio,\n      autoPlay: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 710,\n        columnNumber: 18\n      }\n    });\n  }\n\n  var clearStuExecutionRes = function clearStuExecutionRes() {\n    setStuOut(null);\n    setStuErr(null);\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Box, {\n    sx: {\n      flexGrow: 1,\n      p: 3,\n      width: {\n        sm: \"calc(100% - \".concat(drawerWidth, \"px)\")\n      },\n      maxWidth: \"calc(100% - \".concat(drawerWidth, \"px)\")\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 722,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Toolbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 730,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 2,\n    sx: {\n      maxWidth: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 731,\n      columnNumber: 9\n    }\n  }, displayStudent ? /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 733,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Stack, {\n    direction: \"column\",\n    spacing: 2,\n    sx: {\n      maxWidth: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 734,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 739,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 740,\n      columnNumber: 19\n    }\n  }, \"Code session for student \", studentName, \":\")), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    sx: {\n      maxWidth: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 743,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 744,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(CodeMirror, {\n    value: stuCode,\n    height: \"600px\",\n    theme: \"dark\",\n    extensions: extensions,\n    onChange: onStuChange,\n    hint: \"true\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 745,\n      columnNumber: 21\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 755,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Stack, {\n    spacing: 2,\n    direction: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 756,\n      columnNumber: 19\n    }\n  }, language === \"java\" ? null : /*#__PURE__*/React.createElement(Button, {\n    onClick: runStuCode,\n    variant: \"contained\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 758,\n      columnNumber: 19\n    }\n  }, \"Run\"))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 763,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(CodeExecutionResWidgit, {\n    out: stuOut,\n    err: stuErr,\n    clear: clearStuExecutionRes,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 764,\n      columnNumber: 19\n    }\n  })))) : null, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: displayStudent ? 6 : 12,\n    sx: {\n      maxWidth: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 774,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Stack, {\n    direction: \"column\",\n    spacing: 2,\n    sx: {\n      maxWidth: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 775,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 780,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(EditorOptionsBar, {\n    language: language,\n    onLanguageChange: function onLanguageChange(e) {\n      return setLanguage(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 781,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 786,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 787,\n      columnNumber: 17\n    }\n  }, \"Teacher Screen:\")), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    sx: {\n      maxWidth: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 789,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 791,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(CodeMirror, {\n    value: code,\n    height: \"600px\",\n    theme: \"dark\",\n    extensions: extensions,\n    onChange: onChange,\n    hint: \"true\",\n    className: \"code-editor\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 792,\n      columnNumber: 19\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 803,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Stack, {\n    spacing: 3,\n    direction: \"row\",\n    justifyContent: \"center\",\n    alignItems: \"space-evenly\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 804,\n      columnNumber: 17\n    }\n  }, language === \"java\" ? null : /*#__PURE__*/React.createElement(Button, {\n    onClick: run,\n    variant: \"contained\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 811,\n      columnNumber: 19\n    }\n  }, \"Run\"), /*#__PURE__*/React.createElement(Storage, {\n    uploadFileFormHandler: uploadFileFormHandler,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 815,\n      columnNumber: 19\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 818,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(CodeExecutionResWidgit, {\n    out: out,\n    err: err,\n    clear: clearExecutionRes,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 819,\n      columnNumber: 17\n    }\n  })))))), loadPageComplete ? /*#__PURE__*/React.createElement(TeacherRightMenu, {\n    drawerWidth: drawerWidth,\n    setDisplayStudent: setDisplayStudent,\n    setStudentName: setStudentName,\n    connectedUsers: connectedUsers.filter(function (user) {\n      return user.curUser !== curUser;\n    }),\n    setConnectedUsers: setConnectedUsers,\n    socket: socket,\n    roomId: roomId,\n    setSocketFlag: setSocketFlag,\n    setupCall: function setupCall() {\n      return _setupCall();\n    },\n    callInprogress: callInprogress,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 829,\n      columnNumber: 27\n    }\n  }) : null, /*#__PURE__*/React.createElement(Stack, {\n    direction: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 842,\n      columnNumber: 7\n    }\n  }, LocalAudio, peers.map(function (peer, index) {\n    return /*#__PURE__*/React.createElement(Audio, {\n      key: index,\n      peer: peer,\n      __self: _this2,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 845,\n        columnNumber: 18\n      }\n    });\n  })));\n}\n\nfunction myPythonCompletions(context) {\n  var word = context.matchBefore(/\\w*/);\n  if (word.from == word.to && !context.explicit) return null;\n\n  if (word.text[0] === word.text[0].toUpperCase() && /^[a-zA-Z]+$/.test(word.text[0])) {\n    return {\n      from: word.from,\n      options: upperPythonKeys\n    };\n  }\n\n  return {\n    from: word.from,\n    options: lowerPythonKeys\n  };\n}\n\nfunction myJavaCompletions(context) {\n  var word = context.matchBefore(/\\w*/);\n  if (word.from == word.to && !context.explicit) return null;\n  return {\n    from: word.from,\n    options: javaKeys\n  };\n}\n\nvar globalPythonCompletions = pythonLanguage.data.of({\n  autocomplete: myPythonCompletions\n});\nvar globalJavaScriptCompletions = javaLanguage.data.of({\n  autocomplete: myJavaCompletions\n});\nexport default TeacherPage;","map":{"version":3,"names":["useState","useEffect","useRef","Peer","CodeMirror","Box","Button","Grid","EditorOptionsBar","Toolbar","Stack","Storage","upperPythonKeys","lowerPythonKeys","javaKeys","python","pythonLanguage","CompletionContext","javascript","javascriptLanguage","java","javaLanguage","authenticationService","TeacherRightMenu","runCode","React","CodeExecutionResWidgit","storage","ref","uploadBytesResumable","getDownloadURL","listAll","deleteObject","getMetadata","drawerWidth","t","Audio","peer","on","stream","current","srcObject","TeacherPage","socket","curUser","roomId","setSocketFlag","language","setLanguage","displayStudent","setDisplayStudent","sid","setSid","code","setCode","stuCode","setStuCode","out","setOut","err","setErr","stuOut","setStuOut","stuErr","setStuErr","loadPageComplete","setLoadPageComplete","codePath","setCodePath","codeFilename","setCodeFilename","studentName","setStudentName","connectedUsers","setConnectedUsers","callStream","setCallStream","callSystemInited","setCallSystemInited","callInprogress","setCallInprogress","peers","setPeers","codeSaved","setCodeSaved","localAudio","peersRef","audioTrack","extensions","jsx","globalPythonCompletions","globalJavaScriptCompletions","f","File","uploadFile","setTimeout","getOldestOfTwoInUsersFileDir","Promise","res","rej","cp","currentUser","source","_value","username","fileStorageRef","then","files","userFiles","items","forEach","fileRef","push","length","cp2","name","fileStorageRef2","metadata1","cp3","fileStorageRef3","metadata2","d0","Date","timeCreated","d1","fileName","catch","err2","console","log","err1","refreshUsersFileDir","r","uploadFileFormHandler","event","preventDefault","target","file","text","getOnlyFilesName","_location","path","uploadFileTaskStatus","u","p","totalBytes","Math","round","bytesTransferred","makeDownloadFileRequest","url","xhr","XMLHttpRequest","responseType","onload","status","response","onerror","open","send","downloadFile","fileLocation","usersFileDirIsEmpty","emit","SktId","role","eixstingUsers","userCopy","idx","findIndex","user","splice","itemIdx","peerID","users","peerIdx","removeAllListeners","destroy","init","display","currentCode","curStuCode","sSktId","value","id","msg","userId","createPeer","payload","addPeer","signal","callerID","item","find","socketId","res2","val","onChange","viewUpdate","onStuChange","editor","state","values","prevUserEvent","run","clearExecutionRes","runStuCode","setupCall","navigator","mediaDevices","getUserMedia","video","audio","localStream","String","userTarget","initiator","trickle","incomingSignal","LocalAudio","clearStuExecutionRes","flexGrow","width","sm","maxWidth","e","filter","map","index","myPythonCompletions","context","word","matchBefore","from","to","explicit","toUpperCase","test","options","myJavaCompletions","data","of","autocomplete"],"sources":["/Users/kw/Desktop/cscc09/project-pacer/frontend/src/TeacherPage.jsx"],"sourcesContent":["import { useState, useEffect, useRef } from \"react\";\nimport Peer from \"simple-peer\";\nimport CodeMirror from \"@uiw/react-codemirror\";\nimport Box from \"@mui/material/Box\";\nimport Button from \"@mui/material/Button\";\nimport Grid from \"@mui/material/Grid\";\nimport EditorOptionsBar from \"./components/EditorOptions\";\nimport Toolbar from \"@mui/material/Toolbar\";\nimport Stack from \"@mui/material/Stack\";\nimport Storage from \"./components/Storage\";\n\nimport { upperPythonKeys, lowerPythonKeys, javaKeys } from \"./_helpers\";\n\nimport { python, pythonLanguage } from \"@codemirror/lang-python\";\nimport { CompletionContext } from \"@codemirror/autocomplete\";\nimport { javascript, javascriptLanguage } from \"@codemirror/lang-javascript\";\nimport { java, javaLanguage } from \"@codemirror/lang-java\";\nimport { authenticationService } from \"./_services\";\nimport TeacherRightMenu from \"./components/TeacherRightMenu\";\nimport runCode from \"./_helpers/codeRunner\";\nimport React from \"react\";\nimport CodeExecutionResWidgit from \"./components/CodeExecutionResWidgit\";\nimport \"./CodePage.css\";\n\nimport { storage } from \"./_components/FireBase\";\nimport { ref, uploadBytesResumable, getDownloadURL, listAll, deleteObject, getMetadata } from \"@firebase/storage\";\n\nconst drawerWidth = 160;\nlet t = 0; //ns\n\nconst Audio = ({peer}) => {\n  const ref = useRef();\n\n  useEffect(() => {\n      peer.on(\"stream\", stream => {\n          ref.current.srcObject = stream;\n      })\n  }, []);\n\n  return (\n      <audio playsInline autoPlay ref={ref} />\n    );\n}\n\n\nfunction TeacherPage({ socket, curUser, roomId, setSocketFlag}) {\n  // code mirror config\n  const [language, setLanguage] = useState(() => \"javascript\");\n  const [displayStudent, setDisplayStudent] = useState(() => false);\n  // code display and transmission\n  const [sid, setSid] = useState(() => \"\");\n  const [code, setCode] = useState(\"\");\n  const [stuCode, setStuCode] = useState(() => \"no student here\");\n  // execution\n  const [out, setOut] = useState(() => null);\n  const [err, setErr] = useState(() => null);\n  const [stuOut, setStuOut] = useState(() => null);\n  const [stuErr, setStuErr] = useState(() => null);\n  const [loadPageComplete, setLoadPageComplete] = useState(() => false);\n  // save and load\n  const [codePath, setCodePath] = useState(\"\");\n  const [codeFilename, setCodeFilename] = useState(\"\");\n  // audio call\n  const [studentName, setStudentName] = useState(() => \"\");\n  const [connectedUsers, setConnectedUsers] = useState([]);\n  const [callStream, setCallStream] = useState(() => null);\n  const [callSystemInited, setCallSystemInited] = useState(() => false);\n  const [callInprogress, setCallInprogress] = useState(() => false);\n  const [peers, setPeers] = useState(() => []);\n  const [codeSaved, setCodeSaved] = useState(() => false);\n\n  const localAudio = useRef();\n  const peersRef = useRef([]);\n  const audioTrack = useRef();\n\n  let extensions = [javascript({ jsx: true })];\n  if (language === \"javascript\") {\n    extensions[0] = javascript({ jsx: true });\n  } else if (language === \"python\") {\n    extensions[0] = python();\n    extensions[1] = globalPythonCompletions;\n  } else {\n    extensions[0] = java();\n    extensions[1] = globalJavaScriptCompletions;\n  }\n\n  // for cloud sync (via fb) [experimental - TODO]:\n  // todo-kw: uncomment this\n  useEffect(() => {\n    if (!codeSaved) {\n      const f = new File([code], codeFilename);\n      uploadFile(f);\n      setCodeSaved(true)\n      setTimeout(() => {\n        setCodeSaved(false)\n      }, 2000);\n    }\n  }, [code]);\n\n  // for file downloading (via fb):\n  // const loadCode = () => {\n  //   downloadFile(codePath).then((res) => {\n  //     setCode(res.code);\n  //   });\n  // }\n\n  // for file uploading (via fb):\n  // const saveCode = () => {\n  //   const f = new File([code], codeFilename);\n  //   uploadFile(f);\n  // }\n\n  // for file maintenance (via fb):\n  const getOldestOfTwoInUsersFileDir = () => {\n    return new Promise(function (res, rej) {\n      const cp = `/files/users/${authenticationService.currentUser.source._value.username}`;\n      const fileStorageRef = ref(storage, cp);\n      listAll(fileStorageRef).then(function(files) {\n        const userFiles = [];\n        files.items.forEach(function(fileRef) {\n          userFiles.push(fileRef);\n        });\n        if (userFiles.length == 2) {\n          const cp2 = `/files/users/${authenticationService.currentUser.source._value.username}/${userFiles[0].name}`;\n          const fileStorageRef2 = ref(storage, cp2);\n          getMetadata(fileStorageRef2).then((metadata1) => {\n            const cp3 = `/files/users/${authenticationService.currentUser.source._value.username}/${userFiles[1].name}`;\n            const fileStorageRef3 = ref(storage, cp3);\n            getMetadata(fileStorageRef3).then((metadata2) => {\n              const d0 = new Date(metadata1.timeCreated);\n              const d1 = new Date(metadata2.timeCreated);\n              if (d0 <= d1) {\n                res({ fileName: userFiles[0].name });\n              } else {\n                res({ fileName: userFiles[1].name });\n              }\n            }).catch((err2) => {\n              console.log(err2);\n              rej();\n            });\n          }).catch((err1) => {\n            console.log(err1);\n            rej();\n          });\n        } else {\n          console.log(\"Seek adminastrive assistance.\"); // user has unexpected files in their folder\n          rej();\n        }\n      }).catch(function(err) {\n        console.log(err);\n        rej();\n      });\n    });\n  };\n\n  // for file maintenance (via fb) (deletes the oldest of the 2 files in a user's dir):\n  const refreshUsersFileDir = () => {\n    return new Promise(function (res, rej) {\n      const cp = `/files/users/${authenticationService.currentUser.source._value.username}`;\n      const fileStorageRef = ref(storage, cp);\n      listAll(fileStorageRef).then(function(files) {\n        const userFiles = [];\n        files.items.forEach(function(fileRef) {\n          userFiles.push(fileRef);\n        });\n        if (userFiles.length == 2) {\n          getOldestOfTwoInUsersFileDir().then((r) => {\n            const cp2 = `/files/users/${authenticationService.currentUser.source._value.username}/${r.fileName}`;\n            const fileStorageRef2 = ref(storage, cp2);\n            deleteObject(fileStorageRef2).then(() => {\n              res();\n            }).catch((err2) => {\n              console.log(err2);\n              rej();\n            });\n          }).catch((err1) => {\n            console.log(err1);\n            rej();\n          });\n        } else {\n          console.log(\"Seek adminastrive assistance.\"); // user has unexpected files in their folder\n          rej();\n        }\n      }).catch(function(err) {\n        console.log(err);\n        rej();\n      });\n    });\n  };\n\n\n  // for file uploading (via fb):\n  const uploadFileFormHandler = (event) => {\n    event.preventDefault();\n    uploadFile(event.target.files[0]).then((res) => {\n      res.file.text().then((code) => {\n        setCode(code);\n        setCodePath(res.codePath);\n        setCodeFilename(res.file.name);\n        refreshUsersFileDir();\n      });\n    });\n  };\n\n\n  // for file maintenance (via fb):\n  const getOnlyFilesName = () => {\n    return new Promise(function (res, rej) {\n      const cp = `/files/users/${authenticationService.currentUser.source._value.username}`;\n      const fileStorageRef = ref(storage, cp);\n      listAll(fileStorageRef).then(function(files) {\n        const userFiles = [];\n        files.items.forEach(function(fileRef) {\n          userFiles.push(fileRef);\n        });\n        if (userFiles.length == 1) {\n          res({ fileName: userFiles[0].name, codePath: userFiles[0]._location.path });\n        } else {\n          console.log(\"Seek adminastrive assistance.\"); // user has unexpected files in their folder\n          rej();\n        }\n      }).catch(function(err) {\n        console.log(err);\n        rej();\n      });\n    });\n  };\n\n\n  // for file uploading (via fb):\n  const uploadFile = (f) => {\n    return new Promise(function (res, rej) {\n      if (!f) {\n        console.log(\"Upload failed. Try a different file.\");\n        rej();\n      }\n      const cp = `/files/users/${authenticationService.currentUser.source._value.username}/${f.name}`;\n      const fileStorageRef = ref(storage, cp);\n      const uploadFileTaskStatus = uploadBytesResumable(fileStorageRef, f);\n      uploadFileTaskStatus.on(\n        \"state_changed\",\n        (u) => {\n          let p = 100;\n          if (u.totalBytes > 0) {\n            p = Math.round((u.bytesTransferred / u.totalBytes) * 100);\n          }\n        },\n        (err) => {\n          console.log(err);\n          rej();\n        },\n        () => {\n          // when the file is uploaded successfully:\n          //getDownloadURL(uploadFileTaskStatus.snapshot.ref).then((url) => console.log(url));\n          res({ file: f, codePath: cp });\n        }\n      );\n    });\n  };\n\n\n  // for file downloading (via fb):\n  const makeDownloadFileRequest = (url) => {\n    return new Promise(function (res, rej) {\n      let xhr = new XMLHttpRequest();\n      // handle xhr response:\n      xhr.responseType = \"text\";\n      xhr.onload = (event) => {\n        if (xhr.status == 200) {\n          res({ code: xhr.response });\n        } else {\n          console.log(xhr.status);\n          rej();\n        }\n      };\n      xhr.onerror = () => {\n        console.log(xhr.status);\n        rej();\n      };\n      xhr.open(\"GET\", url);\n      xhr.send(); // is xhr onload async\n    });\n  };\n\n\n  // for file downloading (via fb):\n  const downloadFile = (fileLocation) => {\n    const fileStorageRef = ref(storage, fileLocation);\n    return getDownloadURL(fileStorageRef).then((url) =>\n      makeDownloadFileRequest(url)\n    );\n  };\n\n\n  // for file maintenance (via fb):\n  const usersFileDirIsEmpty = () => {\n    return new Promise(function (res, rej) {\n      const cp = `/files/users/${authenticationService.currentUser.source._value.username}`;\n      const fileStorageRef = ref(storage, cp);\n      listAll(fileStorageRef).then(function(files) {\n        const userFiles = [];\n        files.items.forEach(function(fileRef) {\n          userFiles.push(fileRef);\n        });\n        if (userFiles.length == 0) {\n          res(true);\n        } else {\n          res(false);\n        }\n      }).catch(function(err) {\n        console.log(err);\n        rej();\n      });\n    });\n  };\n\n  useEffect(() => {\n    \n    // socket.roomId = roomId;\n\n    socket.emit(\"set attributes\", \"teacher\", curUser, roomId);\n\n    socket.emit(\"teacher join\", roomId);\n\n    // socket.on(\"connection broadcast\", (SktId, role, curUser) => {\n    //   // add newly connected student\n    //   if (connectedUsers.includes({ curUser, SktId })) {\n    //     console.log(\n    //       `[join broadcast]: user: ${curUser} already joined (socket id: ${SktId})`\n    //     );\n    //   } else {\n    //     setConnectedUsers(eixstingUsers => [...eixstingUsers, { curUser, SktId }]);\n    //     console.log(\n    //       `[join broadcast]: new user: ${curUser} (socket id: ${SktId}) joined as ${role}`\n    //     );\n    //   }\n    //   // init remote window on student's end\n    //   setDisplayStudent(display => {\n    //     // emit teacher's code if not on review mode\n    //     if (!display){\n    //       setCode(currentCode => {\n    //         socket.emit(\"onLecChange\", currentCode, roomId);\n    //         return currentCode;\n    //       });\n    //     } else { // emit student's code if on review mode\n    //       setStuCode(curStuCode => {\n    //         socket.emit(\"onLecChange\", curStuCode, roomId);\n    //         return curStuCode;\n    //       })\n    //     }\n    //     return display;\n    //   });\n    // });\n\n    socket.on(\"disconnection broadcast\", (SktId, role, curUser) => {\n      // add newly connected student\n      setConnectedUsers(eixstingUsers => {\n        const userCopy = [...eixstingUsers];\n        const idx = userCopy.findIndex((user) => user.SktId === SktId);\n        if (idx >= 0) {\n          userCopy.splice(idx, 1);\n        }\n        return userCopy\n      });\n      // audio\n      const itemIdx = peersRef.current.findIndex((p) => p.peerID === SktId);\n      if (itemIdx >= 0) {\n        setPeers((users) => {\n          const peerIdx = users.findIndex((p) => peersRef.current[itemIdx].peer === p);\n          users.splice(peerIdx, 1)\n          return users\n        });\n        peersRef.current[itemIdx].peer.removeAllListeners();\n        peersRef.current[itemIdx].peer.destroy();\n        peersRef.current.splice(itemIdx, 1)\n      } \n      // sid and display window update\n      setSid(init => {\n        if(SktId === init) {\n          setDisplayStudent(false);\n          socket.sid = \"\";\n          return \"\";\n        }\n        return init;\n      });\n    });\n\n\n    socket.on(\"connection broadcast\", (SktId, role, curUser) => {\n      setConnectedUsers(eixstingUsers => {\n          const idx = eixstingUsers.findIndex(u => \n            u.curUser === curUser\n          )\n          if(idx >= 0){\n            console.log(\n              `[join broadcast]: user: ${curUser} already joined (socket id: ${SktId})`\n            );\n            return eixstingUsers;\n          } else {\n            console.log(\n              `[join broadcast]: new user: ${curUser} (socket id: ${SktId}) joined as ${role}`\n            );\n            return [...eixstingUsers, { curUser, SktId }];\n          }\n      });\n\n\n      // init remote window on student's end\n      setDisplayStudent(display => {\n        // emit teacher's code if not on review mode\n        if (!display){\n          setCode(currentCode => {\n            socket.emit(\"onLecChange\", currentCode, roomId);\n            return currentCode;\n          });\n        } else { // emit student's code if on review mode\n          setStuCode(curStuCode => {\n            socket.emit(\"onLecChange\", curStuCode, roomId);\n            return curStuCode;\n          })\n        }\n        return display;\n      });\n    });\n    // socket.on(\"student join\", (sSktId, username) => {\n    //   console.log(\n    //     \"[TeacherPage - student join] joining student socket id: \", sSktId,\n    //     \" and student name: \", username\n    //   );\n    //   // add connected student\n    //   if (!connectedUsers.includes({ curUser: username, sSktId }))\n    //     setConnectedUsers(eixstingUsers => [...eixstingUsers, { curUser: username, SktId: sSktId }]);\n    //   // init teacher code on student's window\n    //   socket.emit(\"onLecChange\", code, roomId)\n    // });\n    socket.on(\"student join\", (sSktId, username) => {\n      console.log(\n        \"[TeacherPage - student join] joining student socket id: \", sSktId,\n        \" and student name: \", username\n      );\n\n      setConnectedUsers(eixstingUsers => {\n        socket.emit(\"onLecChange\", code, roomId);\n\n          const idx = eixstingUsers.findIndex(u => \n            u.curUser === username\n          )\n          console.log(\"from connection broadcast idx \", idx);\n          if(idx < 0){\n            return [...eixstingUsers, { curUser: username, SktId: sSktId }];\n          }\n          return eixstingUsers\n      })\n    });\n\n  \n    socket.on(\"fetch init\", (code, sid) => {\n      // revisit\n      setSid(sid);\n      socket.sid = sid;\n      socket.on = true;\n      // update student code \n      setStuCode(() => {\n        socket.emit(\"onLecChange\", code, roomId);\n        return code;\n      });\n    });\n\n    // new\n    socket.on(\"onChange\", (value, id) => {\n      setDisplayStudent(display => {\n        if (display){\n          setStuCode(() => {\n            socket.emit(\"onLecChange\", value, roomId);\n            return value;\n          });\n        }\n        return display\n      });\n    });\n\n\n    // todo-kw: revisit this function - may be useless given current logic\n    socket.on(\"no student\", (msg) => {\n      socket.sid = \"\";\n      setSid(\"\");\n      socket.on = true;\n      setStuCode(\"\");\n    });\n\n    console.log(\"initing call system\")\n      console.log(socket.id)\n\n    socket.on(\"all users\", (users) => {\n      console.log(users)\n      const peers = [];\n      users.forEach((userId) => {\n        const peer = createPeer(userId, socket.id, audioTrack.current);\n        console.log(peer)\n        peersRef.current.push({\n          peerID: userId,\n          peer,\n        });\n        peers.push(peer);\n      });\n      console.log(peersRef.current)\n      console.log(`peers length is ${peers.length}`)\n      setPeers(peers);\n    });\n\n\n  socket.on(\"user joined\", (payload) => {\n    console.log(\"user joined\")\n    const peer = addPeer(payload.signal, payload.callerID, audioTrack.current);\n    peersRef.current.push({\n      peerID: payload.callerID,\n      peer,\n    });\n\n    setPeers((users) => [...users, peer]);\n  });\n\n  \n  socket.on(\"receiving returned signal\", (payload) => {\n    console.log(\"receiving returned signal\")\n    console.log(peersRef.current)\n    console.log(payload.id)\n    const item = peersRef.current.find((p) => p.peerID === payload.id);\n    console.log(item)\n    item.peer.signal(payload.signal);\n  });\n\n  socket.on(\"user disconnected audio\", (socketId) => {\n    console.log(\"user disconnected audio\")\n    console.log(peersRef.current)\n    console.log(socketId)\n    const itemIdx = peersRef.current.findIndex((p) => p.peerID === socketId);\n    if (itemIdx >= 0) {\n      console.log(itemIdx)\n      setPeers((users) => {\n        const peerIdx = users.findIndex((p) => peersRef.current[itemIdx].peer === p);\n        console.log(peerIdx)\n        console.log(users)\n        users.splice(peerIdx, 1)\n        return users\n      });\n      peersRef.current[itemIdx].peer.removeAllListeners();\n      peersRef.current[itemIdx].peer.destroy();\n      peersRef.current.splice(itemIdx, 1)\n    }\n    console.log(peersRef.current)\n  })\n\n\n    // for file downloading (via fb):\n    if (code === \"\" && codePath === \"\" && codeFilename === \"\") {\n      usersFileDirIsEmpty().then((res) => {\n        if (res) {\n          let cp = \"/files/defaults/yteacher.txt\";\n          downloadFile(cp)\n            .then((res) => {\n              const f = new File([res.code], \"whateveryouwant.txt\");\n              return uploadFile(f);\n            })\n            .then((res) => {\n              res.file.text().then((code) => {\n                setCode(code);\n                setCodePath(res.codePath);\n                setCodeFilename(res.file.name);\n              });\n            });\n        } else {\n          getOnlyFilesName().then((res) => {\n            downloadFile(res.codePath).then((res2) => {\n              setCode(res2.code);\n              setCodePath(res.codePath);\n              setCodeFilename(res.fileName);\n            });\n          })\n        }\n      });\n    }\n\n    setLoadPageComplete((val) => true);\n  }, []);\n\n\n  useEffect(() => {\n    if (callSystemInited) {\n    }\n  }, [callSystemInited])\n\n\n\n  useEffect(() => {\n    if(!displayStudent) socket.emit(\"onLecChange\", code, roomId);\n    if(displayStudent) socket.emit(\"onLecChange\", stuCode, roomId);\n  },[displayStudent]);\n\n\n  const onChange = (value, viewUpdate) => {\n    if (!displayStudent) socket.emit(\"onLecChange\", value, roomId);\n    setCode(value);\n  };\n\n\n  const onStuChange = (value, viewUpdate) => {\n    const editor = viewUpdate.state.values[0].prevUserEvent;\n    if (editor) {\n      socket.emit(\"onChange\", value, socket.sid, roomId);\n      socket.emit(\"onLecChange\", value, roomId);\n    }\n    setStuCode(value);\n  };\n\n\n  const run = async () => {\n    const { out, err } = await runCode(code, language);\n    setOut(out);\n    setErr(err);\n    socket.emit(\"teacher: execution\", out, err, roomId);\n  };\n\n\n  const clearExecutionRes = () => {\n    setOut(null);\n    setErr(null);\n  };\n\n\n  const runStuCode = async () => {\n    console.log(stuCode);\n    const { out, err } = await runCode(stuCode, language);\n    setStuOut(out);\n    setStuErr(err);\n  };\n\n\n  const setupCall = async () => {\n    console.log(\"there\")\n    if (!callInprogress) {\n      const localStream = await navigator.mediaDevices.getUserMedia({\n        video: false,\n        audio: true,\n      });\n      audioTrack.current = localStream\n      console.log(\"hardware setup complete\");\n      setCallStream(localStream);\n      setCallSystemInited(true);\n      if (localAudio.current) {\n        localAudio.current.srcObject = localStream;\n      }\n      socket.emit(\"joined chat\", String(roomId));\n      setCallInprogress(true);\n    } else {\n      setCallStream(null);\n      audioTrack.current = null\n      if (localAudio.current) {\n        localAudio.current.srcObject = null;\n      }\n      setCallInprogress(false);\n      peersRef.current = []\n      setPeers([])\n      socket.emit(\"disconnect audio\", String(roomId))\n    }\n  };\n\n\n  function createPeer(userTarget, callerID, stream) {\n    const peer = new Peer({\n      initiator: true,\n      trickle: false,\n      stream,\n    });\n\n    peer.on(\"signal\", (signal) => {\n      socket.emit(\"sending signal\", { userTarget, callerID, signal });\n    });\n\n    peer.on('close', () => {\n      console.log(\"initiator closed\")\n    })\n\n    return peer;\n  }\n\n\n  function addPeer(incomingSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream,\n    });\n    peer.on(\"signal\", (signal) => {\n      socket.emit(\"returning signal\", { signal, callerID });\n    });\n\n    peer.on('close', () => {\n      console.log(\"new peer closed\")\n    })\n\n    peer.signal(incomingSignal);\n\n    return peer;\n  }\n\n\n  let LocalAudio;\n  if (callStream) {\n    LocalAudio = <audio playsInline muted ref={localAudio} autoPlay />;\n  }\n\n\n  const clearStuExecutionRes = () => {\n    setStuOut(null);\n    setStuErr(null);\n  };\n\n\n  return (\n    <>\n      <Box\n        sx={{\n          flexGrow: 1,\n          p: 3,\n          width: { sm: `calc(100% - ${drawerWidth}px)` },\n          maxWidth: `calc(100% - ${drawerWidth}px)`\n        }}\n      >\n        <Toolbar />\n        <Grid container spacing={2} sx={{maxWidth: \"100%\"}}>\n          {displayStudent ? (\n            <Grid item xs={6}>\n              <Stack\n              direction=\"column\"\n              spacing={2}\n              sx={{maxWidth: \"100%\"}}\n            >\n                <Grid item xs={12}>\n                  <p>Code session for student {studentName}:</p>\n                </Grid>\n                {/* server display */}\n                <Grid item xs={12} sx={{maxWidth: \"100%\"}}>\n                  <div>\n                    <CodeMirror\n                      value={stuCode}\n                      height=\"600px\"\n                      theme=\"dark\"\n                      extensions={extensions}\n                      onChange={onStuChange}\n                      hint=\"true\"\n                    />\n                  </div>\n                </Grid>\n                <Grid item xs={12}>\n                  <Stack spacing={2} direction=\"row\">\n                  {language===\"java\" ? null : \n                  <Button onClick={runStuCode} variant=\"contained\">\n                    Run\n                  </Button>}\n                  </Stack>\n                </Grid>\n                <Grid item xs={12}>\n                  <CodeExecutionResWidgit\n                    out={stuOut}\n                    err={stuErr}\n                    clear={clearStuExecutionRes}\n                  />\n                </Grid>\n              </Stack>\n            </Grid>\n          ) : null}\n\n          <Grid item xs={displayStudent ? 6 : 12} sx={{maxWidth: \"100%\"}}>\n            <Stack\n              direction=\"column\"\n              spacing={2}\n              sx={{maxWidth: \"100%\"}}\n            >\n              <Grid item xs={12}>\n                <EditorOptionsBar\n                  language={language}\n                  onLanguageChange={(e) => setLanguage(e.target.value)}\n                />\n              </Grid>\n              <Grid item xs={12}>\n                <p>Teacher Screen:</p>\n              </Grid>\n              <Grid item xs={12} sx={{maxWidth: \"100%\"}}>\n                {/* client display */}\n                <div>\n                  <CodeMirror\n                    value={code}\n                    height=\"600px\"\n                    theme=\"dark\"\n                    extensions={extensions}\n                    onChange={onChange}\n                    hint=\"true\"\n                    className=\"code-editor\"\n                  />\n                </div>\n              </Grid>\n              <Grid item xs={12}>\n                <Stack\n                  spacing={3}\n                  direction=\"row\"\n                  justifyContent=\"center\"\n                  alignItems=\"space-evenly\"\n                >\n                  {language===\"java\" ? null : \n                  <Button onClick={run} variant=\"contained\">\n                    Run\n                  </Button>\n                  }\n                  <Storage uploadFileFormHandler={uploadFileFormHandler}></Storage>\n                </Stack>\n              </Grid>\n              <Grid item xs={12}>\n                <CodeExecutionResWidgit\n                  out={out}\n                  err={err}\n                  clear={clearExecutionRes}\n                />\n              </Grid>\n            </Stack>\n          </Grid>\n        </Grid>\n      </Box>\n      {loadPageComplete ? <TeacherRightMenu\n        drawerWidth={drawerWidth}\n        setDisplayStudent={setDisplayStudent}\n        setStudentName={setStudentName}\n        connectedUsers={connectedUsers.filter((user) => user.curUser !== curUser)}\n        setConnectedUsers={setConnectedUsers}\n        socket={socket}\n        roomId={roomId}\n        setSocketFlag={setSocketFlag}\n        setupCall={() => setupCall()}\n        callInprogress={callInprogress}\n      /> : null}\n      \n      <Stack direction=\"row\">\n        {LocalAudio}\n        {peers.map((peer, index) => {\n          return <Audio key={index} peer={peer} />;\n        })}\n      </Stack>\n    </>\n  );\n}\n\nfunction myPythonCompletions(context: CompletionContext) {\n  let word = context.matchBefore(/\\w*/);\n  if (word.from == word.to && !context.explicit) return null;\n  if (\n    word.text[0] === word.text[0].toUpperCase() &&\n    /^[a-zA-Z]+$/.test(word.text[0])\n  ) {\n    return {\n      from: word.from,\n      options: upperPythonKeys,\n    };\n  }\n  return {\n    from: word.from,\n    options: lowerPythonKeys,\n  };\n}\n\nfunction myJavaCompletions(context: CompletionContext) {\n  let word = context.matchBefore(/\\w*/);\n  if (word.from == word.to && !context.explicit) return null;\n  return {\n    from: word.from,\n    options: javaKeys,\n  };\n}\n\nconst globalPythonCompletions = pythonLanguage.data.of({\n  autocomplete: myPythonCompletions,\n});\n\nconst globalJavaScriptCompletions = javaLanguage.data.of({\n  autocomplete: myJavaCompletions,\n});\n\nexport default TeacherPage;\n"],"mappings":";;;;;;;+CACA,oJ;;AADA,SAASA,QAAT,EAAmBC,SAAnB,EAA8BC,MAA9B,QAA4C,OAA5C;AACA,OAAOC,IAAP,MAAiB,aAAjB;AACA,OAAOC,UAAP,MAAuB,uBAAvB;AACA,OAAOC,GAAP,MAAgB,mBAAhB;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,IAAP,MAAiB,oBAAjB;AACA,OAAOC,gBAAP,MAA6B,4BAA7B;AACA,OAAOC,OAAP,MAAoB,uBAApB;AACA,OAAOC,KAAP,MAAkB,qBAAlB;AACA,OAAOC,OAAP,MAAoB,sBAApB;AAEA,SAASC,eAAT,EAA0BC,eAA1B,EAA2CC,QAA3C,QAA2D,YAA3D;AAEA,SAASC,MAAT,EAAiBC,cAAjB,QAAuC,yBAAvC;AACA,SAASC,iBAAT,QAAkC,0BAAlC;AACA,SAASC,UAAT,EAAqBC,kBAArB,QAA+C,6BAA/C;AACA,SAASC,IAAT,EAAeC,YAAf,QAAmC,uBAAnC;AACA,SAASC,qBAAT,QAAsC,aAAtC;AACA,OAAOC,gBAAP,MAA6B,+BAA7B;AACA,OAAOC,OAAP,MAAoB,uBAApB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,sBAAP,MAAmC,qCAAnC;AACA,OAAO,gBAAP;AAEA,SAASC,OAAT,QAAwB,wBAAxB;AACA,SAASC,GAAT,EAAcC,oBAAd,EAAoCC,cAApC,EAAoDC,OAApD,EAA6DC,YAA7D,EAA2EC,WAA3E,QAA8F,mBAA9F;AAEA,IAAMC,WAAW,GAAG,GAApB;AACA,IAAIC,CAAC,GAAG,CAAR,C,CAAW;;AAEX,IAAMC,KAAK,GAAG,SAARA,KAAQ,OAAY;EAAA,IAAVC,IAAU,QAAVA,IAAU;EACxB,IAAMT,GAAG,GAAG1B,MAAM,EAAlB;EAEAD,SAAS,CAAC,YAAM;IACZoC,IAAI,CAACC,EAAL,CAAQ,QAAR,EAAkB,UAAAC,MAAM,EAAI;MACxBX,GAAG,CAACY,OAAJ,CAAYC,SAAZ,GAAwBF,MAAxB;IACH,CAFD;EAGH,CAJQ,EAIN,EAJM,CAAT;EAMA,oBACI;IAAO,WAAW,MAAlB;IAAmB,QAAQ,MAA3B;IAA4B,GAAG,EAAEX,GAAjC;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EADJ;AAGD,CAZD;;AAeA,SAASc,WAAT,QAAgE;EAAA;;EAAA,IAAzCC,MAAyC,SAAzCA,MAAyC;EAAA,IAAjCC,OAAiC,SAAjCA,OAAiC;EAAA,IAAxBC,MAAwB,SAAxBA,MAAwB;EAAA,IAAhBC,aAAgB,SAAhBA,aAAgB;;EAC9D;EAD8D,gBAE9B9C,QAAQ,CAAC;IAAA,OAAM,YAAN;EAAA,CAAD,CAFsB;EAAA;EAAA,IAEvD+C,QAFuD;EAAA,IAE7CC,WAF6C;;EAAA,iBAGlBhD,QAAQ,CAAC;IAAA,OAAM,KAAN;EAAA,CAAD,CAHU;EAAA;EAAA,IAGvDiD,cAHuD;EAAA,IAGvCC,iBAHuC,kBAI9D;;;EAJ8D,iBAKxClD,QAAQ,CAAC;IAAA,OAAM,EAAN;EAAA,CAAD,CALgC;EAAA;EAAA,IAKvDmD,GALuD;EAAA,IAKlDC,MALkD;;EAAA,iBAMtCpD,QAAQ,CAAC,EAAD,CAN8B;EAAA;EAAA,IAMvDqD,IANuD;EAAA,IAMjDC,OANiD;;EAAA,iBAOhCtD,QAAQ,CAAC;IAAA,OAAM,iBAAN;EAAA,CAAD,CAPwB;EAAA;EAAA,IAOvDuD,OAPuD;EAAA,IAO9CC,UAP8C,mBAQ9D;;;EAR8D,kBASxCxD,QAAQ,CAAC;IAAA,OAAM,IAAN;EAAA,CAAD,CATgC;EAAA;EAAA,IASvDyD,GATuD;EAAA,IASlDC,MATkD;;EAAA,kBAUxC1D,QAAQ,CAAC;IAAA,OAAM,IAAN;EAAA,CAAD,CAVgC;EAAA;EAAA,IAUvD2D,GAVuD;EAAA,IAUlDC,MAVkD;;EAAA,kBAWlC5D,QAAQ,CAAC;IAAA,OAAM,IAAN;EAAA,CAAD,CAX0B;EAAA;EAAA,IAWvD6D,MAXuD;EAAA,IAW/CC,SAX+C;;EAAA,kBAYlC9D,QAAQ,CAAC;IAAA,OAAM,IAAN;EAAA,CAAD,CAZ0B;EAAA;EAAA,IAYvD+D,MAZuD;EAAA,IAY/CC,SAZ+C;;EAAA,kBAadhE,QAAQ,CAAC;IAAA,OAAM,KAAN;EAAA,CAAD,CAbM;EAAA;EAAA,IAavDiE,gBAbuD;EAAA,IAarCC,mBAbqC,mBAc9D;;;EAd8D,kBAe9BlE,QAAQ,CAAC,EAAD,CAfsB;EAAA;EAAA,IAevDmE,QAfuD;EAAA,IAe7CC,WAf6C;;EAAA,kBAgBtBpE,QAAQ,CAAC,EAAD,CAhBc;EAAA;EAAA,IAgBvDqE,YAhBuD;EAAA,IAgBzCC,eAhByC,mBAiB9D;;;EAjB8D,kBAkBxBtE,QAAQ,CAAC;IAAA,OAAM,EAAN;EAAA,CAAD,CAlBgB;EAAA;EAAA,IAkBvDuE,WAlBuD;EAAA,IAkB1CC,cAlB0C;;EAAA,kBAmBlBxE,QAAQ,CAAC,EAAD,CAnBU;EAAA;EAAA,IAmBvDyE,cAnBuD;EAAA,IAmBvCC,iBAnBuC;;EAAA,kBAoB1B1E,QAAQ,CAAC;IAAA,OAAM,IAAN;EAAA,CAAD,CApBkB;EAAA;EAAA,IAoBvD2E,UApBuD;EAAA,IAoB3CC,aApB2C;;EAAA,kBAqBd5E,QAAQ,CAAC;IAAA,OAAM,KAAN;EAAA,CAAD,CArBM;EAAA;EAAA,IAqBvD6E,gBArBuD;EAAA,IAqBrCC,mBArBqC;;EAAA,kBAsBlB9E,QAAQ,CAAC;IAAA,OAAM,KAAN;EAAA,CAAD,CAtBU;EAAA;EAAA,IAsBvD+E,cAtBuD;EAAA,IAsBvCC,iBAtBuC;;EAAA,kBAuBpChF,QAAQ,CAAC;IAAA,OAAM,EAAN;EAAA,CAAD,CAvB4B;EAAA;EAAA,IAuBvDiF,KAvBuD;EAAA,IAuBhDC,QAvBgD;;EAAA,kBAwB5BlF,QAAQ,CAAC;IAAA,OAAM,KAAN;EAAA,CAAD,CAxBoB;EAAA;EAAA,IAwBvDmF,SAxBuD;EAAA,IAwB5CC,YAxB4C;;EA0B9D,IAAMC,UAAU,GAAGnF,MAAM,EAAzB;EACA,IAAMoF,QAAQ,GAAGpF,MAAM,CAAC,EAAD,CAAvB;EACA,IAAMqF,UAAU,GAAGrF,MAAM,EAAzB;EAEA,IAAIsF,UAAU,GAAG,CAACtE,UAAU,CAAC;IAAEuE,GAAG,EAAE;EAAP,CAAD,CAAX,CAAjB;;EACA,IAAI1C,QAAQ,KAAK,YAAjB,EAA+B;IAC7ByC,UAAU,CAAC,CAAD,CAAV,GAAgBtE,UAAU,CAAC;MAAEuE,GAAG,EAAE;IAAP,CAAD,CAA1B;EACD,CAFD,MAEO,IAAI1C,QAAQ,KAAK,QAAjB,EAA2B;IAChCyC,UAAU,CAAC,CAAD,CAAV,GAAgBzE,MAAM,EAAtB;IACAyE,UAAU,CAAC,CAAD,CAAV,GAAgBE,uBAAhB;EACD,CAHM,MAGA;IACLF,UAAU,CAAC,CAAD,CAAV,GAAgBpE,IAAI,EAApB;IACAoE,UAAU,CAAC,CAAD,CAAV,GAAgBG,2BAAhB;EACD,CAvC6D,CAyC9D;EACA;;;EACA1F,SAAS,CAAC,YAAM;IACd,IAAI,CAACkF,SAAL,EAAgB;MACd,IAAMS,CAAC,GAAG,IAAIC,IAAJ,CAAS,CAACxC,IAAD,CAAT,EAAiBgB,YAAjB,CAAV;MACAyB,UAAU,CAACF,CAAD,CAAV;MACAR,YAAY,CAAC,IAAD,CAAZ;MACAW,UAAU,CAAC,YAAM;QACfX,YAAY,CAAC,KAAD,CAAZ;MACD,CAFS,EAEP,IAFO,CAAV;IAGD;EACF,CATQ,EASN,CAAC/B,IAAD,CATM,CAAT,CA3C8D,CAsD9D;EACA;EACA;EACA;EACA;EACA;EAEA;EACA;EACA;EACA;EACA;EAEA;;EACA,IAAM2C,4BAA4B,GAAG,SAA/BA,4BAA+B,GAAM;IACzC,OAAO,IAAIC,OAAJ,CAAY,UAAUC,GAAV,EAAeC,GAAf,EAAoB;MACrC,IAAMC,EAAE,0BAAmB9E,qBAAqB,CAAC+E,WAAtB,CAAkCC,MAAlC,CAAyCC,MAAzC,CAAgDC,QAAnE,CAAR;MACA,IAAMC,cAAc,GAAG7E,GAAG,CAACD,OAAD,EAAUyE,EAAV,CAA1B;MACArE,OAAO,CAAC0E,cAAD,CAAP,CAAwBC,IAAxB,CAA6B,UAASC,KAAT,EAAgB;QAC3C,IAAMC,SAAS,GAAG,EAAlB;QACAD,KAAK,CAACE,KAAN,CAAYC,OAAZ,CAAoB,UAASC,OAAT,EAAkB;UACpCH,SAAS,CAACI,IAAV,CAAeD,OAAf;QACD,CAFD;;QAGA,IAAIH,SAAS,CAACK,MAAV,IAAoB,CAAxB,EAA2B;UACzB,IAAMC,GAAG,0BAAmB5F,qBAAqB,CAAC+E,WAAtB,CAAkCC,MAAlC,CAAyCC,MAAzC,CAAgDC,QAAnE,cAA+EI,SAAS,CAAC,CAAD,CAAT,CAAaO,IAA5F,CAAT;UACA,IAAMC,eAAe,GAAGxF,GAAG,CAACD,OAAD,EAAUuF,GAAV,CAA3B;UACAjF,WAAW,CAACmF,eAAD,CAAX,CAA6BV,IAA7B,CAAkC,UAACW,SAAD,EAAe;YAC/C,IAAMC,GAAG,0BAAmBhG,qBAAqB,CAAC+E,WAAtB,CAAkCC,MAAlC,CAAyCC,MAAzC,CAAgDC,QAAnE,cAA+EI,SAAS,CAAC,CAAD,CAAT,CAAaO,IAA5F,CAAT;YACA,IAAMI,eAAe,GAAG3F,GAAG,CAACD,OAAD,EAAU2F,GAAV,CAA3B;YACArF,WAAW,CAACsF,eAAD,CAAX,CAA6Bb,IAA7B,CAAkC,UAACc,SAAD,EAAe;cAC/C,IAAMC,EAAE,GAAG,IAAIC,IAAJ,CAASL,SAAS,CAACM,WAAnB,CAAX;cACA,IAAMC,EAAE,GAAG,IAAIF,IAAJ,CAASF,SAAS,CAACG,WAAnB,CAAX;;cACA,IAAIF,EAAE,IAAIG,EAAV,EAAc;gBACZ1B,GAAG,CAAC;kBAAE2B,QAAQ,EAAEjB,SAAS,CAAC,CAAD,CAAT,CAAaO;gBAAzB,CAAD,CAAH;cACD,CAFD,MAEO;gBACLjB,GAAG,CAAC;kBAAE2B,QAAQ,EAAEjB,SAAS,CAAC,CAAD,CAAT,CAAaO;gBAAzB,CAAD,CAAH;cACD;YACF,CARD,EAQGW,KARH,CAQS,UAACC,IAAD,EAAU;cACjBC,OAAO,CAACC,GAAR,CAAYF,IAAZ;cACA5B,GAAG;YACJ,CAXD;UAYD,CAfD,EAeG2B,KAfH,CAeS,UAACI,IAAD,EAAU;YACjBF,OAAO,CAACC,GAAR,CAAYC,IAAZ;YACA/B,GAAG;UACJ,CAlBD;QAmBD,CAtBD,MAsBO;UACL6B,OAAO,CAACC,GAAR,CAAY,+BAAZ,EADK,CACyC;;UAC9C9B,GAAG;QACJ;MACF,CA/BD,EA+BG2B,KA/BH,CA+BS,UAASnE,GAAT,EAAc;QACrBqE,OAAO,CAACC,GAAR,CAAYtE,GAAZ;QACAwC,GAAG;MACJ,CAlCD;IAmCD,CAtCM,CAAP;EAuCD,CAxCD,CApE8D,CA8G9D;;;EACA,IAAMgC,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAM;IAChC,OAAO,IAAIlC,OAAJ,CAAY,UAAUC,GAAV,EAAeC,GAAf,EAAoB;MACrC,IAAMC,EAAE,0BAAmB9E,qBAAqB,CAAC+E,WAAtB,CAAkCC,MAAlC,CAAyCC,MAAzC,CAAgDC,QAAnE,CAAR;MACA,IAAMC,cAAc,GAAG7E,GAAG,CAACD,OAAD,EAAUyE,EAAV,CAA1B;MACArE,OAAO,CAAC0E,cAAD,CAAP,CAAwBC,IAAxB,CAA6B,UAASC,KAAT,EAAgB;QAC3C,IAAMC,SAAS,GAAG,EAAlB;QACAD,KAAK,CAACE,KAAN,CAAYC,OAAZ,CAAoB,UAASC,OAAT,EAAkB;UACpCH,SAAS,CAACI,IAAV,CAAeD,OAAf;QACD,CAFD;;QAGA,IAAIH,SAAS,CAACK,MAAV,IAAoB,CAAxB,EAA2B;UACzBjB,4BAA4B,GAAGU,IAA/B,CAAoC,UAAC0B,CAAD,EAAO;YACzC,IAAMlB,GAAG,0BAAmB5F,qBAAqB,CAAC+E,WAAtB,CAAkCC,MAAlC,CAAyCC,MAAzC,CAAgDC,QAAnE,cAA+E4B,CAAC,CAACP,QAAjF,CAAT;YACA,IAAMT,eAAe,GAAGxF,GAAG,CAACD,OAAD,EAAUuF,GAAV,CAA3B;YACAlF,YAAY,CAACoF,eAAD,CAAZ,CAA8BV,IAA9B,CAAmC,YAAM;cACvCR,GAAG;YACJ,CAFD,EAEG4B,KAFH,CAES,UAACC,IAAD,EAAU;cACjBC,OAAO,CAACC,GAAR,CAAYF,IAAZ;cACA5B,GAAG;YACJ,CALD;UAMD,CATD,EASG2B,KATH,CASS,UAACI,IAAD,EAAU;YACjBF,OAAO,CAACC,GAAR,CAAYC,IAAZ;YACA/B,GAAG;UACJ,CAZD;QAaD,CAdD,MAcO;UACL6B,OAAO,CAACC,GAAR,CAAY,+BAAZ,EADK,CACyC;;UAC9C9B,GAAG;QACJ;MACF,CAvBD,EAuBG2B,KAvBH,CAuBS,UAASnE,GAAT,EAAc;QACrBqE,OAAO,CAACC,GAAR,CAAYtE,GAAZ;QACAwC,GAAG;MACJ,CA1BD;IA2BD,CA9BM,CAAP;EA+BD,CAhCD,CA/G8D,CAkJ9D;;;EACA,IAAMkC,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACC,KAAD,EAAW;IACvCA,KAAK,CAACC,cAAN;IACAzC,UAAU,CAACwC,KAAK,CAACE,MAAN,CAAa7B,KAAb,CAAmB,CAAnB,CAAD,CAAV,CAAkCD,IAAlC,CAAuC,UAACR,GAAD,EAAS;MAC9CA,GAAG,CAACuC,IAAJ,CAASC,IAAT,GAAgBhC,IAAhB,CAAqB,UAACrD,IAAD,EAAU;QAC7BC,OAAO,CAACD,IAAD,CAAP;QACAe,WAAW,CAAC8B,GAAG,CAAC/B,QAAL,CAAX;QACAG,eAAe,CAAC4B,GAAG,CAACuC,IAAJ,CAAStB,IAAV,CAAf;QACAgB,mBAAmB;MACpB,CALD;IAMD,CAPD;EAQD,CAVD,CAnJ8D,CAgK9D;;;EACA,IAAMQ,gBAAgB,GAAG,SAAnBA,gBAAmB,GAAM;IAC7B,OAAO,IAAI1C,OAAJ,CAAY,UAAUC,GAAV,EAAeC,GAAf,EAAoB;MACrC,IAAMC,EAAE,0BAAmB9E,qBAAqB,CAAC+E,WAAtB,CAAkCC,MAAlC,CAAyCC,MAAzC,CAAgDC,QAAnE,CAAR;MACA,IAAMC,cAAc,GAAG7E,GAAG,CAACD,OAAD,EAAUyE,EAAV,CAA1B;MACArE,OAAO,CAAC0E,cAAD,CAAP,CAAwBC,IAAxB,CAA6B,UAASC,KAAT,EAAgB;QAC3C,IAAMC,SAAS,GAAG,EAAlB;QACAD,KAAK,CAACE,KAAN,CAAYC,OAAZ,CAAoB,UAASC,OAAT,EAAkB;UACpCH,SAAS,CAACI,IAAV,CAAeD,OAAf;QACD,CAFD;;QAGA,IAAIH,SAAS,CAACK,MAAV,IAAoB,CAAxB,EAA2B;UACzBf,GAAG,CAAC;YAAE2B,QAAQ,EAAEjB,SAAS,CAAC,CAAD,CAAT,CAAaO,IAAzB;YAA+BhD,QAAQ,EAAEyC,SAAS,CAAC,CAAD,CAAT,CAAagC,SAAb,CAAuBC;UAAhE,CAAD,CAAH;QACD,CAFD,MAEO;UACLb,OAAO,CAACC,GAAR,CAAY,+BAAZ,EADK,CACyC;;UAC9C9B,GAAG;QACJ;MACF,CAXD,EAWG2B,KAXH,CAWS,UAASnE,GAAT,EAAc;QACrBqE,OAAO,CAACC,GAAR,CAAYtE,GAAZ;QACAwC,GAAG;MACJ,CAdD;IAeD,CAlBM,CAAP;EAmBD,CApBD,CAjK8D,CAwL9D;;;EACA,IAAML,UAAU,GAAG,SAAbA,UAAa,CAACF,CAAD,EAAO;IACxB,OAAO,IAAIK,OAAJ,CAAY,UAAUC,GAAV,EAAeC,GAAf,EAAoB;MACrC,IAAI,CAACP,CAAL,EAAQ;QACNoC,OAAO,CAACC,GAAR,CAAY,sCAAZ;QACA9B,GAAG;MACJ;;MACD,IAAMC,EAAE,0BAAmB9E,qBAAqB,CAAC+E,WAAtB,CAAkCC,MAAlC,CAAyCC,MAAzC,CAAgDC,QAAnE,cAA+EZ,CAAC,CAACuB,IAAjF,CAAR;MACA,IAAMV,cAAc,GAAG7E,GAAG,CAACD,OAAD,EAAUyE,EAAV,CAA1B;MACA,IAAM0C,oBAAoB,GAAGjH,oBAAoB,CAAC4E,cAAD,EAAiBb,CAAjB,CAAjD;MACAkD,oBAAoB,CAACxG,EAArB,CACE,eADF,EAEE,UAACyG,CAAD,EAAO;QACL,IAAIC,CAAC,GAAG,GAAR;;QACA,IAAID,CAAC,CAACE,UAAF,GAAe,CAAnB,EAAsB;UACpBD,CAAC,GAAGE,IAAI,CAACC,KAAL,CAAYJ,CAAC,CAACK,gBAAF,GAAqBL,CAAC,CAACE,UAAxB,GAAsC,GAAjD,CAAJ;QACD;MACF,CAPH,EAQE,UAACtF,GAAD,EAAS;QACPqE,OAAO,CAACC,GAAR,CAAYtE,GAAZ;QACAwC,GAAG;MACJ,CAXH,EAYE,YAAM;QACJ;QACA;QACAD,GAAG,CAAC;UAAEuC,IAAI,EAAE7C,CAAR;UAAWzB,QAAQ,EAAEiC;QAArB,CAAD,CAAH;MACD,CAhBH;IAkBD,CA1BM,CAAP;EA2BD,CA5BD,CAzL8D,CAwN9D;;;EACA,IAAMiD,uBAAuB,GAAG,SAA1BA,uBAA0B,CAACC,GAAD,EAAS;IACvC,OAAO,IAAIrD,OAAJ,CAAY,UAAUC,GAAV,EAAeC,GAAf,EAAoB;MACrC,IAAIoD,GAAG,GAAG,IAAIC,cAAJ,EAAV,CADqC,CAErC;;MACAD,GAAG,CAACE,YAAJ,GAAmB,MAAnB;;MACAF,GAAG,CAACG,MAAJ,GAAa,UAACpB,KAAD,EAAW;QACtB,IAAIiB,GAAG,CAACI,MAAJ,IAAc,GAAlB,EAAuB;UACrBzD,GAAG,CAAC;YAAE7C,IAAI,EAAEkG,GAAG,CAACK;UAAZ,CAAD,CAAH;QACD,CAFD,MAEO;UACL5B,OAAO,CAACC,GAAR,CAAYsB,GAAG,CAACI,MAAhB;UACAxD,GAAG;QACJ;MACF,CAPD;;MAQAoD,GAAG,CAACM,OAAJ,GAAc,YAAM;QAClB7B,OAAO,CAACC,GAAR,CAAYsB,GAAG,CAACI,MAAhB;QACAxD,GAAG;MACJ,CAHD;;MAIAoD,GAAG,CAACO,IAAJ,CAAS,KAAT,EAAgBR,GAAhB;MACAC,GAAG,CAACQ,IAAJ,GAjBqC,CAiBzB;IACb,CAlBM,CAAP;EAmBD,CApBD,CAzN8D,CAgP9D;;;EACA,IAAMC,YAAY,GAAG,SAAfA,YAAe,CAACC,YAAD,EAAkB;IACrC,IAAMxD,cAAc,GAAG7E,GAAG,CAACD,OAAD,EAAUsI,YAAV,CAA1B;IACA,OAAOnI,cAAc,CAAC2E,cAAD,CAAd,CAA+BC,IAA/B,CAAoC,UAAC4C,GAAD;MAAA,OACzCD,uBAAuB,CAACC,GAAD,CADkB;IAAA,CAApC,CAAP;EAGD,CALD,CAjP8D,CAyP9D;;;EACA,IAAMY,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAM;IAChC,OAAO,IAAIjE,OAAJ,CAAY,UAAUC,GAAV,EAAeC,GAAf,EAAoB;MACrC,IAAMC,EAAE,0BAAmB9E,qBAAqB,CAAC+E,WAAtB,CAAkCC,MAAlC,CAAyCC,MAAzC,CAAgDC,QAAnE,CAAR;MACA,IAAMC,cAAc,GAAG7E,GAAG,CAACD,OAAD,EAAUyE,EAAV,CAA1B;MACArE,OAAO,CAAC0E,cAAD,CAAP,CAAwBC,IAAxB,CAA6B,UAASC,KAAT,EAAgB;QAC3C,IAAMC,SAAS,GAAG,EAAlB;QACAD,KAAK,CAACE,KAAN,CAAYC,OAAZ,CAAoB,UAASC,OAAT,EAAkB;UACpCH,SAAS,CAACI,IAAV,CAAeD,OAAf;QACD,CAFD;;QAGA,IAAIH,SAAS,CAACK,MAAV,IAAoB,CAAxB,EAA2B;UACzBf,GAAG,CAAC,IAAD,CAAH;QACD,CAFD,MAEO;UACLA,GAAG,CAAC,KAAD,CAAH;QACD;MACF,CAVD,EAUG4B,KAVH,CAUS,UAASnE,GAAT,EAAc;QACrBqE,OAAO,CAACC,GAAR,CAAYtE,GAAZ;QACAwC,GAAG;MACJ,CAbD;IAcD,CAjBM,CAAP;EAkBD,CAnBD;;EAqBAlG,SAAS,CAAC,YAAM;IAEd;IAEA0C,MAAM,CAACwH,IAAP,CAAY,gBAAZ,EAA8B,SAA9B,EAAyCvH,OAAzC,EAAkDC,MAAlD;IAEAF,MAAM,CAACwH,IAAP,CAAY,cAAZ,EAA4BtH,MAA5B,EANc,CAQd;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IAEAF,MAAM,CAACL,EAAP,CAAU,yBAAV,EAAqC,UAAC8H,KAAD,EAAQC,IAAR,EAAczH,OAAd,EAA0B;MAC7D;MACA8B,iBAAiB,CAAC,UAAA4F,aAAa,EAAI;QACjC,IAAMC,QAAQ,sBAAOD,aAAP,CAAd;;QACA,IAAME,GAAG,GAAGD,QAAQ,CAACE,SAAT,CAAmB,UAACC,IAAD;UAAA,OAAUA,IAAI,CAACN,KAAL,KAAeA,KAAzB;QAAA,CAAnB,CAAZ;;QACA,IAAII,GAAG,IAAI,CAAX,EAAc;UACZD,QAAQ,CAACI,MAAT,CAAgBH,GAAhB,EAAqB,CAArB;QACD;;QACD,OAAOD,QAAP;MACD,CAPgB,CAAjB,CAF6D,CAU7D;;MACA,IAAMK,OAAO,GAAGtF,QAAQ,CAAC9C,OAAT,CAAiBiI,SAAjB,CAA2B,UAACzB,CAAD;QAAA,OAAOA,CAAC,CAAC6B,MAAF,KAAaT,KAApB;MAAA,CAA3B,CAAhB;;MACA,IAAIQ,OAAO,IAAI,CAAf,EAAkB;QAChB1F,QAAQ,CAAC,UAAC4F,KAAD,EAAW;UAClB,IAAMC,OAAO,GAAGD,KAAK,CAACL,SAAN,CAAgB,UAACzB,CAAD;YAAA,OAAO1D,QAAQ,CAAC9C,OAAT,CAAiBoI,OAAjB,EAA0BvI,IAA1B,KAAmC2G,CAA1C;UAAA,CAAhB,CAAhB;UACA8B,KAAK,CAACH,MAAN,CAAaI,OAAb,EAAsB,CAAtB;UACA,OAAOD,KAAP;QACD,CAJO,CAAR;QAKAxF,QAAQ,CAAC9C,OAAT,CAAiBoI,OAAjB,EAA0BvI,IAA1B,CAA+B2I,kBAA/B;QACA1F,QAAQ,CAAC9C,OAAT,CAAiBoI,OAAjB,EAA0BvI,IAA1B,CAA+B4I,OAA/B;QACA3F,QAAQ,CAAC9C,OAAT,CAAiBmI,MAAjB,CAAwBC,OAAxB,EAAiC,CAAjC;MACD,CArB4D,CAsB7D;;;MACAxH,MAAM,CAAC,UAAA8H,IAAI,EAAI;QACb,IAAGd,KAAK,KAAKc,IAAb,EAAmB;UACjBhI,iBAAiB,CAAC,KAAD,CAAjB;UACAP,MAAM,CAACQ,GAAP,GAAa,EAAb;UACA,OAAO,EAAP;QACD;;QACD,OAAO+H,IAAP;MACD,CAPK,CAAN;IAQD,CA/BD;IAkCAvI,MAAM,CAACL,EAAP,CAAU,sBAAV,EAAkC,UAAC8H,KAAD,EAAQC,IAAR,EAAczH,OAAd,EAA0B;MAC1D8B,iBAAiB,CAAC,UAAA4F,aAAa,EAAI;QAC/B,IAAME,GAAG,GAAGF,aAAa,CAACG,SAAd,CAAwB,UAAA1B,CAAC;UAAA,OACnCA,CAAC,CAACnG,OAAF,KAAcA,OADqB;QAAA,CAAzB,CAAZ;;QAGA,IAAG4H,GAAG,IAAI,CAAV,EAAY;UACVxC,OAAO,CAACC,GAAR,mCAC6BrF,OAD7B,yCACmEwH,KADnE;UAGA,OAAOE,aAAP;QACD,CALD,MAKO;UACLtC,OAAO,CAACC,GAAR,uCACiCrF,OADjC,0BACwDwH,KADxD,yBAC4EC,IAD5E;UAGA,oCAAWC,aAAX,IAA0B;YAAE1H,OAAO,EAAPA,OAAF;YAAWwH,KAAK,EAALA;UAAX,CAA1B;QACD;MACJ,CAfgB,CAAjB,CAD0D,CAmB1D;;MACAlH,iBAAiB,CAAC,UAAAiI,OAAO,EAAI;QAC3B;QACA,IAAI,CAACA,OAAL,EAAa;UACX7H,OAAO,CAAC,UAAA8H,WAAW,EAAI;YACrBzI,MAAM,CAACwH,IAAP,CAAY,aAAZ,EAA2BiB,WAA3B,EAAwCvI,MAAxC;YACA,OAAOuI,WAAP;UACD,CAHM,CAAP;QAID,CALD,MAKO;UAAE;UACP5H,UAAU,CAAC,UAAA6H,UAAU,EAAI;YACvB1I,MAAM,CAACwH,IAAP,CAAY,aAAZ,EAA2BkB,UAA3B,EAAuCxI,MAAvC;YACA,OAAOwI,UAAP;UACD,CAHS,CAAV;QAID;;QACD,OAAOF,OAAP;MACD,CAdgB,CAAjB;IAeD,CAnCD,EAxEc,CA4Gd;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IACAxI,MAAM,CAACL,EAAP,CAAU,cAAV,EAA0B,UAACgJ,MAAD,EAAS9E,QAAT,EAAsB;MAC9CwB,OAAO,CAACC,GAAR,CACE,0DADF,EAC8DqD,MAD9D,EAEE,qBAFF,EAEyB9E,QAFzB;MAKA9B,iBAAiB,CAAC,UAAA4F,aAAa,EAAI;QACjC3H,MAAM,CAACwH,IAAP,CAAY,aAAZ,EAA2B9G,IAA3B,EAAiCR,MAAjC;QAEE,IAAM2H,GAAG,GAAGF,aAAa,CAACG,SAAd,CAAwB,UAAA1B,CAAC;UAAA,OACnCA,CAAC,CAACnG,OAAF,KAAc4D,QADqB;QAAA,CAAzB,CAAZ;QAGAwB,OAAO,CAACC,GAAR,CAAY,gCAAZ,EAA8CuC,GAA9C;;QACA,IAAGA,GAAG,GAAG,CAAT,EAAW;UACT,oCAAWF,aAAX,IAA0B;YAAE1H,OAAO,EAAE4D,QAAX;YAAqB4D,KAAK,EAAEkB;UAA5B,CAA1B;QACD;;QACD,OAAOhB,aAAP;MACH,CAXgB,CAAjB;IAYD,CAlBD;IAqBA3H,MAAM,CAACL,EAAP,CAAU,YAAV,EAAwB,UAACe,IAAD,EAAOF,GAAP,EAAe;MACrC;MACAC,MAAM,CAACD,GAAD,CAAN;MACAR,MAAM,CAACQ,GAAP,GAAaA,GAAb;MACAR,MAAM,CAACL,EAAP,GAAY,IAAZ,CAJqC,CAKrC;;MACAkB,UAAU,CAAC,YAAM;QACfb,MAAM,CAACwH,IAAP,CAAY,aAAZ,EAA2B9G,IAA3B,EAAiCR,MAAjC;QACA,OAAOQ,IAAP;MACD,CAHS,CAAV;IAID,CAVD,EA5Ic,CAwJd;;IACAV,MAAM,CAACL,EAAP,CAAU,UAAV,EAAsB,UAACiJ,KAAD,EAAQC,EAAR,EAAe;MACnCtI,iBAAiB,CAAC,UAAAiI,OAAO,EAAI;QAC3B,IAAIA,OAAJ,EAAY;UACV3H,UAAU,CAAC,YAAM;YACfb,MAAM,CAACwH,IAAP,CAAY,aAAZ,EAA2BoB,KAA3B,EAAkC1I,MAAlC;YACA,OAAO0I,KAAP;UACD,CAHS,CAAV;QAID;;QACD,OAAOJ,OAAP;MACD,CARgB,CAAjB;IASD,CAVD,EAzJc,CAsKd;;IACAxI,MAAM,CAACL,EAAP,CAAU,YAAV,EAAwB,UAACmJ,GAAD,EAAS;MAC/B9I,MAAM,CAACQ,GAAP,GAAa,EAAb;MACAC,MAAM,CAAC,EAAD,CAAN;MACAT,MAAM,CAACL,EAAP,GAAY,IAAZ;MACAkB,UAAU,CAAC,EAAD,CAAV;IACD,CALD;IAOAwE,OAAO,CAACC,GAAR,CAAY,qBAAZ;IACED,OAAO,CAACC,GAAR,CAAYtF,MAAM,CAAC6I,EAAnB;IAEF7I,MAAM,CAACL,EAAP,CAAU,WAAV,EAAuB,UAACwI,KAAD,EAAW;MAChC9C,OAAO,CAACC,GAAR,CAAY6C,KAAZ;MACA,IAAM7F,KAAK,GAAG,EAAd;MACA6F,KAAK,CAAChE,OAAN,CAAc,UAAC4E,MAAD,EAAY;QACxB,IAAMrJ,IAAI,GAAGsJ,UAAU,CAACD,MAAD,EAAS/I,MAAM,CAAC6I,EAAhB,EAAoBjG,UAAU,CAAC/C,OAA/B,CAAvB;QACAwF,OAAO,CAACC,GAAR,CAAY5F,IAAZ;QACAiD,QAAQ,CAAC9C,OAAT,CAAiBwE,IAAjB,CAAsB;UACpB6D,MAAM,EAAEa,MADY;UAEpBrJ,IAAI,EAAJA;QAFoB,CAAtB;QAIA4C,KAAK,CAAC+B,IAAN,CAAW3E,IAAX;MACD,CARD;MASA2F,OAAO,CAACC,GAAR,CAAY3C,QAAQ,CAAC9C,OAArB;MACAwF,OAAO,CAACC,GAAR,2BAA+BhD,KAAK,CAACgC,MAArC;MACA/B,QAAQ,CAACD,KAAD,CAAR;IACD,CAfD;IAkBFtC,MAAM,CAACL,EAAP,CAAU,aAAV,EAAyB,UAACsJ,OAAD,EAAa;MACpC5D,OAAO,CAACC,GAAR,CAAY,aAAZ;MACA,IAAM5F,IAAI,GAAGwJ,OAAO,CAACD,OAAO,CAACE,MAAT,EAAiBF,OAAO,CAACG,QAAzB,EAAmCxG,UAAU,CAAC/C,OAA9C,CAApB;MACA8C,QAAQ,CAAC9C,OAAT,CAAiBwE,IAAjB,CAAsB;QACpB6D,MAAM,EAAEe,OAAO,CAACG,QADI;QAEpB1J,IAAI,EAAJA;MAFoB,CAAtB;MAKA6C,QAAQ,CAAC,UAAC4F,KAAD;QAAA,oCAAeA,KAAf,IAAsBzI,IAAtB;MAAA,CAAD,CAAR;IACD,CATD;IAYAM,MAAM,CAACL,EAAP,CAAU,2BAAV,EAAuC,UAACsJ,OAAD,EAAa;MAClD5D,OAAO,CAACC,GAAR,CAAY,2BAAZ;MACAD,OAAO,CAACC,GAAR,CAAY3C,QAAQ,CAAC9C,OAArB;MACAwF,OAAO,CAACC,GAAR,CAAY2D,OAAO,CAACJ,EAApB;MACA,IAAMQ,IAAI,GAAG1G,QAAQ,CAAC9C,OAAT,CAAiByJ,IAAjB,CAAsB,UAACjD,CAAD;QAAA,OAAOA,CAAC,CAAC6B,MAAF,KAAae,OAAO,CAACJ,EAA5B;MAAA,CAAtB,CAAb;MACAxD,OAAO,CAACC,GAAR,CAAY+D,IAAZ;MACAA,IAAI,CAAC3J,IAAL,CAAUyJ,MAAV,CAAiBF,OAAO,CAACE,MAAzB;IACD,CAPD;IASAnJ,MAAM,CAACL,EAAP,CAAU,yBAAV,EAAqC,UAAC4J,QAAD,EAAc;MACjDlE,OAAO,CAACC,GAAR,CAAY,yBAAZ;MACAD,OAAO,CAACC,GAAR,CAAY3C,QAAQ,CAAC9C,OAArB;MACAwF,OAAO,CAACC,GAAR,CAAYiE,QAAZ;MACA,IAAMtB,OAAO,GAAGtF,QAAQ,CAAC9C,OAAT,CAAiBiI,SAAjB,CAA2B,UAACzB,CAAD;QAAA,OAAOA,CAAC,CAAC6B,MAAF,KAAaqB,QAApB;MAAA,CAA3B,CAAhB;;MACA,IAAItB,OAAO,IAAI,CAAf,EAAkB;QAChB5C,OAAO,CAACC,GAAR,CAAY2C,OAAZ;QACA1F,QAAQ,CAAC,UAAC4F,KAAD,EAAW;UAClB,IAAMC,OAAO,GAAGD,KAAK,CAACL,SAAN,CAAgB,UAACzB,CAAD;YAAA,OAAO1D,QAAQ,CAAC9C,OAAT,CAAiBoI,OAAjB,EAA0BvI,IAA1B,KAAmC2G,CAA1C;UAAA,CAAhB,CAAhB;UACAhB,OAAO,CAACC,GAAR,CAAY8C,OAAZ;UACA/C,OAAO,CAACC,GAAR,CAAY6C,KAAZ;UACAA,KAAK,CAACH,MAAN,CAAaI,OAAb,EAAsB,CAAtB;UACA,OAAOD,KAAP;QACD,CANO,CAAR;QAOAxF,QAAQ,CAAC9C,OAAT,CAAiBoI,OAAjB,EAA0BvI,IAA1B,CAA+B2I,kBAA/B;QACA1F,QAAQ,CAAC9C,OAAT,CAAiBoI,OAAjB,EAA0BvI,IAA1B,CAA+B4I,OAA/B;QACA3F,QAAQ,CAAC9C,OAAT,CAAiBmI,MAAjB,CAAwBC,OAAxB,EAAiC,CAAjC;MACD;;MACD5C,OAAO,CAACC,GAAR,CAAY3C,QAAQ,CAAC9C,OAArB;IACD,CAnBD,EAxNgB,CA8Od;;IACA,IAAIa,IAAI,KAAK,EAAT,IAAec,QAAQ,KAAK,EAA5B,IAAkCE,YAAY,KAAK,EAAvD,EAA2D;MACzD6F,mBAAmB,GAAGxD,IAAtB,CAA2B,UAACR,GAAD,EAAS;QAClC,IAAIA,GAAJ,EAAS;UACP,IAAIE,EAAE,GAAG,8BAAT;UACA4D,YAAY,CAAC5D,EAAD,CAAZ,CACGM,IADH,CACQ,UAACR,GAAD,EAAS;YACb,IAAMN,CAAC,GAAG,IAAIC,IAAJ,CAAS,CAACK,GAAG,CAAC7C,IAAL,CAAT,EAAqB,qBAArB,CAAV;YACA,OAAOyC,UAAU,CAACF,CAAD,CAAjB;UACD,CAJH,EAKGc,IALH,CAKQ,UAACR,GAAD,EAAS;YACbA,GAAG,CAACuC,IAAJ,CAASC,IAAT,GAAgBhC,IAAhB,CAAqB,UAACrD,IAAD,EAAU;cAC7BC,OAAO,CAACD,IAAD,CAAP;cACAe,WAAW,CAAC8B,GAAG,CAAC/B,QAAL,CAAX;cACAG,eAAe,CAAC4B,GAAG,CAACuC,IAAJ,CAAStB,IAAV,CAAf;YACD,CAJD;UAKD,CAXH;QAYD,CAdD,MAcO;UACLwB,gBAAgB,GAAGjC,IAAnB,CAAwB,UAACR,GAAD,EAAS;YAC/B8D,YAAY,CAAC9D,GAAG,CAAC/B,QAAL,CAAZ,CAA2BuC,IAA3B,CAAgC,UAACyF,IAAD,EAAU;cACxC7I,OAAO,CAAC6I,IAAI,CAAC9I,IAAN,CAAP;cACAe,WAAW,CAAC8B,GAAG,CAAC/B,QAAL,CAAX;cACAG,eAAe,CAAC4B,GAAG,CAAC2B,QAAL,CAAf;YACD,CAJD;UAKD,CAND;QAOD;MACF,CAxBD;IAyBD;;IAED3D,mBAAmB,CAAC,UAACkI,GAAD;MAAA,OAAS,IAAT;IAAA,CAAD,CAAnB;EACD,CA5QQ,EA4QN,EA5QM,CAAT;EA+QAnM,SAAS,CAAC,YAAM;IACd,IAAI4E,gBAAJ,EAAsB,CACrB;EACF,CAHQ,EAGN,CAACA,gBAAD,CAHM,CAAT;EAOA5E,SAAS,CAAC,YAAM;IACd,IAAG,CAACgD,cAAJ,EAAoBN,MAAM,CAACwH,IAAP,CAAY,aAAZ,EAA2B9G,IAA3B,EAAiCR,MAAjC;IACpB,IAAGI,cAAH,EAAmBN,MAAM,CAACwH,IAAP,CAAY,aAAZ,EAA2B5G,OAA3B,EAAoCV,MAApC;EACpB,CAHQ,EAGP,CAACI,cAAD,CAHO,CAAT;;EAMA,IAAMoJ,QAAQ,GAAG,SAAXA,QAAW,CAACd,KAAD,EAAQe,UAAR,EAAuB;IACtC,IAAI,CAACrJ,cAAL,EAAqBN,MAAM,CAACwH,IAAP,CAAY,aAAZ,EAA2BoB,KAA3B,EAAkC1I,MAAlC;IACrBS,OAAO,CAACiI,KAAD,CAAP;EACD,CAHD;;EAMA,IAAMgB,WAAW,GAAG,SAAdA,WAAc,CAAChB,KAAD,EAAQe,UAAR,EAAuB;IACzC,IAAME,MAAM,GAAGF,UAAU,CAACG,KAAX,CAAiBC,MAAjB,CAAwB,CAAxB,EAA2BC,aAA1C;;IACA,IAAIH,MAAJ,EAAY;MACV7J,MAAM,CAACwH,IAAP,CAAY,UAAZ,EAAwBoB,KAAxB,EAA+B5I,MAAM,CAACQ,GAAtC,EAA2CN,MAA3C;MACAF,MAAM,CAACwH,IAAP,CAAY,aAAZ,EAA2BoB,KAA3B,EAAkC1I,MAAlC;IACD;;IACDW,UAAU,CAAC+H,KAAD,CAAV;EACD,CAPD;;EAUA,IAAMqB,GAAG;IAAA,uEAAG;MAAA;;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACiBpL,OAAO,CAAC6B,IAAD,EAAON,QAAP,CADxB;;YAAA;cAAA;cACFU,GADE,kBACFA,GADE;cACGE,GADH,kBACGA,GADH;cAEVD,MAAM,CAACD,GAAD,CAAN;cACAG,MAAM,CAACD,GAAD,CAAN;cACAhB,MAAM,CAACwH,IAAP,CAAY,oBAAZ,EAAkC1G,GAAlC,EAAuCE,GAAvC,EAA4Cd,MAA5C;;YAJU;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAAH;;IAAA,gBAAH+J,GAAG;MAAA;IAAA;EAAA,GAAT;;EAQA,IAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;IAC9BnJ,MAAM,CAAC,IAAD,CAAN;IACAE,MAAM,CAAC,IAAD,CAAN;EACD,CAHD;;EAMA,IAAMkJ,UAAU;IAAA,uEAAG;MAAA;;MAAA;QAAA;UAAA;YAAA;cACjB9E,OAAO,CAACC,GAAR,CAAY1E,OAAZ;cADiB;cAAA,OAEU/B,OAAO,CAAC+B,OAAD,EAAUR,QAAV,CAFjB;;YAAA;cAAA;cAETU,GAFS,mBAETA,GAFS;cAEJE,GAFI,mBAEJA,GAFI;cAGjBG,SAAS,CAACL,GAAD,CAAT;cACAO,SAAS,CAACL,GAAD,CAAT;;YAJiB;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAAH;;IAAA,gBAAVmJ,UAAU;MAAA;IAAA;EAAA,GAAhB;;EAQA,IAAMC,UAAS;IAAA,uEAAG;MAAA;MAAA;QAAA;UAAA;YAAA;cAChB/E,OAAO,CAACC,GAAR,CAAY,OAAZ;;cADgB,IAEXlD,cAFW;gBAAA;gBAAA;cAAA;;cAAA;cAAA,OAGYiI,SAAS,CAACC,YAAV,CAAuBC,YAAvB,CAAoC;gBAC5DC,KAAK,EAAE,KADqD;gBAE5DC,KAAK,EAAE;cAFqD,CAApC,CAHZ;;YAAA;cAGRC,WAHQ;cAOd9H,UAAU,CAAC/C,OAAX,GAAqB6K,WAArB;cACArF,OAAO,CAACC,GAAR,CAAY,yBAAZ;cACArD,aAAa,CAACyI,WAAD,CAAb;cACAvI,mBAAmB,CAAC,IAAD,CAAnB;;cACA,IAAIO,UAAU,CAAC7C,OAAf,EAAwB;gBACtB6C,UAAU,CAAC7C,OAAX,CAAmBC,SAAnB,GAA+B4K,WAA/B;cACD;;cACD1K,MAAM,CAACwH,IAAP,CAAY,aAAZ,EAA2BmD,MAAM,CAACzK,MAAD,CAAjC;cACAmC,iBAAiB,CAAC,IAAD,CAAjB;cAfc;cAAA;;YAAA;cAiBdJ,aAAa,CAAC,IAAD,CAAb;cACAW,UAAU,CAAC/C,OAAX,GAAqB,IAArB;;cACA,IAAI6C,UAAU,CAAC7C,OAAf,EAAwB;gBACtB6C,UAAU,CAAC7C,OAAX,CAAmBC,SAAnB,GAA+B,IAA/B;cACD;;cACDuC,iBAAiB,CAAC,KAAD,CAAjB;cACAM,QAAQ,CAAC9C,OAAT,GAAmB,EAAnB;cACA0C,QAAQ,CAAC,EAAD,CAAR;cACAvC,MAAM,CAACwH,IAAP,CAAY,kBAAZ,EAAgCmD,MAAM,CAACzK,MAAD,CAAtC;;YAzBc;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAAH;;IAAA,gBAATkK,SAAS;MAAA;IAAA;EAAA,GAAf;;EA8BA,SAASpB,UAAT,CAAoB4B,UAApB,EAAgCxB,QAAhC,EAA0CxJ,MAA1C,EAAkD;IAChD,IAAMF,IAAI,GAAG,IAAIlC,IAAJ,CAAS;MACpBqN,SAAS,EAAE,IADS;MAEpBC,OAAO,EAAE,KAFW;MAGpBlL,MAAM,EAANA;IAHoB,CAAT,CAAb;IAMAF,IAAI,CAACC,EAAL,CAAQ,QAAR,EAAkB,UAACwJ,MAAD,EAAY;MAC5BnJ,MAAM,CAACwH,IAAP,CAAY,gBAAZ,EAA8B;QAAEoD,UAAU,EAAVA,UAAF;QAAcxB,QAAQ,EAARA,QAAd;QAAwBD,MAAM,EAANA;MAAxB,CAA9B;IACD,CAFD;IAIAzJ,IAAI,CAACC,EAAL,CAAQ,OAAR,EAAiB,YAAM;MACrB0F,OAAO,CAACC,GAAR,CAAY,kBAAZ;IACD,CAFD;IAIA,OAAO5F,IAAP;EACD;;EAGD,SAASwJ,OAAT,CAAiB6B,cAAjB,EAAiC3B,QAAjC,EAA2CxJ,MAA3C,EAAmD;IACjD,IAAMF,IAAI,GAAG,IAAIlC,IAAJ,CAAS;MACpBqN,SAAS,EAAE,KADS;MAEpBC,OAAO,EAAE,KAFW;MAGpBlL,MAAM,EAANA;IAHoB,CAAT,CAAb;IAKAF,IAAI,CAACC,EAAL,CAAQ,QAAR,EAAkB,UAACwJ,MAAD,EAAY;MAC5BnJ,MAAM,CAACwH,IAAP,CAAY,kBAAZ,EAAgC;QAAE2B,MAAM,EAANA,MAAF;QAAUC,QAAQ,EAARA;MAAV,CAAhC;IACD,CAFD;IAIA1J,IAAI,CAACC,EAAL,CAAQ,OAAR,EAAiB,YAAM;MACrB0F,OAAO,CAACC,GAAR,CAAY,iBAAZ;IACD,CAFD;IAIA5F,IAAI,CAACyJ,MAAL,CAAY4B,cAAZ;IAEA,OAAOrL,IAAP;EACD;;EAGD,IAAIsL,UAAJ;;EACA,IAAIhJ,UAAJ,EAAgB;IACdgJ,UAAU,gBAAG;MAAO,WAAW,MAAlB;MAAmB,KAAK,MAAxB;MAAyB,GAAG,EAAEtI,UAA9B;MAA0C,QAAQ,MAAlD;MAAA;MAAA;QAAA;QAAA;QAAA;MAAA;IAAA,EAAb;EACD;;EAGD,IAAMuI,oBAAoB,GAAG,SAAvBA,oBAAuB,GAAM;IACjC9J,SAAS,CAAC,IAAD,CAAT;IACAE,SAAS,CAAC,IAAD,CAAT;EACD,CAHD;;EAMA,oBACE,uDACE,oBAAC,GAAD;IACE,EAAE,EAAE;MACF6J,QAAQ,EAAE,CADR;MAEF7E,CAAC,EAAE,CAFD;MAGF8E,KAAK,EAAE;QAAEC,EAAE,wBAAiB7L,WAAjB;MAAJ,CAHL;MAIF8L,QAAQ,wBAAiB9L,WAAjB;IAJN,CADN;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBAQE,oBAAC,OAAD;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EARF,eASE,oBAAC,IAAD;IAAM,SAAS,MAAf;IAAgB,OAAO,EAAE,CAAzB;IAA4B,EAAE,EAAE;MAAC8L,QAAQ,EAAE;IAAX,CAAhC;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GACG/K,cAAc,gBACb,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,CAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,KAAD;IACA,SAAS,EAAC,QADV;IAEA,OAAO,EAAE,CAFT;IAGA,EAAE,EAAE;MAAC+K,QAAQ,EAAE;IAAX,CAHJ;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBAKE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gCAA6BzJ,WAA7B,MADF,CALF,eASE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAmB,EAAE,EAAE;MAACyJ,QAAQ,EAAE;IAAX,CAAvB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,UAAD;IACE,KAAK,EAAEzK,OADT;IAEE,MAAM,EAAC,OAFT;IAGE,KAAK,EAAC,MAHR;IAIE,UAAU,EAAEiC,UAJd;IAKE,QAAQ,EAAE+G,WALZ;IAME,IAAI,EAAC,MANP;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EADF,CADF,CATF,eAqBE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,KAAD;IAAO,OAAO,EAAE,CAAhB;IAAmB,SAAS,EAAC,KAA7B;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GACCxJ,QAAQ,KAAG,MAAX,GAAoB,IAApB,gBACD,oBAAC,MAAD;IAAQ,OAAO,EAAE+J,UAAjB;IAA6B,OAAO,EAAC,WAArC;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,SAFA,CADF,CArBF,eA6BE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,sBAAD;IACE,GAAG,EAAEjJ,MADP;IAEE,GAAG,EAAEE,MAFP;IAGE,KAAK,EAAE6J,oBAHT;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EADF,CA7BF,CADF,CADa,GAwCX,IAzCN,eA2CE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE3K,cAAc,GAAG,CAAH,GAAO,EAApC;IAAwC,EAAE,EAAE;MAAC+K,QAAQ,EAAE;IAAX,CAA5C;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,KAAD;IACE,SAAS,EAAC,QADZ;IAEE,OAAO,EAAE,CAFX;IAGE,EAAE,EAAE;MAACA,QAAQ,EAAE;IAAX,CAHN;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBAKE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,gBAAD;IACE,QAAQ,EAAEjL,QADZ;IAEE,gBAAgB,EAAE,0BAACkL,CAAD;MAAA,OAAOjL,WAAW,CAACiL,CAAC,CAACzF,MAAF,CAAS+C,KAAV,CAAlB;IAAA,CAFpB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EADF,CALF,eAWE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,qBADF,CAXF,eAcE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAmB,EAAE,EAAE;MAACyC,QAAQ,EAAE;IAAX,CAAvB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBAEE;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,UAAD;IACE,KAAK,EAAE3K,IADT;IAEE,MAAM,EAAC,OAFT;IAGE,KAAK,EAAC,MAHR;IAIE,UAAU,EAAEmC,UAJd;IAKE,QAAQ,EAAE6G,QALZ;IAME,IAAI,EAAC,MANP;IAOE,SAAS,EAAC,aAPZ;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EADF,CAFF,CAdF,eA4BE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,KAAD;IACE,OAAO,EAAE,CADX;IAEE,SAAS,EAAC,KAFZ;IAGE,cAAc,EAAC,QAHjB;IAIE,UAAU,EAAC,cAJb;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GAMGtJ,QAAQ,KAAG,MAAX,GAAoB,IAApB,gBACD,oBAAC,MAAD;IAAQ,OAAO,EAAE6J,GAAjB;IAAsB,OAAO,EAAC,WAA9B;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,SAPF,eAWE,oBAAC,OAAD;IAAS,qBAAqB,EAAEvE,qBAAhC;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EAXF,CADF,CA5BF,eA2CE,oBAAC,IAAD;IAAM,IAAI,MAAV;IAAW,EAAE,EAAE,EAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,sBAAD;IACE,GAAG,EAAE5E,GADP;IAEE,GAAG,EAAEE,GAFP;IAGE,KAAK,EAAEkJ,iBAHT;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EADF,CA3CF,CADF,CA3CF,CATF,CADF,EA4GG5I,gBAAgB,gBAAG,oBAAC,gBAAD;IAClB,WAAW,EAAE/B,WADK;IAElB,iBAAiB,EAAEgB,iBAFD;IAGlB,cAAc,EAAEsB,cAHE;IAIlB,cAAc,EAAEC,cAAc,CAACyJ,MAAf,CAAsB,UAACxD,IAAD;MAAA,OAAUA,IAAI,CAAC9H,OAAL,KAAiBA,OAA3B;IAAA,CAAtB,CAJE;IAKlB,iBAAiB,EAAE8B,iBALD;IAMlB,MAAM,EAAE/B,MANU;IAOlB,MAAM,EAAEE,MAPU;IAQlB,aAAa,EAAEC,aARG;IASlB,SAAS,EAAE;MAAA,OAAMiK,UAAS,EAAf;IAAA,CATO;IAUlB,cAAc,EAAEhI,cAVE;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EAAH,GAWZ,IAvHP,eAyHE,oBAAC,KAAD;IAAO,SAAS,EAAC,KAAjB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GACG4I,UADH,EAEG1I,KAAK,CAACkJ,GAAN,CAAU,UAAC9L,IAAD,EAAO+L,KAAP,EAAiB;IAC1B,oBAAO,oBAAC,KAAD;MAAO,GAAG,EAAEA,KAAZ;MAAmB,IAAI,EAAE/L,IAAzB;MAAA;MAAA;QAAA;QAAA;QAAA;MAAA;IAAA,EAAP;EACD,CAFA,CAFH,CAzHF,CADF;AAkID;;AAED,SAASgM,mBAAT,CAA6BC,OAA7B,EAAyD;EACvD,IAAIC,IAAI,GAAGD,OAAO,CAACE,WAAR,CAAoB,KAApB,CAAX;EACA,IAAID,IAAI,CAACE,IAAL,IAAaF,IAAI,CAACG,EAAlB,IAAwB,CAACJ,OAAO,CAACK,QAArC,EAA+C,OAAO,IAAP;;EAC/C,IACEJ,IAAI,CAAC7F,IAAL,CAAU,CAAV,MAAiB6F,IAAI,CAAC7F,IAAL,CAAU,CAAV,EAAakG,WAAb,EAAjB,IACA,cAAcC,IAAd,CAAmBN,IAAI,CAAC7F,IAAL,CAAU,CAAV,CAAnB,CAFF,EAGE;IACA,OAAO;MACL+F,IAAI,EAAEF,IAAI,CAACE,IADN;MAELK,OAAO,EAAElO;IAFJ,CAAP;EAID;;EACD,OAAO;IACL6N,IAAI,EAAEF,IAAI,CAACE,IADN;IAELK,OAAO,EAAEjO;EAFJ,CAAP;AAID;;AAED,SAASkO,iBAAT,CAA2BT,OAA3B,EAAuD;EACrD,IAAIC,IAAI,GAAGD,OAAO,CAACE,WAAR,CAAoB,KAApB,CAAX;EACA,IAAID,IAAI,CAACE,IAAL,IAAaF,IAAI,CAACG,EAAlB,IAAwB,CAACJ,OAAO,CAACK,QAArC,EAA+C,OAAO,IAAP;EAC/C,OAAO;IACLF,IAAI,EAAEF,IAAI,CAACE,IADN;IAELK,OAAO,EAAEhO;EAFJ,CAAP;AAID;;AAED,IAAM4E,uBAAuB,GAAG1E,cAAc,CAACgO,IAAf,CAAoBC,EAApB,CAAuB;EACrDC,YAAY,EAAEb;AADuC,CAAvB,CAAhC;AAIA,IAAM1I,2BAA2B,GAAGtE,YAAY,CAAC2N,IAAb,CAAkBC,EAAlB,CAAqB;EACvDC,YAAY,EAAEH;AADyC,CAArB,CAApC;AAIA,eAAerM,WAAf"},"metadata":{},"sourceType":"module"}